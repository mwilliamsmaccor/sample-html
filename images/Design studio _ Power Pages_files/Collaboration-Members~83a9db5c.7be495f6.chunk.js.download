/*! For license information please see Collaboration-Members~83a9db5c.7be495f6.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[164],{21021:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));var n=function(e){return e.cds="cds-org",e.msGraph="ms-graph",e.ppapi="ppapi",e.paRp="pa-rp",e}({})},21025:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));var n=function(e){return e.Get="GET",e.Post="POST",e.Delete="DELETE",e.Put="PUT",e.Patch="PATCH",e}({})},21029:function(e,r,t){"use strict";t.d(r,"a",(function(){return n}));var n=function(e){return e.Create="Create",e.Delete="Delete",e.Load="Load",e.Update="Update",e.Other="Other",e}({})},21030:function(e,r,t){"use strict";t.d(r,"a",(function(){return a})),t.d(r,"b",(function(){return i}));var n=t(21031),a=e=>Object(n.b)(e)?Object(n.a)(e):i(e);function i(e){var r={};return e&&Object.getOwnPropertyNames(e).forEach(t=>{r[t]=e[t]}),r}},21031:function(e,r,t){"use strict";function n(e){return null==e?void 0:e.isHttpError}function a(e){return{message:e.message,status:e.status,statusText:e.statusText,stack:e.stack,requestId:e.requestId,body:e.body}}t.d(r,"b",(function(){return n})),t.d(r,"a",(function(){return a}))},24479:function(e,r,t){"use strict";t.d(r,"a",(function(){return h}));var n=t(21025),a=t(21021),i=t(21029),o=t(24480),s=t(24481),c=t(24482),u=t(24487);function d(e,r,t,n,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void t(u)}s.done?r(c):Promise.resolve(c).then(n,a)}function l(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var i=e.apply(r,t);function o(e){d(i,n,a,o,s,"next",e)}function s(e){d(i,n,a,o,s,"throw",e)}o(void 0)}))}}class h{constructor(e,r,t){this.maxAllowedPhotosToRequest=20,this.httpRequestor=void 0,this.telemetryService=void 0,this.cacheService=void 0,this.imagesInMemoryCache={},this.userDataInMemoryCache={},this.createUserIdsBatchRequest=(e,r,t)=>this.httpRequestor.makeRequestAsync({method:n.a.Post,service:a.a.msGraph,path:"v1.0/$batch",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({requests:e.map(e=>({id:e,method:n.a.Get,url:r(e)}))}),responseType:"json"},t),this.httpRequestor=e,this.telemetryService=r,t&&(this.cacheService=Object(c.a)(t,r))}sliceAndExecuteUsersBatchRequests(e,r,t,n,a){var i=this;return l((function*(){for(var o=Math.ceil(e.length/i.maxAllowedPhotosToRequest),s=[],c=0;c<o;c++){var u=i.maxAllowedPhotosToRequest*c,d=i.maxAllowedPhotosToRequest*(c+1);s.push(i.createUserIdsBatchRequest(e.slice(u,d),r,t))}var l,h=yield Promise.all(s),y=[];for(var v of h)for(var p of v.body.responses)l=p,p.body,200===l.status?yield n(p,p.body):(y.push(JSON.stringify({error:p.body,status:p.status})),a&&(yield a(p.id)));y.length?t.completeWithWarning({errorData:y}):t.complete()}))()}getUserPhotos(e){var r=arguments,t=this;return l((function*(){var n,a=r.length>1&&void 0!==r[1]?r[1]:"48x48",c={};if(t.cacheService){var d=yield t.cacheService.getFromDB(o.d.UserImageStore,e,t.telemetryService);d&&d.forEach(e=>c[e.key.toString()]=e.value)}else e.forEach(e=>{t.imagesInMemoryCache.hasOwnProperty(e)&&(c[e]=t.imagesInMemoryCache[e])});if(0===(n=e.filter(e=>!c.hasOwnProperty(e))).length)return c;if(yield t.sliceAndExecuteUsersBatchRequests(n,e=>"/users('".concat(e,"')/photos/").concat(a,"/$value"),t.telemetryService.createScenarioTracker(u.c.GetUserPhotos,i.a.Load,{numUsers:e.length}),function(){var e=l((function*(e,r){var t=Object(s.a)(r,e.headers["Content-Type"]||"img/jpg"),n=yield Object(s.b)(t);c[e.id]=n}));return function(r,t){return e.apply(this,arguments)}}(),function(){var e=l((function*(e){c[e]=""}));return function(r){return e.apply(this,arguments)}}()),t.cacheService){var h=Object.keys(c).map(e=>({key:e,value:c[e]}));yield t.cacheService.setToDB(o.d.UserImageStore,h,t.telemetryService)}else Object.keys(c).forEach(e=>{t.imagesInMemoryCache.hasOwnProperty(e)||(t.imagesInMemoryCache[e]=c[e])});return c}))()}getUsers(e){var r=this;return l((function*(){var t,n=["displayName","id","mail","userPrincipalName"],a={};if(r.cacheService){var s=yield r.cacheService.getFromDB(o.d.UserDataStore,e,r.telemetryService);s&&s.forEach(e=>{try{a[e.key.toString()]=JSON.parse(e.value)}catch(t){r.telemetryService.trackError(u.b.ParseUserInfoFromCacheError,t)}})}else e.forEach(e=>{r.userDataInMemoryCache.hasOwnProperty(e)&&(a[e]=r.userDataInMemoryCache[e])});if(0===(t=e.filter(e=>!a.hasOwnProperty(e))).length)return a;if(yield r.sliceAndExecuteUsersBatchRequests(t,e=>"/users('".concat(e,"')/?$select=").concat(n.join(",")),r.telemetryService.createScenarioTracker(u.c.GetUserInfo,i.a.Load,{numUsers:e.length}),(e,r)=>{a[e.id]=r}),r.cacheService){var c=Object.keys(a).map(e=>({key:e,value:JSON.stringify(a[e])}));yield r.cacheService.setToDB(o.d.UserDataStore,c,r.telemetryService)}else Object.keys(a).forEach(e=>{r.userDataInMemoryCache.hasOwnProperty(e)||(r.userDataInMemoryCache[e]=a[e])});return a}))()}getPresence(e){var r=this;return l((function*(){var t={},n=r.telemetryService.createScenarioTracker(u.c.GetUserPresence,i.a.Load,{numUsers:e.length});return yield r.sliceAndExecuteUsersBatchRequests(e,e=>"/users('".concat(e,"')/presence"),n,(e,r)=>{t[e.id]=r}),t}))()}getMe(){var e=this;return l((function*(){var r=e.telemetryService.createScenarioTracker(u.c.GetMe,i.a.Load);try{var t=yield e.httpRequestor.makeRequestAsync({method:n.a.Get,service:a.a.msGraph,path:"v1.0/me?$select=".concat(["displayName","id","mail","userPrincipalName"].join(",")),headers:{Accept:"application/json"},responseType:"json"},r);return r.complete(),t.body}catch(o){throw r.failure({errorData:o}),o}}))()}clearImageCache(){var e=this;return l((function*(){e.cacheService?yield e.cacheService.clearStore(o.d.UserImageStore,e.telemetryService):e.imagesInMemoryCache={}}))()}}},24480:function(e,r,t){"use strict";t.d(r,"c",(function(){return n})),t.d(r,"a",(function(){return a})),t.d(r,"d",(function(){return i})),t.d(r,"b",(function(){return o}));var n=3,a="CollaborationData",i=function(e){return e.UserImageStore="UserImageStore",e.MembersListStore="MembersListStore",e.UserDataStore="UserDataStore",e}({}),o=[{name:i.UserImageStore,expiryPeriod:2592e5},{name:i.MembersListStore,expiryPeriod:864e5},{name:i.UserDataStore,expiryPeriod:864e5}]},24481:function(e,r,t){"use strict";t.d(r,"a",(function(){return n})),t.d(r,"b",(function(){return a}));var n=(e,r,t)=>{r=r||"image/png",t=t||512;for(var n=atob(e),a=[],i=0;i<n.length;i+=t){for(var o=n.slice(i,i+t),s=new Array(o.length),c=0;c<o.length;c++)s[c]=o.charCodeAt(c);var u=new Uint8Array(s);a.push(u)}return new Blob(a,{type:r})},a=e=>new Promise((r,t)=>{var n=new FileReader;n.onerror=t,n.onload=e=>{r(n.result)},n.readAsDataURL(e)})},24482:function(e,r,t){"use strict";t.d(r,"a",(function(){return i}));var n=t(24480),a=t(24483),i=(e,r)=>new a.a(n.a,n.c,n.b,e,r)},24483:function(e,r,t){"use strict";t.d(r,"a",(function(){return d}));var n=t(24484),a=t(21029),i=t(24486),o=t(24487),s=t(21030);function c(e,r,t,n,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void t(u)}s.done?r(c):Promise.resolve(c).then(n,a)}function u(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var i=e.apply(r,t);function o(e){c(i,n,a,o,s,"next",e)}function s(e){c(i,n,a,o,s,"throw",e)}o(void 0)}))}}class d{constructor(e,r,t,n,s){if(this.db=void 0,this.dbPromise=void 0,this.clearExpiredPromise=void 0,this.stores=void 0,this.encryptionUtility=void 0,this.openDBFailed=!1,this.dbStoresExist=!1,l.hasOwnProperty(e))return l[e];if(l[e]=this,n){var c=s.createScenarioTracker(o.a.InitializeDB,a.a.Load);try{this.encryptionUtility=new i.a(n),this.stores=t,this.initializeDB(e,r,t,s),this.clearExpiredPromise=this.clearExpired(s),c.complete()}catch(u){c.completeWithWarning(u)}}}initializeDB(e,r,t,n){var i=this;return u((function*(){var s=n.createScenarioTracker(o.a.OpenCacheDB,a.a.Load);try{i.dbPromise=i.openDB(e,r,t,s),i.db=yield i.dbPromise,i.dbStoresExist=i.doStoresExist(),s.complete()}catch(c){i.openDBFailed=!0,s.completeWithWarning(c)}}))()}dbInitialized(){var e=this;return u((function*(){if(!e.encryptionUtility)return!1;try{yield e.dbPromise}catch(r){return!1}return!!e.db&&!e.openDBFailed&&e.dbStoresExist}))()}dbInitializedAndCleared(){var e=this;return u((function*(){return!!(yield e.dbInitialized())&&(yield e.clearExpiredPromise,!0)}))()}doStoresExist(){var e=!0;return!(!this.db||!this.db.objectStoreNames)&&(this.stores.forEach(r=>{var t;null!==(t=this.db)&&void 0!==t&&t.objectStoreNames.contains(r.name)||(e=!1)}),e)}openDB(e,r,t,a){return Object(n.a)(e,r,{upgrade:e=>{try{if(e){a.progress({message:"Create/Upgrade database"});var r=e.objectStoreNames;for(var n of t){r.contains(n.name)&&e.deleteObjectStore(n.name);var i=e.createObjectStore(n.name,n.options);if(i.createIndex("ByTimestamp","timestamp"),n.indexes)for(var o of n.indexes)i.createIndex(o.name,o.keyPath,o.options)}}}catch(s){this.openDBFailed=!0,a.completeWithWarning(s)}}})}clearExpired(e){var r=this;return u((function*(){if(yield r.dbInitialized()){var t=e.createScenarioTracker(o.a.ClearExpiredCache,a.a.Delete);try{yield Promise.all(r.stores.map(function(){var t=u((function*(t){var n,a=IDBKeyRange.upperBound(Date.now()-t.expiryPeriod),i=yield null===(n=r.db)||void 0===n?void 0:n.getAllKeysFromIndex(t.name,"ByTimestamp",a);i&&i.length&&(yield r.deleteFromDB(t.name,i,e,!0))}));return function(e){return t.apply(this,arguments)}}())),t.complete()}catch(n){t.completeWithWarning(n)}}}))()}setToDB(e,r,t){var n=this;return u((function*(){if(yield n.dbInitializedAndCleared())try{var a,i=yield n.encryptRecords(r,t),c=null===(a=n.db)||void 0===a?void 0:a.transaction(e,"readwrite");yield Promise.all(i.map(function(){var e=u((function*(e){null==c||c.store.put({timestamp:Date.now(),data:e.value},e.key)}));return function(r){return e.apply(this,arguments)}}()))}catch(d){t.trackError(o.a.SetToCache,Object(s.a)(d))}}))()}getFromDB(e,r,t){var n=this;return u((function*(){var a=[];if(yield n.dbInitializedAndCleared())try{var i,c,d=null===(i=n.db)||void 0===i?void 0:i.transaction(e,"readwrite"),l=null===(c=n.stores.find(r=>e===r.name))||void 0===c?void 0:c.expiryPeriod;yield Promise.all(r.map(function(){var e=u((function*(e){var r=yield null==d?void 0:d.store.get(e);r&&(l&&Date.now()-r.timestamp>l?(t.trackInfo(o.a.GetFromCache,{message:"deleting expired record"}),yield null==d?void 0:d.store.delete(e)):a.push({key:e,value:r.data}))}));return function(r){return e.apply(this,arguments)}}()))}catch(h){t.trackError(o.a.GetFromCache,Object(s.a)(h))}return yield n.decryptRecords(a,t)}))()}deleteFromDB(e,r,t,n){var a=this;return u((function*(){if(n&&(yield a.dbInitialized())||(yield a.dbInitializedAndCleared()))try{var i,c=null===(i=a.db)||void 0===i?void 0:i.transaction(e,"readwrite");yield Promise.all(r.map(function(){var e=u((function*(e){return null==c?void 0:c.store.delete(e)}));return function(r){return e.apply(this,arguments)}}()))}catch(d){t.trackError(o.a.DeleteFromCache,Object(s.a)(d))}}))()}clearStore(e,r){var t=this;return u((function*(){if(yield t.dbInitializedAndCleared()){var n=r.createScenarioTracker(o.a.ClearCacheStore,a.a.Delete);try{var i;yield null===(i=t.db)||void 0===i?void 0:i.clear(e),n.complete()}catch(s){n.completeWithWarning(s)}}}))()}getAllKeys(e,r){var t=this;return u((function*(){if(yield t.dbInitializedAndCleared()){var n=r.createScenarioTracker(o.a.GetAllCacheKeys,a.a.Load);try{var i,s=yield null===(i=t.db)||void 0===i?void 0:i.getAllKeys(e);return n.complete(),s}catch(c){n.completeWithWarning(c)}}}))()}encryptRecords(e,r){var t=this;return u((function*(){if(t.encryptionUtility)try{e=yield Promise.all(e.map(function(){var e=u((function*(e){var r=yield t.encryptionUtility.encrypt(e.value);return{key:e.key,value:r}}));return function(r){return e.apply(this,arguments)}}()))}catch(n){r.trackError(o.a.EncryptRecords,Object(s.a)(n))}return e}))()}decryptRecords(e,r){var t=this;return u((function*(){if(t.encryptionUtility)try{e=yield Promise.all(e.map(function(){var e=u((function*(e){var r=yield t.encryptionUtility.decrypt(e.value);return{key:e.key,value:r}}));return function(r){return e.apply(this,arguments)}}()))}catch(n){return void r.trackError(o.a.DecryptRecords,Object(s.a)(n))}return e}))()}}var l={}},24486:function(e,r,t){"use strict";function n(e,r,t,n,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void t(u)}s.done?r(c):Promise.resolve(c).then(n,a)}function a(e){return function(){var r=this,t=arguments;return new Promise((function(a,i){var o=e.apply(r,t);function s(e){n(o,a,i,s,c,"next",e)}function c(e){n(o,a,i,s,c,"throw",e)}s(void 0)}))}}t.d(r,"a",(function(){return o}));var i=["encrypt","decrypt"];class o{constructor(e){this.keyPromise=void 0,this.encryptionLib=void 0,this.encryptionLib=window.crypto.subtle,this.keyPromise=this.encryptionLib.importKey("raw",this.convertStringToUint8Array(atob(e)),"AES-GCM",!1,i)}encrypt(e){var r=this;return a((function*(){var t=yield r.keyPromise,n=new Uint8Array(16);window.crypto.getRandomValues(n);var a=yield r.encryptionLib.encrypt({name:"AES-GCM",iv:n},t,r.convertStringToUint8Array(e));return r.convertArrayBufferToString(a)+String.fromCharCode.apply(null,n)}))()}decrypt(e){var r=this;return a((function*(){var t=yield r.keyPromise,n=r.parseEncryptedString(e),a=yield r.encryptionLib.decrypt({name:"AES-GCM",iv:n.iv},t,n.cipherText);return r.convertArrayBufferToString(a)}))()}parseEncryptedString(e){var r=e.substr(0,e.length-16),t=e.substr(e.length-16,e.length);return{cipherText:this.convertStringToUint8Array(r),iv:this.convertStringToUint8Array(t)}}convertStringToUint8Array(e){for(var r=new Uint8Array(new ArrayBuffer(e.length)),t=0;t<e.length;t++)r[t]=e.charCodeAt(t);return r}convertArrayBufferToString(e){var r=new Uint8Array(e),t="";for(var n of r)t+=String.fromCharCode(n);return t}}},24487:function(e,r,t){"use strict";t.d(r,"a",(function(){return n})),t.d(r,"c",(function(){return a})),t.d(r,"b",(function(){return i})),t.d(r,"d",(function(){return o}));var n=function(e){return e.OpenCacheDB="OpenCacheDB",e.InitializeDB="InitializeDB",e.ClearExpiredCache="ClearExpiredCache",e.SetToCache="SetToCache",e.GetFromCache="GetFromCache",e.DeleteFromCache="DeleteFromCache",e.ClearCacheStore="ClearCacheStore",e.GetAllCacheKeys="GetAllCacheKeys",e.EncryptRecords="EncryptRecords",e.DecryptRecords="DecryptRecords",e}({}),a=function(e){return e.GetUserPhotos="GetUserPhotos",e.GetUserInfo="GetUserInfo",e.GetUserPresence="GetUserPresence",e.GetMe="GetMe",e}({}),i=function(e){return e.ParseUserInfoFromCacheError="ParseUserInfoFromCacheError",e}({}),o=function(e){return e.GetWhoAmI="GetWhoAmI",e.GetUsersPrivileges="GetUsersPrivileges",e.GetUserByAadId="GetUserByAadId",e.GetUserByDomainName="GetUserByDomainName",e}({})},24491:function(e,r,t){"use strict";t.d(r,"a",(function(){return c}));var n=t(12294),a=t(11211);function i(e,r,t,n,a,i,o){try{var s=e[i](o),c=s.value}catch(u){return void t(u)}s.done?r(c):Promise.resolve(c).then(n,a)}function o(e){return function(){var r=this,t=arguments;return new Promise((function(n,a){var o=e.apply(r,t);function s(e){i(o,n,a,s,c,"next",e)}function c(e){i(o,n,a,s,c,"throw",e)}s(void 0)}))}}class s{constructor(e,r){this.httpClient=void 0,this.telemetryService=void 0,this.httpClient=e,this.telemetryService=r}getRequestUrl(e){return"https://".concat(e.service,"/").concat(e.path)}getRequestHeaders(e){return Promise.resolve(e.headers||{})}makeRequestInternalAsync(e,r){var t=this;return o((function*(){var a=t.getRequestUrl(e);r.progress({message:"making http request",method:e.method,url:a});var i={url:a,method:e.method,data:e.body,headers:yield t.getRequestHeaders(e),responseType:e.responseType||"json",loggedHeadersHandler:Object(n.h)("x-ms-request-url")};try{var o,s=yield t.httpClient.request(i),c=s.headers||{};return!c["x-ms-client-request-id"]&&null!==(o=s.config)&&void 0!==o&&o.headers&&(c["x-ms-client-request-id"]=s.config.headers["x-ms-client-request-id"]),r.progress({message:"completed http request",method:e.method,url:a}),{body:s.data,statusCode:s.status,reasonPhrase:s.statusText,headers:c}}catch(y){var u,d,l,h;throw y.requestId=(null==y||null===(u=y.config)||void 0===u?void 0:u.headers)&&y.config.headers["x-ms-client-request-id"],null===(d=y.config)||void 0===d||delete d.data,r.progress({message:null==y||null===(l=y.config)||void 0===l?void 0:l.message,stack:null==y||null===(h=y.config)||void 0===h?void 0:h.stack}),y}}))()}makeRequestAsync(e,r){var t=this;return o((function*(){var n=!r;r||(r=t.telemetryService.createScenarioTracker("MakeRequest",a.a.Load));try{return yield t.makeRequestInternalAsync(e,r)}catch(s){var i=s;if(i.response){var o=new Error(i.message);throw o.body=i.response.data,o.status=i.response.status,o.statusText=i.response.statusText,o.isHttpError=!0,i.stack&&(o.stack=i.stack),r.progress({message:"HttpRequest error",status:o.status,statusText:o.statusText,body:o.body,stack:o.stack}),o}throw s}finally{n&&r.complete()}}))()}}var c=(e,r)=>new s(e,r)}}]);
//# sourceMappingURL=https://sourcemaps.powerapps.com/srcmaps/static/js/module/Collaboration-Members~83a9db5c.7be495f6.chunk.js.map