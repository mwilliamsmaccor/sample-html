/*! For license information please see vendors~app-module-de~56acde0a.5d66e54c.chunk.js.LICENSE.txt */
(window.webpackJsonp=window.webpackJsonp||[]).push([[32],{16645:function(e,t,s){var n=s(16646);e.exports=function(e){return n(e,5)}},18073:function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var n=s(17959),r=s(18218),i=s(18078),o=s(18184),a=s(18188),c=s(18183),h=s(18076),u=s(17997),l=s(18185),d=s(18075),p=s(18074);const g=e=>Object(p.a)(e)?e.tenantId:"local";class m{constructor(e){this.props=e,e.connection.endpoint=e.connection.endpoint.replace(/\/$/,""),this.urlResolver=new d.a;const t=Object(p.a)(this.props.connection);this.documentServiceFactory=new h.a(this.props.connection.tokenProvider,{enableWholeSummaryUpload:t,enableDiscovery:t})}async createContainer(e){const t=this.createLoader(e),s=await t.createDetachedContainer({package:"no-dynamic-package",config:{}});return{container:await this.createFluidContainer(s,this.props.connection),services:this.getContainerServices(s)}}async copyContainer(e,t,s){var n;const r=this.createLoader(t),i=new URL(this.props.connection.endpoint);i.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),i.searchParams.append("tenantId",encodeURIComponent(g(this.props.connection))),i.searchParams.append("containerId",encodeURIComponent(e));const o=await r.resolve({url:i.href});if(void 0===o.resolvedUrl)throw new Error("Source container cannot resolve URL.");const a=await this.documentServiceFactory.createDocumentService(o.resolvedUrl),h=await a.connectToStorage(),u={type:c.a.Handle,handleType:c.a.Tree,handle:null!==(n=null==s?void 0:s.id)&&void 0!==n?n:"latest"},l=await h.downloadSummary(u),d=await r.rehydrateDetachedContainerFromSnapshot(JSON.stringify(l));return{container:await this.createFluidContainer(d,this.props.connection),services:this.getContainerServices(d)}}async getContainer(e,t){const s=this.createLoader(t),n=new URL(this.props.connection.endpoint);n.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),n.searchParams.append("tenantId",encodeURIComponent(g(this.props.connection))),n.searchParams.append("containerId",encodeURIComponent(e));const r=await s.resolve({url:n.href}),i=await Object(u.d)(r,"/");return{container:new o.a(r,i),services:this.getContainerServices(r)}}async getContainerVersions(e,t){var s;const n=new URL(this.props.connection.endpoint);n.searchParams.append("storage",encodeURIComponent(this.props.connection.endpoint)),n.searchParams.append("tenantId",encodeURIComponent(g(this.props.connection))),n.searchParams.append("containerId",encodeURIComponent(e));const r=await this.urlResolver.resolve({url:n.href});if(!r)throw new Error("Unable to resolved URL");const i=await this.documentServiceFactory.createDocumentService(r),o=await i.connectToStorage();return(await o.getVersions(null,null!==(s=null==t?void 0:t.maxCount)&&void 0!==s?s:5)).map(e=>({id:e.id,date:e.date}))}getContainerServices(e){return{audience:new l.a(e)}}createLoader(e){const t=new a.a(e),s={load:async()=>({module:{fluidExport:t},details:{package:"no-dynamic-package",config:{}}})};return new r.a({urlResolver:this.urlResolver,documentServiceFactory:this.documentServiceFactory,codeLoader:s,logger:this.props.logger})}async createFluidContainer(e,t){const s=Object(d.b)(t.endpoint,g(t)),r=await Object(u.d)(e,"/"),a=new o.a(e,r);return a.attach=async()=>{if(e.attachState!==n.a.Detached)throw new Error("Cannot attach container. Container is not in detached state");await e.attach(s);const t=e.resolvedUrl;return Object(i.a)(t),t.id},a}}},18074:function(e,t,s){"use strict";function n(e){return"remote"===e.type}s.d(t,"a",(function(){return n}))},18075:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i}));var n=s(18014);class r{constructor(){}async resolve(e){const{ordererUrl:t,storageUrl:s,tenantId:r,containerId:i}=function(e){const t=new URL(e),s=t.origin,n=t.searchParams,r=n.get("storage");if(null===r)throw new Error("Azure URL did not contain a storage URL");const i=n.get("tenantId");if(null===i)throw new Error("Azure URL did not contain a tenant ID");const o=decodeURIComponent(r),a=decodeURIComponent(i),c=n.get("containerId"),h=null!==c?decodeURIComponent(c):void 0;return{ordererUrl:s,storageUrl:o,tenantId:a,containerId:h}}(e.url);if(e.headers&&!0===e.headers[n.a.createNew])return{endpoints:{deltaStorageUrl:`${t}/deltas/${r}/new`,ordererUrl:t,storageUrl:`${s}/repos/${r}`},id:"",tokens:{},type:"fluid",url:`${t}/${r}/new`};if(void 0===i)throw new Error("Azure URL did not contain containerId");return{endpoints:{deltaStorageUrl:`${t}/deltas/${r}/${i}`,ordererUrl:t,storageUrl:`${s}/repos/${r}`},id:i,tokens:{},type:"fluid",url:`${t}/${r}/${i}`}}async getAbsoluteUrl(e,t){if("fluid"!==e.type)throw new Error("Invalid Resolved Url");return`${e.url}/${t}`}}const i=(e,t)=>{const s=new URL(e);return s.searchParams.append("storage",encodeURIComponent(e)),s.searchParams.append("tenantId",encodeURIComponent(t)),{url:s.href,headers:{[n.a.createNew]:!0}}}},18076:function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var n=s(17940),r=s(18078),i=s(18080),o=s(18081),a=s(17944),c=s(18131),h=s(18082),u=s(18130),l=s(18079),d=s(18077),p=s(18128);const g={enablePrefetch:!0,maxConcurrentStorageRequests:100,maxConcurrentOrdererRequests:100,aggregateBlobsSmallerThanBytes:void 0,enableDiscovery:!1,enableWholeSummaryUpload:!1,enableRestLess:!0};class m{constructor(e,t={}){this.tokenProvider=e,this.protocolName="fluid:",this.blobCache=new d.a,this.snapshotTreeCache=new d.a,this.driverPolicies=Object.assign(Object.assign({},g),t)}async createContainer(e,t,s,c){if(Object(r.a)(t),void 0===e)throw new Error("Empty file summary creation isn't supported in this driver.");Object(n.a)(!!t.endpoints.ordererUrl,178);let d=Object(l.b)(t.url);if(!d.pathname)throw new Error("Parsed url should contain tenant and doc Id!!");const[,p]=d.pathname.split("/"),g=e.tree[".protocol"],m=e.tree[".app"];if(!g||!m)throw new Error("Protocol and App Summary required in the full summary");const b=Object(i.b)(g),v=Object(i.c)(g),y=a.a.create(s,"RouterliciousDriver"),S=new o.a(this.driverPolicies.maxConcurrentOrdererRequests),w=await h.a.load(p,void 0,this.tokenProvider,y,S,this.driverPolicies.enableRestLess,t.endpoints.ordererUrl),C=await w.post("/documents/"+p,{summary:Object(u.a)(m),sequenceNumber:b.sequenceNumber,values:v,enableDiscovery:this.driverPolicies.enableDiscovery,generateToken:void 0!==this.tokenProvider.documentPostCreateCallback});let O,j,M;if("string"==typeof C?O=C:(O=C.id,j=C.token,M=this.driverPolicies.enableDiscovery?C.session:void 0),d=Object(l.b)(t.url),j&&void 0!==this.tokenProvider.documentPostCreateCallback)try{await this.tokenProvider.documentPostCreateCallback(O,j)}catch(E){throw new f(E)}d.set("pathname",Object(l.c)(d.pathname,O));const k=t.endpoints.deltaStorageUrl;if(!k)throw new Error(`All endpoints urls must be provided. [deltaStorageUrl:${k}]`);const N=new URL(k);return N.pathname=Object(l.c)(N.pathname,O),this.createDocumentService(Object.assign(Object.assign({},t),{url:d.toString(),id:O,endpoints:Object.assign(Object.assign({},t.endpoints),{deltaStorageUrl:N.toString()})}),s,c,M)}async createDocumentService(e,t,s,n){Object(r.a)(e);const i=Object(l.b)(e.url),[,u,d]=i.pathname.split("/");if(!d||!u)throw new Error(`Couldn't parse documentId and/or tenantId. [documentId:${d}][tenantId:${u}]`);const g=a.a.create(t,"RouterliciousDriver",{all:{driverVersion:p.a}}),m=async()=>{if(!this.driverPolicies.enableDiscovery)return e;const t=new o.a(this.driverPolicies.maxConcurrentOrdererRequests),s=await h.a.load(u,d,this.tokenProvider,g,t,this.driverPolicies.enableRestLess,e.endpoints.ordererUrl),n=await s.get(`/documents/${u}/session/${d}`);return Object(l.a)(e,n)},f=void 0!==n?Object(l.a)(e,n):await m(),b=f.endpoints.storageUrl,v=f.endpoints.ordererUrl,y=f.endpoints.deltaStorageUrl;if(!v||!y)throw new Error(`All endpoints urls must be provided. [ordererUrl:${v}][deltaStorageUrl:${y}]`);return new c.a(f,v,y,b,g,this.tokenProvider,u,d,this.driverPolicies,this.blobCache,this.snapshotTreeCache,m)}}class f extends Error{constructor(e){super(e.message),this.innerError=e,this.name="DocumentPostCreateError"}get stack(){return this.innerError.stack}}},18077:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(){this.cache=new Map}async get(e){return this.cache.get(e)}async put(e,t){this.cache.set(e,t)}}},18078:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return r}));const n=e=>"fluid"===(null==e?void 0:e.type);function r(e){if(!n(e))throw new Error("resolved is not a Fluid url. Type: "+(null==e?void 0:e.type))}},18079:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"c",(function(){return o})),s.d(t,"a",(function(){return a}));var n=s(11047),r=s.n(n);const i=e=>new r.a(e,!0),o=(e,t)=>e.split("/").slice(0,-1).concat([t]).join("/"),a=(e,t)=>{if(t){const s=new r.a(t.ordererUrl),n=new r.a(e.endpoints.deltaStorageUrl);n.set("host",s.host);const o=new r.a(t.historianUrl),a=new r.a(e.endpoints.storageUrl);a.set("host",o.host);const c=i(e.url);return{endpoints:{deltaStorageUrl:n.toString(),ordererUrl:t.ordererUrl,storageUrl:a.toString()},id:e.id,tokens:e.tokens,type:e.type,url:new r.a(`fluid://${s.host}${c.pathname}`).toString()}}return e}},18080:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i})),s.d(t,"c",(function(){return o}));var n=s(17981);function r(e,t){return{type:n.a.Tree,tree:{".protocol":t,".app":e}}}function i(e){var t;const s=e.tree.attributes,n=JSON.parse(s.content);return n.term=null!==(t=n.term)&&void 0!==t?t:1,n}function o(e){const t=e.tree.quorumValues;return JSON.parse(t.content)}},18081:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(17940);class r{constructor(e){this.maxRequests=e,this.tasks=[],this.release=()=>{const e=this.tasks.shift();if(void 0!==e)return e();this.maxRequests++},Object(n.a)(e>0,174)}get waitQueueLength(){return this.tasks.length}async acquire(){if(!(this.maxRequests>0))return new Promise(e=>{this.tasks.push(e)});this.maxRequests--}async schedule(e){return await this.acquire(),e().finally(this.release)}}},18082:function(e,t,s){"use strict";s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return f}));var n=s(17992),r=s(18085),i=s(18126),o=s(18129),a=s(18083),c=s.n(a),h=s(18084),u=s.n(h),l=s(17946),d=s(18127),p=s(18128);class g extends r.b{constructor(e,t,s,n,r,o={}){super(r,o),this.rateLimiter=t,this.getAuthorizationHeader=s,this.useRestLess=n,this.restLess=new i.a}async load(){this.authorizationHeader=await this.getAuthorizationHeader()}async request(e,t,s=!0){var n;const r=Object.assign(Object.assign({},e),{headers:this.generateHeaders(e.headers)}),i=(e=>{var t,s;return[void 0!==e.baseURL?`${e.baseURL}${null!==(t=e.url)&&void 0!==t?t:""}`:null!==(s=e.url)&&void 0!==s?s:"",{method:e.method,headers:e.headers,body:e.data}]})(this.useRestLess?this.restLess.translate(r):r),o=await this.rateLimiter.schedule(async()=>c()(...i).catch(async e=>{const t=["TypeError","FetchError"].includes(null==e?void 0:e.name);Object(d.b)(t?"NetworkError: "+e.message:u()(e))})),a=(null===(n=o.headers.get("content-type"))||void 0===n?void 0:n.includes("application/json"))?await o.json():await o.text();if(o.ok||o.status===t){return a}if(401===o.status&&s)return this.authorizationHeader=await this.getAuthorizationHeader(!0),this.request(r,t,!1);if(429===o.status&&(null==a?void 0:a.retryAfter)>0)return new Promise((e,s)=>setTimeout(()=>{this.request(r,t).then(e).catch(s)},1e3*a.retryAfter));const h=void 0!==a?"string"==typeof a?a:u()(a):o.statusText;Object(d.b)("R11s fetch error: "+h,o.status,null==a?void 0:a.retryAfter)}generateHeaders(e){const t=(null==e?void 0:e["x-correlation-id"])||Object(l.a)();return Object.assign(Object.assign({},e),{"x-correlation-id":t,"x-driver-version":p.a,Authorization:this.authorizationHeader})}}class m extends g{constructor(e,t,s,n,r,i={}){super(e,t,s,n,r,i)}static async load(e,t,s,r,i,a,c){const h={token:""+Object(n.b)(e)},u=new m(r,i,async n=>{const r={password:(await s.fetchStorageToken(e,t,n)).jwt,user:e};return Object(o.b)(r)},a,c,h);try{await u.load()}catch(l){r.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},l),await u.load()}return u}}class f extends g{constructor(e,t,s,n,r,i={}){super(e,t,s,n,r,i)}static async load(e,t,s,n,r,i,o){const a=new f(n,r,async n=>"Basic "+(await s.fetchOrdererToken(e,t,n)).jwt,i,o);try{await a.load()}catch(c){n.sendErrorEvent({eventName:"R11sRestWrapperLoadFailure"},c),await a.load()}return a}}},18084:function(e,t){function s(e,t){var s=[],n=[];return null==t&&(t=function(e,t){return s[0]===t?"[Circular ~]":"[Circular ~."+n.slice(0,s.indexOf(t)).join(".")+"]"}),function(r,i){if(s.length>0){var o=s.indexOf(this);~o?s.splice(o+1):s.push(this),~o?n.splice(o,1/0,r):n.push(r),~s.indexOf(i)&&(i=t.call(this,r,i))}else s.push(i);return null==e?i:e.call(this,r,i)}}(e.exports=function(e,t,n,r){return JSON.stringify(e,s(t,r),n)}).getSerialize=s},18085:function(e,t,s){"use strict";s.d(t,"b",(function(){return d})),s.d(t,"a",(function(){return p}));var n=s(18086),r=s(18084),i=s.n(r),o=s(18089),a=s.n(o),c=s(17946),h=s(18119),u=s(18125),l=s(18124);class d{constructor(e,t={},s=1048576e3,n=1048576e3){this.baseurl=e,this.defaultQueryString=t,this.maxBodyLength=s,this.maxContentLength=n}async get(e,t,s){const n={baseURL:this.baseurl,headers:s,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"GET",url:`${e}${this.generateQueryString(t)}`};return this.request(n,200)}async post(e,t,s,n){const r={baseURL:this.baseurl,data:t,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"POST",url:`${e}${this.generateQueryString(s)}`};return this.request(r,201)}async delete(e,t,s){const n={baseURL:this.baseurl,headers:s,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"DELETE",url:`${e}${this.generateQueryString(t)}`};return this.request(n,204)}async patch(e,t,s,n){const r={baseURL:this.baseurl,data:t,headers:n,maxBodyLength:this.maxBodyLength,maxContentLength:this.maxContentLength,method:"PATCH",url:`${e}${this.generateQueryString(s)}`};return this.request(r,200)}generateQueryString(e){if(this.defaultQueryString||e){const t=Object.assign(Object.assign({},this.defaultQueryString),e),s=n.stringify(t);if(""!==s)return"?"+s}return""}}class p extends d{constructor(e,t={},s=1048576e3,n=1048576e3,r={},i=a.a,o,c,h){super(e,t,s,n),this.defaultHeaders=r,this.axios=i,this.refreshDefaultQueryString=o,this.refreshDefaultHeaders=c,this.getCorrelationId=h}async request(e,t,s=!0){var n,r;const o=Object.assign({},e);return o.headers=this.generateHeaders(o.headers,null!==(r=null===(n=this.getCorrelationId)||void 0===n?void 0:n.call(this))&&void 0!==r?r:Object(c.a)()),new Promise((n,r)=>{this.axios.request(o).then(e=>{n(e.data)}).catch(a=>{var c,d,p,g,m,f,b,v,y,S,w,C,O,j;if((null===(c=null==a?void 0:a.response)||void 0===c?void 0:c.status)===t&&n(null===(d=null==a?void 0:a.response)||void 0===d?void 0:d.data),(null==a?void 0:a.config)?Object(h.a)(`[${a.config.method}] request to [${null!==(p=a.config.baseURL)&&void 0!==p?p:""}${null!==(g=a.config.url)&&void 0!==g?g:""}] failed with [${null===(m=a.response)||void 0===m?void 0:m.status}] [${i()(null===(f=a.response)||void 0===f?void 0:f.data,void 0,2)}]`):Object(h.a)(`request to ${o.url} failed ${a?a.message:""}`),429===(null===(b=null==a?void 0:a.response)||void 0===b?void 0:b.status)&&(null===(y=null===(v=null==a?void 0:a.response)||void 0===v?void 0:v.data)||void 0===y?void 0:y.retryAfter)>0&&s)setTimeout(()=>{this.request(o,t).then(n).catch(r)},1e3*a.response.data.retryAfter);else if(401===(null===(S=null==a?void 0:a.response)||void 0===S?void 0:S.status)&&s&&this.refreshOnAuthError()){const s=Object.assign({},e);s.headers=this.generateHeaders(s.headers,o.headers[l.a]),this.request(s,t,!1).then(n).catch(r)}else if(null==a?void 0:a.response)r(Object(u.a)(null===(w=null==a?void 0:a.response)||void 0===w?void 0:w.status,null===(C=null==a?void 0:a.response)||void 0===C?void 0:C.data));else if(null==a?void 0:a.request)r(Object(u.a)(502,"Network Error: "+(null!==(O=null==a?void 0:a.message)&&void 0!==O?O:"undefined")));else{const e={canRetry:!1,isFatal:!1,message:null!==(j=null==a?void 0:a.message)&&void 0!==j?j:"Unknown Error"};r(Object(u.a)(500,e))}})})}generateHeaders(e,t){let s=null!=e?e:{};return this.defaultHeaders&&(s=Object.assign(Object.assign({},this.defaultHeaders),e)),s[l.a]?s:Object.assign({[l.a]:t},s)}refreshOnAuthError(){return(void 0!==this.refreshDefaultQueryString||void 0!==this.refreshDefaultHeaders)&&(void 0!==this.refreshDefaultHeaders&&(this.defaultHeaders=this.refreshDefaultHeaders()),void 0!==this.refreshDefaultQueryString&&(this.defaultQueryString=this.refreshDefaultQueryString()),!0)}}},18086:function(e,t,s){"use strict";t.decode=t.parse=s(18087),t.encode=t.stringify=s(18088)},18087:function(e,t,s){"use strict";function n(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,s,i){t=t||"&",s=s||"=";var o={};if("string"!=typeof e||0===e.length)return o;var a=/\+/g;e=e.split(t);var c=1e3;i&&"number"==typeof i.maxKeys&&(c=i.maxKeys);var h=e.length;c>0&&h>c&&(h=c);for(var u=0;u<h;++u){var l,d,p,g,m=e[u].replace(a,"%20"),f=m.indexOf(s);f>=0?(l=m.substr(0,f),d=m.substr(f+1)):(l=m,d=""),p=decodeURIComponent(l),g=decodeURIComponent(d),n(o,p)?r(o[p])?o[p].push(g):o[p]=[o[p],g]:o[p]=g}return o};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},18088:function(e,t,s){"use strict";var n=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,s,a){return t=t||"&",s=s||"=",null===e&&(e=void 0),"object"==typeof e?i(o(e),(function(o){var a=encodeURIComponent(n(o))+s;return r(e[o])?i(e[o],(function(e){return a+encodeURIComponent(n(e))})).join(t):a+encodeURIComponent(n(e[o]))})).join(t):a?encodeURIComponent(n(a))+s+encodeURIComponent(n(e)):""};var r=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function i(e,t){if(e.map)return e.map(t);for(var s=[],n=0;n<e.length;n++)s.push(t(e[n],n));return s}var o=Object.keys||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.push(s);return t}},18089:function(e,t,s){e.exports=s(18090)},18090:function(e,t,s){"use strict";var n=s(18091),r=s(18092),i=s(18093),o=s(18113);var a=function e(t){var s=new i(t),a=r(i.prototype.request,s);return n.extend(a,i.prototype,s),n.extend(a,s),a.create=function(s){return e(o(t,s))},a}(s(18098));a.Axios=i,a.Cancel=s(18111),a.CancelToken=s(18116),a.isCancel=s(18112),a.VERSION=s(18115).version,a.all=function(e){return Promise.all(e)},a.spread=s(18117),a.isAxiosError=s(18118),e.exports=a,e.exports.default=a},18091:function(e,t,s){"use strict";var n=s(18092),r=Object.prototype.toString;function i(e){return Array.isArray(e)}function o(e){return void 0===e}function a(e){return"[object ArrayBuffer]"===r.call(e)}function c(e){return null!==e&&"object"==typeof e}function h(e){if("[object Object]"!==r.call(e))return!1;var t=Object.getPrototypeOf(e);return null===t||t===Object.prototype}function u(e){return"[object Function]"===r.call(e)}function l(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),i(e))for(var s=0,n=e.length;s<n;s++)t.call(null,e[s],s,e);else for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(null,e[r],r,e)}e.exports={isArray:i,isArrayBuffer:a,isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"[object FormData]"===r.call(e)},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&a(e.buffer)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:c,isPlainObject:h,isUndefined:o,isDate:function(e){return"[object Date]"===r.call(e)},isFile:function(e){return"[object File]"===r.call(e)},isBlob:function(e){return"[object Blob]"===r.call(e)},isFunction:u,isStream:function(e){return c(e)&&u(e.pipe)},isURLSearchParams:function(e){return"[object URLSearchParams]"===r.call(e)},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:l,merge:function e(){var t={};function s(s,n){h(t[n])&&h(s)?t[n]=e(t[n],s):h(s)?t[n]=e({},s):i(s)?t[n]=s.slice():t[n]=s}for(var n=0,r=arguments.length;n<r;n++)l(arguments[n],s);return t},extend:function(e,t,s){return l(t,(function(t,r){e[r]=s&&"function"==typeof t?n(t,s):t})),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return 65279===e.charCodeAt(0)&&(e=e.slice(1)),e}}},18092:function(e,t,s){"use strict";e.exports=function(e,t){return function(){for(var s=new Array(arguments.length),n=0;n<s.length;n++)s[n]=arguments[n];return e.apply(t,s)}}},18093:function(e,t,s){"use strict";var n=s(18091),r=s(18094),i=s(18095),o=s(18096),a=s(18113),c=s(18114),h=c.validators;function u(e){this.defaults=e,this.interceptors={request:new i,response:new i}}u.prototype.request=function(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},(t=a(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var s=t.transitional;void 0!==s&&c.assertOptions(s,{silentJSONParsing:h.transitional(h.boolean),forcedJSONParsing:h.transitional(h.boolean),clarifyTimeoutError:h.transitional(h.boolean)},!1);var n=[],r=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(r=r&&e.synchronous,n.unshift(e.fulfilled,e.rejected))}));var i,u=[];if(this.interceptors.response.forEach((function(e){u.push(e.fulfilled,e.rejected)})),!r){var l=[o,void 0];for(Array.prototype.unshift.apply(l,n),l=l.concat(u),i=Promise.resolve(t);l.length;)i=i.then(l.shift(),l.shift());return i}for(var d=t;n.length;){var p=n.shift(),g=n.shift();try{d=p(d)}catch(m){g(m);break}}try{i=o(d)}catch(m){return Promise.reject(m)}for(;u.length;)i=i.then(u.shift(),u.shift());return i},u.prototype.getUri=function(e){return e=a(this.defaults,e),r(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,s){return this.request(a(s||{},{method:e,url:t,data:(s||{}).data}))}})),n.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,s,n){return this.request(a(n||{},{method:e,url:t,data:s}))}})),e.exports=u},18094:function(e,t,s){"use strict";var n=s(18091);function r(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,s){if(!t)return e;var i;if(s)i=s(t);else if(n.isURLSearchParams(t))i=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(r(t)+"="+r(e))})))})),i=o.join("&")}if(i){var a=e.indexOf("#");-1!==a&&(e=e.slice(0,a)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}},18095:function(e,t,s){"use strict";var n=s(18091);function r(){this.handlers=[]}r.prototype.use=function(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!s&&s.synchronous,runWhen:s?s.runWhen:null}),this.handlers.length-1},r.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},r.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=r},18096:function(e,t,s){"use strict";var n=s(18091),r=s(18097),i=s(18112),o=s(18098),a=s(18111);function c(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new a("canceled")}e.exports=function(e){return c(e),e.headers=e.headers||{},e.data=r.call(e,e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return c(e),t.data=r.call(e,t.data,t.headers,e.transformResponse),t}),(function(t){return i(t)||(c(e),t&&t.response&&(t.response.data=r.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},18097:function(e,t,s){"use strict";var n=s(18091),r=s(18098);e.exports=function(e,t,s){var i=this||r;return n.forEach(s,(function(s){e=s.call(i,e,t)})),e}},18098:function(e,t,s){"use strict";(function(t){var n=s(18091),r=s(18099),i=s(18100),o=s(18101),a={"Content-Type":"application/x-www-form-urlencoded"};function c(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var h,u={transitional:o,adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(h=s(18102)),h),transformRequest:[function(e,t){return r(t,"Accept"),r(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(c(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)||t&&"application/json"===t["Content-Type"]?(c(t,"application/json"),function(e,t,s){if(n.isString(e))try{return(t||JSON.parse)(e),n.trim(e)}catch(r){if("SyntaxError"!==r.name)throw r}return(s||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){var t=this.transitional||u.transitional,s=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,o=!s&&"json"===this.responseType;if(o||r&&n.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(o){if("SyntaxError"===a.name)throw i(a,this,"E_JSON_PARSE");throw a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};n.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){u.headers[e]=n.merge(a)})),e.exports=u}).call(this,s(12023))},18099:function(e,t,s){"use strict";var n=s(18091);e.exports=function(e,t){n.forEach(e,(function(s,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=s,delete e[n])}))}},18100:function(e,t,s){"use strict";e.exports=function(e,t,s,n,r){return e.config=t,s&&(e.code=s),e.request=n,e.response=r,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}},e}},18101:function(e,t,s){"use strict";e.exports={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1}},18102:function(e,t,s){"use strict";var n=s(18091),r=s(18103),i=s(18105),o=s(18094),a=s(18106),c=s(18109),h=s(18110),u=s(18104),l=s(18101),d=s(18111);e.exports=function(e){return new Promise((function(t,s){var p,g=e.data,m=e.headers,f=e.responseType;function b(){e.cancelToken&&e.cancelToken.unsubscribe(p),e.signal&&e.signal.removeEventListener("abort",p)}n.isFormData(g)&&delete m["Content-Type"];var v=new XMLHttpRequest;if(e.auth){var y=e.auth.username||"",S=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";m.Authorization="Basic "+btoa(y+":"+S)}var w=a(e.baseURL,e.url);function C(){if(v){var n="getAllResponseHeaders"in v?c(v.getAllResponseHeaders()):null,i={data:f&&"text"!==f&&"json"!==f?v.response:v.responseText,status:v.status,statusText:v.statusText,headers:n,config:e,request:v};r((function(e){t(e),b()}),(function(e){s(e),b()}),i),v=null}}if(v.open(e.method.toUpperCase(),o(w,e.params,e.paramsSerializer),!0),v.timeout=e.timeout,"onloadend"in v?v.onloadend=C:v.onreadystatechange=function(){v&&4===v.readyState&&(0!==v.status||v.responseURL&&0===v.responseURL.indexOf("file:"))&&setTimeout(C)},v.onabort=function(){v&&(s(u("Request aborted",e,"ECONNABORTED",v)),v=null)},v.onerror=function(){s(u("Network Error",e,null,v)),v=null},v.ontimeout=function(){var t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",n=e.transitional||l;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),s(u(t,e,n.clarifyTimeoutError?"ETIMEDOUT":"ECONNABORTED",v)),v=null},n.isStandardBrowserEnv()){var O=(e.withCredentials||h(w))&&e.xsrfCookieName?i.read(e.xsrfCookieName):void 0;O&&(m[e.xsrfHeaderName]=O)}"setRequestHeader"in v&&n.forEach(m,(function(e,t){void 0===g&&"content-type"===t.toLowerCase()?delete m[t]:v.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(v.withCredentials=!!e.withCredentials),f&&"json"!==f&&(v.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&v.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&v.upload&&v.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(p=function(e){v&&(s(!e||e&&e.type?new d("canceled"):e),v.abort(),v=null)},e.cancelToken&&e.cancelToken.subscribe(p),e.signal&&(e.signal.aborted?p():e.signal.addEventListener("abort",p))),g||(g=null),v.send(g)}))}},18103:function(e,t,s){"use strict";var n=s(18104);e.exports=function(e,t,s){var r=s.config.validateStatus;s.status&&r&&!r(s.status)?t(n("Request failed with status code "+s.status,s.config,null,s.request,s)):e(s)}},18104:function(e,t,s){"use strict";var n=s(18100);e.exports=function(e,t,s,r,i){var o=new Error(e);return n(o,t,s,r,i)}},18105:function(e,t,s){"use strict";var n=s(18091);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,s,r,i,o){var a=[];a.push(e+"="+encodeURIComponent(t)),n.isNumber(s)&&a.push("expires="+new Date(s).toGMTString()),n.isString(r)&&a.push("path="+r),n.isString(i)&&a.push("domain="+i),!0===o&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},18106:function(e,t,s){"use strict";var n=s(18107),r=s(18108);e.exports=function(e,t){return e&&!n(t)?r(e,t):t}},18107:function(e,t,s){"use strict";e.exports=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}},18108:function(e,t,s){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},18109:function(e,t,s){"use strict";var n=s(18091),r=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,s,i,o={};return e?(n.forEach(e.split("\n"),(function(e){if(i=e.indexOf(":"),t=n.trim(e.substr(0,i)).toLowerCase(),s=n.trim(e.substr(i+1)),t){if(o[t]&&r.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([s]):o[t]?o[t]+", "+s:s}})),o):o}},18110:function(e,t,s){"use strict";var n=s(18091);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),s=document.createElement("a");function r(e){var n=e;return t&&(s.setAttribute("href",n),n=s.href),s.setAttribute("href",n),{href:s.href,protocol:s.protocol?s.protocol.replace(/:$/,""):"",host:s.host,search:s.search?s.search.replace(/^\?/,""):"",hash:s.hash?s.hash.replace(/^#/,""):"",hostname:s.hostname,port:s.port,pathname:"/"===s.pathname.charAt(0)?s.pathname:"/"+s.pathname}}return e=r(window.location.href),function(t){var s=n.isString(t)?r(t):t;return s.protocol===e.protocol&&s.host===e.host}}():function(){return!0}},18111:function(e,t,s){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},18112:function(e,t,s){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},18113:function(e,t,s){"use strict";var n=s(18091);e.exports=function(e,t){t=t||{};var s={};function r(e,t){return n.isPlainObject(e)&&n.isPlainObject(t)?n.merge(e,t):n.isPlainObject(t)?n.merge({},t):n.isArray(t)?t.slice():t}function i(s){return n.isUndefined(t[s])?n.isUndefined(e[s])?void 0:r(void 0,e[s]):r(e[s],t[s])}function o(e){if(!n.isUndefined(t[e]))return r(void 0,t[e])}function a(s){return n.isUndefined(t[s])?n.isUndefined(e[s])?void 0:r(void 0,e[s]):r(void 0,t[s])}function c(s){return s in t?r(e[s],t[s]):s in e?r(void 0,e[s]):void 0}var h={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:c};return n.forEach(Object.keys(e).concat(Object.keys(t)),(function(e){var t=h[e]||i,r=t(e);n.isUndefined(r)&&t!==c||(s[e]=r)})),s}},18114:function(e,t,s){"use strict";var n=s(18115).version,r={};["object","boolean","number","function","string","symbol"].forEach((function(e,t){r[e]=function(s){return typeof s===e||"a"+(t<1?"n ":" ")+e}}));var i={};r.transitional=function(e,t,s){function r(e,t){return"[Axios v"+n+"] Transitional option '"+e+"'"+t+(s?". "+s:"")}return function(s,n,o){if(!1===e)throw new Error(r(n," has been removed"+(t?" in "+t:"")));return t&&!i[n]&&(i[n]=!0,console.warn(r(n," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(s,n,o)}},e.exports={assertOptions:function(e,t,s){if("object"!=typeof e)throw new TypeError("options must be an object");for(var n=Object.keys(e),r=n.length;r-- >0;){var i=n[r],o=t[i];if(o){var a=e[i],c=void 0===a||o(a,i,e);if(!0!==c)throw new TypeError("option "+i+" must be "+c)}else if(!0!==s)throw Error("Unknown option "+i)}},validators:r}},18115:function(e,t){e.exports={version:"0.26.1"}},18116:function(e,t,s){"use strict";var n=s(18111);function r(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var s=this;this.promise.then((function(e){if(s._listeners){var t,n=s._listeners.length;for(t=0;t<n;t++)s._listeners[t](e);s._listeners=null}})),this.promise.then=function(e){var t,n=new Promise((function(e){s.subscribe(e),t=e})).then(e);return n.cancel=function(){s.unsubscribe(t)},n},e((function(e){s.reason||(s.reason=new n(e),t(s.reason))}))}r.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},r.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},r.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}},r.source=function(){var e;return{token:new r((function(t){e=t})),cancel:e}},e.exports=r},18117:function(e,t,s){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},18118:function(e,t,s){"use strict";var n=s(18091);e.exports=function(e){return n.isObject(e)&&!0===e.isAxiosError}},18119:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(18120),r=s(18123);const i=Object(n.debug)("fluid:services-client");i(`Package: ${r.a} - Version: ${r.b}`)},18120:function(e,t,s){(function(n){t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const s="color: "+this.color;t.splice(1,0,s,"color: inherit");let n=0,r=0;t[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(n++,"%c"===e&&(r=n))}),t.splice(r,0,s)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(s){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(s){}!e&&void 0!==n&&"env"in n&&(e=Object({NODE_ENV:"production",PUBLIC_URL:"",CI:!0,APP:"powerpages-microsoft-com",LOCALES_HASH:"XDT_CZcwhr25",AAD_INSTANCE:{high:"https://login.microsoftonline.us/",dod:"https://login.microsoftonline.us/",mooncake:"https://login.chinacloudapi.cn/",ex:"https://login.microsoftonline.eaglex.ic.gov/",rx:"https://login.microsoftonline.microsoft.scloud/"},SETTINGS_FALLBACK_REGION:{},BUILD_COMMIT_ID:"acb1e176f7c9a8266fd1bc3ec52d279471f99ad2",BUILD_NAME:"0.0.20240520.2-2405.2-prod",BUILD_BRANCH:"2405.2",BUILD_DATE_TIME:"Mon, 20 May 2024 20:51:46 GMT",BUILD_SHELL_VERSION:"1.0.0",_UNSAFE_DONT_USE_BUILD_MODULE_TYPE:"module"}).DEBUG);return e},t.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=s(18121)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}).call(this,s(12023))},18121:function(e,t,s){e.exports=function(e){function t(e){let s,r,i,o=null;function a(...e){if(!a.enabled)return;const n=a,r=Number(new Date),i=r-(s||r);n.diff=i,n.prev=s,n.curr=r,s=r,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let o=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,(s,r)=>{if("%%"===s)return"%";o++;const i=t.formatters[r];if("function"==typeof i){const t=e[o];s=i.call(n,t),e.splice(o,1),o--}return s}),t.formatArgs.call(n,e);(n.log||t.log).apply(n,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=n,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==o?o:(r!==t.namespaces&&(r=t.namespaces,i=t.enabled(e)),i),set:e=>{o=e}}),"function"==typeof t.init&&t.init(a),a}function n(e,s){const n=t(this.namespace+(void 0===s?":":s)+e);return n.log=this.log,n}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},t.disable=function(){const e=[...t.names.map(r),...t.skips.map(r).map(e=>"-"+e)].join(",");return t.enable(""),e},t.enable=function(e){let s;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const n=("string"==typeof e?e:"").split(/[\s,]+/),r=n.length;for(s=0;s<r;s++)n[s]&&("-"===(e=n[s].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let s,n;for(s=0,n=t.skips.length;s<n;s++)if(t.skips[s].test(e))return!1;for(s=0,n=t.names.length;s<n;s++)if(t.names[s].test(e))return!0;return!1},t.humanize=s(18122),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(s=>{t[s]=e[s]}),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let s=0;for(let t=0;t<e.length;t++)s=(s<<5)-s+e.charCodeAt(t),s|=0;return t.colors[Math.abs(s)%t.colors.length]},t.enable(t.load()),t}},18122:function(e,t){var s=1e3,n=6e4,r=60*n,i=24*r;function o(e,t,s,n){var r=t>=1.5*s;return Math.round(e/s)+" "+n+(r?"s":"")}e.exports=function(e,t){t=t||{};var a=typeof e;if("string"===a&&e.length>0)return function(e){if((e=String(e)).length>100)return;var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(!t)return;var o=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return o*i;case"hours":case"hour":case"hrs":case"hr":case"h":return o*r;case"minutes":case"minute":case"mins":case"min":case"m":return o*n;case"seconds":case"second":case"secs":case"sec":case"s":return o*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o;default:return}}(e);if("number"===a&&isFinite(e))return t.long?function(e){var t=Math.abs(e);if(t>=i)return o(e,t,i,"day");if(t>=r)return o(e,t,r,"hour");if(t>=n)return o(e,t,n,"minute");if(t>=s)return o(e,t,s,"second");return e+" ms"}(e):function(e){var t=Math.abs(e);if(t>=i)return Math.round(e/i)+"d";if(t>=r)return Math.round(e/r)+"h";if(t>=n)return Math.round(e/n)+"m";if(t>=s)return Math.round(e/s)+"s";return e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},18123:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return r}));const n="@fluidframework/server-services-client",r="0.1036.5001"},18124:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="x-correlation-id"},18125:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));class n extends Error{constructor(e,t,s,n,r){super(t),this.code=e,this.canRetry=s,this.isFatal=n,this.retryAfterMs=r,this.name="NetworkError",this.retryAfter=void 0!==r?r/1e3:void 0}get details(){return void 0===this.canRetry&&void 0===this.isFatal&&void 0===this.retryAfterMs?this.message:{message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfter:this.retryAfter,retryAfterMs:this.retryAfterMs}}toJSON(){return{code:this.code,message:this.message,canRetry:this.canRetry,isFatal:this.isFatal,retryAfterMs:this.retryAfterMs,retryAfter:this.retryAfter}}}function r(e,t){var s;let r,i,o,a;switch(t&&"object"==typeof t?(r=null!==(s=t.message)&&void 0!==s?s:"Unknown Error",i=t.canRetry,o=t.isFatal,a=t.retryAfter):r=t&&"string"==typeof t?t:"Unknown Error",e){case 401:case 403:case 404:return new n(e,r,!1,!1);case 413:case 422:return new n(e,r,null!=i&&i,null!=o&&o,i?a:void 0);case 429:return new n(e,r,!0,!1,a);case 500:return new n(e,r,null==i||i,null!=o&&o,i?a:void 0);case 502:case 503:case 504:return new n(e,r,!0,!1,a);default:return new n(e,r,!1,!0)}}},18126:function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return i})),function(e){e.Method="method",e.Header="header",e.Body="body"}(n||(n={}));const r=(e,t)=>`${e}: ${t}`;class i{translate(e){var t,s;const i=Object.assign({},e),o=new URLSearchParams;if(o.append(n.Method,null!==(t=i.method)&&void 0!==t?t:"GET"),i.headers)for(const[a,c]of Object.entries(i.headers)){const e=r(a,c);o.append(n.Header,e)}if(i.data&&["post","put","patch"].includes(null===(s=i.method)||void 0===s?void 0:s.toLowerCase())){const e=JSON.stringify(i.data);o.append(n.Body,e)}return i.data=o.toString(),i.method="POST",i.headers={"Content-Type":"application/x-www-form-urlencoded;restless"},i}}},18127:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return c}));var n,r=s(18010),i=s(18128);function o(e,t,s){const o={statusCode:t,driverVersion:i.a};switch(t){case void 0:return new r.c(e,e.startsWith("NetworkError"),o);case 401:case 403:return new r.a(e,void 0,void 0,o);case 404:const t=n.fileNotFoundOrAccessDeniedError;return new r.d(e,t,o);case 429:return Object(r.g)(e,{canRetry:!0,retryAfterMs:s},o);case 500:case 502:return new r.c(e,!0,o);default:const i={canRetry:void 0!==s,retryAfterMs:s};return Object(r.g)(e,i,o)}}function a(e,t,s){throw o(e,t,s)}function c(e,t){return o(`R11s socket error (${t}): ${e.message}`,e.code,e.retryAfterMs)}!function(e){e.fileNotFoundOrAccessDeniedError="fileNotFoundOrAccessDeniedError"}(n||(n={}))},18128:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="1.3.6"},18129:function(e,t,s){"use strict";s.d(t,"b",(function(){return o})),s.d(t,"a",(function(){return a}));var n=s(17992),r=s(18085);function i(e,t){for(const s of t)if(e.endsWith(s))return!0;return!1}const o=e=>"Basic "+Object(n.b)(`${e.user}:${e.password}`);class a{constructor(e,t,s,n){this.endpoint=e,this.historianApi=t,this.restWrapper=n,this.defaultQueryString={},s&&this.historianApi?(this.defaultQueryString.disableCache=s,this.cacheBust=!1):this.cacheBust=s,void 0===this.restWrapper&&(this.restWrapper=new r.a(this.endpoint))}async getHeader(e){return this.historianApi?this.restWrapper.get("/headers/"+encodeURIComponent(e),this.getQueryString()):this.getHeaderDirect(e)}async getFullTree(e){return this.restWrapper.get("/tree/"+encodeURIComponent(e),this.getQueryString())}async getBlob(e){return this.restWrapper.get("/git/blobs/"+encodeURIComponent(e),this.getQueryString())}async createBlob(e){return this.restWrapper.post("/git/blobs",e,this.getQueryString())}async getContent(e,t){return this.restWrapper.get("/contents/"+e,this.getQueryString({ref:t}))}async getCommits(e,t){return this.restWrapper.get("/commits",this.getQueryString({count:t,sha:e})).catch(e=>400===e||404===e?[]:Promise.reject(e))}async getCommit(e){return this.restWrapper.get("/git/commits/"+encodeURIComponent(e),this.getQueryString())}async createCommit(e){return this.restWrapper.post("/git/commits",e,this.getQueryString())}async getRefs(){return this.restWrapper.get("/git/refs",this.getQueryString())}async getRef(e){return this.restWrapper.get("/git/refs/"+e,this.getQueryString())}async createRef(e){return this.restWrapper.post("/git/refs",e,this.getQueryString())}async updateRef(e,t){return this.restWrapper.patch("/git/refs/"+e,t,this.getQueryString())}async deleteRef(e){await this.restWrapper.delete("/git/refs/"+e,this.getQueryString())}async createTag(e){return this.restWrapper.post("/git/tags",e,this.getQueryString())}async getTag(e){return this.restWrapper.get("/git/tags/"+e,this.getQueryString())}async createTree(e){return this.restWrapper.post("/git/trees",e,this.getQueryString())}async getTree(e,t){return this.restWrapper.get("/git/trees/"+encodeURIComponent(e),this.getQueryString({recursive:t?1:0}))}async createSummary(e){return this.restWrapper.post("/git/summaries",e,this.getQueryString())}async deleteSummary(e){const t={"Soft-Delete":e};return this.restWrapper.delete("/git/summaries",this.getQueryString(),t)}async getSummary(e){return this.restWrapper.get("/git/summaries/"+e,this.getQueryString())}async getHeaderDirect(e){const t=await this.getTree(e,!0),s=[".attributes",".blobs",".messages","header"],n=[];for(const r of t.tree)if("blob"===r.type&&i(r.path,s)){const e=this.getBlob(r.sha);n.push(e)}return{blobs:await Promise.all(n),tree:t}}getQueryString(e){return this.cacheBust?Object.assign(Object.assign({cacheBust:Date.now()},this.defaultQueryString),e):Object.assign(Object.assign({},this.defaultQueryString),e)}}},18130:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(17983),r=s(17981);function i(e){const t=Object.keys(e.tree);for(const s of t){const t=e.tree[s];switch(t.type){case r.a.Tree:e.tree[s]=i(t);break;case r.a.Blob:t.content="string"==typeof t.content?t.content:Object(n.b)(t.content,"utf8");break;case r.a.Handle:throw new Error("No handle should be present for first summary!!");default:throw new Error("Unknown tree type "+t.type)}}return e}},18131:function(e,t,s){"use strict";s.d(t,"a",(function(){return m}));var n=s(17940),r=s(18163),i=s(18081),o=s(18129),a=s(18162),c=s(18132),h=s(17944),u=s(18176),l=s(18164),d=s(18179),p=s(18161),g=s(18082);class m{constructor(e,t,s,n,r,i,o,a,c,h,u,l){this._resolvedUrl=e,this.ordererUrl=t,this.deltaStorageUrl=s,this.storageUrl=n,this.logger=r,this.tokenProvider=i,this.tenantId=o,this.documentId=a,this.driverPolicies=c,this.blobCache=h,this.snapshotTreeCache=u,this.discoverFluidResolvedUrl=l,this.lastDiscoveredAt=Date.now()}get resolvedUrl(){return this._resolvedUrl}dispose(){}async connectToStorage(){if(void 0!==this.documentStorageService)return this.documentStorageService;if(void 0===this.storageUrl)return new p.a;const e=async e=>{const t=this.shouldUpdateDiscoveredSessionInfo();if(t&&await this.refreshDiscovery(),!this.storageManager||!this.noCacheStorageManager||t){const e=new i.a(this.driverPolicies.maxConcurrentStorageRequests),t=await g.b.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,e,this.driverPolicies.enableRestLess,this.storageUrl),s=new o.a(this.storageUrl,!0,!1,t);this.storageManager=new a.a(s);const n=new o.a(this.storageUrl,!0,!0,t);this.noCacheStorageManager=new a.a(n)}return e?this.noCacheStorageManager:this.storageManager},t=await e(),s=await e(!0),n={caching:this.driverPolicies.enablePrefetch?r.a.Prefetch:r.a.NoCaching,minBlobSize:this.driverPolicies.aggregateBlobsSmallerThanBytes};return this.documentStorageService=new l.a(this.documentId,t,this.logger,n,this.driverPolicies,this.blobCache,this.snapshotTreeCache,s,e),this.documentStorageService}async connectToDeltaStorage(){await this.connectToStorage(),Object(n.a)(!!this.documentStorageService,177);const e=async()=>{const e=this.shouldUpdateDiscoveredSessionInfo();if(e&&await this.refreshDiscovery(),!this.ordererRestWrapper||e){const e=new i.a(this.driverPolicies.maxConcurrentOrdererRequests);this.ordererRestWrapper=await g.a.load(this.tenantId,this.documentId,this.tokenProvider,this.logger,e,this.driverPolicies.enableRestLess)}return this.ordererRestWrapper},t=await e(),s=new u.a(this.deltaStorageUrl,t,this.logger,e,()=>this.deltaStorageUrl);return new u.b(this.tenantId,this.documentId,s,this.documentStorageService)}async connectToDeltaStream(e){const t=async t=>{this.shouldUpdateDiscoveredSessionInfo()&&await this.refreshDiscovery();const s=await this.tokenProvider.fetchOrdererToken(this.tenantId,this.documentId,t);return d.a.create(this.tenantId,this.documentId,s.jwt,c.a,e,this.ordererUrl,this.logger)};try{return await t()}catch(s){if(401===(null==s?void 0:s.statusCode))return t(!0);throw s}}async refreshDiscovery(){return this.discoverP||(this.discoverP=h.c.timedExecAsync(this.logger,{eventName:"refreshSessionDiscovery"},async()=>this.refreshDiscoveryCore())),this.discoverP}async refreshDiscoveryCore(){const e=await this.discoverFluidResolvedUrl();this._resolvedUrl=e,this.storageUrl=e.endpoints.storageUrl,this.ordererUrl=e.endpoints.ordererUrl,this.deltaStorageUrl=e.endpoints.deltaStorageUrl}shouldUpdateDiscoveredSessionInfo(){if(!this.driverPolicies.enableDiscovery)return!1;const e=Date.now()-this.lastDiscoveredAt>3e5;return e&&(this.lastDiscoveredAt=Date.now(),this.discoverP=void 0,this.refreshDiscovery().catch(()=>{this.lastDiscoveredAt=0})),e}}},18132:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(18133),r=s(18154),i=s(18155);s(18156);const o={};function a(e,t){"object"==typeof e&&(t=e,e=void 0),t=t||{};const s=Object(n.a)(e,t.path||"/socket.io"),i=s.source,a=s.id,c=s.path,h=o[a]&&c in o[a].nsps;let u;return t.forceNew||t["force new connection"]||!1===t.multiplex||h?u=new r.a(i,t):(o[a]||(o[a]=new r.a(i,t)),u=o[a]),s.query&&!t.query&&(t.query=s.queryKey),u.socket(s.path,t)}Object.assign(a,{Manager:r.a,Socket:i.a,io:a,connect:a})},18133:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18134);function r(e,t="",s){let r=e;s=s||"undefined"!=typeof location&&location,null==e&&(e=s.protocol+"//"+s.host),"string"==typeof e&&("/"===e.charAt(0)&&(e="/"===e.charAt(1)?s.protocol+e:s.host+e),/^(https?|wss?):\/\//.test(e)||(e=void 0!==s?s.protocol+"//"+e:"https://"+e),r=Object(n.d)(e)),r.port||(/^(http|ws)$/.test(r.protocol)?r.port="80":/^(http|ws)s$/.test(r.protocol)&&(r.port="443")),r.path=r.path||"/";const i=-1!==r.host.indexOf(":")?"["+r.host+"]":r.host;return r.id=r.protocol+"://"+i+":"+r.port+t,r.href=r.protocol+"://"+i+(s&&s.port===r.port?"":":"+r.port),r}},18134:function(e,t,s){"use strict";var n=s(18135);s.d(t,"a",(function(){return n.a}));s(18138),s(18136);var r=s(18145);s.d(t,"b",(function(){return r.b}));var i=s(18153);s.d(t,"d",(function(){return i.a}));var o=s(18152);s.d(t,"c",(function(){return o.c}));n.a.protocol},18135:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var n=s(18136),r=s(18145),i=s(18148),o=s(18153),a=s(18144),c=s(18139);class h extends a.a{constructor(e,t={}){super(),this.writeBuffer=[],e&&"object"==typeof e&&(t=e,e=null),e?(e=Object(o.a)(e),t.hostname=e.host,t.secure="https"===e.protocol||"wss"===e.protocol,t.port=e.port,e.query&&(t.query=e.query)):t.host&&(t.hostname=Object(o.a)(t.host).host),Object(r.b)(this,t),this.secure=null!=t.secure?t.secure:"undefined"!=typeof location&&"https:"===location.protocol,t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||("undefined"!=typeof location?location.hostname:"localhost"),this.port=t.port||("undefined"!=typeof location&&location.port?location.port:this.secure?"443":"80"),this.transports=t.transports||["polling","websocket"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!0},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),"string"==typeof this.opts.query&&(this.opts.query=Object(i.a)(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,"function"==typeof addEventListener&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),"localhost"!==this.hostname&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=c.e,t.transport=e,this.id&&(t.sid=this.id);const s=Object.assign({},this.opts.transportOptions[e],this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port});return new n.a[e](s)}open(){let e;if(this.opts.rememberUpgrade&&h.priorWebsocketSuccess&&-1!==this.transports.indexOf("websocket"))e="websocket";else{if(0===this.transports.length)return void this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);e=this.transports[0]}this.readyState="opening";try{e=this.createTransport(e)}catch(t){return this.transports.shift(),void this.open()}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",e=>this.onClose("transport close",e))}probe(e){let t=this.createTransport(e),s=!1;h.priorWebsocketSuccess=!1;const n=()=>{s||(t.send([{type:"ping",data:"probe"}]),t.once("packet",e=>{if(!s)if("pong"===e.type&&"probe"===e.data){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;h.priorWebsocketSuccess="websocket"===t.name,this.transport.pause(()=>{s||"closed"!==this.readyState&&(u(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const e=new Error("probe error");e.transport=t.name,this.emitReserved("upgradeError",e)}}))};function r(){s||(s=!0,u(),t.close(),t=null)}const i=e=>{const s=new Error("probe error: "+e);s.transport=t.name,r(),this.emitReserved("upgradeError",s)};function o(){i("transport closed")}function a(){i("socket closed")}function c(e){t&&e.name!==t.name&&r()}const u=()=>{t.removeListener("open",n),t.removeListener("error",i),t.removeListener("close",o),this.off("close",a),this.off("upgrading",c)};t.once("open",n),t.once("error",i),t.once("close",o),this.once("close",a),this.once("upgrading",c),t.open()}onOpen(){if(this.readyState="open",h.priorWebsocketSuccess="websocket"===this.transport.name,this.emitReserved("open"),this.flush(),"open"===this.readyState&&this.opts.upgrade){let e=0;const t=this.upgrades.length;for(;e<t;e++)this.probe(this.upgrades[e])}}onPacket(e){if("opening"===this.readyState||"open"===this.readyState||"closing"===this.readyState)switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.resetPingTimeout(),this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const t=new Error("server error");t.code=e.data,this.onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data)}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),"closed"!==this.readyState&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,0===this.writeBuffer.length?this.emitReserved("drain"):this.flush()}flush(){if("closed"!==this.readyState&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&"polling"===this.transport.name&&this.writeBuffer.length>1))return this.writeBuffer;let e=1;for(let t=0;t<this.writeBuffer.length;t++){const s=this.writeBuffer[t].data;if(s&&(e+=Object(r.a)(s)),t>0&&e>this.maxPayload)return this.writeBuffer.slice(0,t);e+=2}return this.writeBuffer}write(e,t,s){return this.sendPacket("message",e,t,s),this}send(e,t,s){return this.sendPacket("message",e,t,s),this}sendPacket(e,t,s,n){if("function"==typeof t&&(n=t,t=void 0),"function"==typeof s&&(n=s,s=null),"closing"===this.readyState||"closed"===this.readyState)return;(s=s||{}).compress=!1!==s.compress;const r={type:e,data:t,options:s};this.emitReserved("packetCreate",r),this.writeBuffer.push(r),n&&this.once("flush",n),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},s=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return"opening"!==this.readyState&&"open"!==this.readyState||(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():e()}):this.upgrading?s():e()),this}onError(e){h.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,t){"opening"!==this.readyState&&"open"!==this.readyState&&"closing"!==this.readyState||(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),"function"==typeof removeEventListener&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const t=[];let s=0;const n=e.length;for(;s<n;s++)~this.transports.indexOf(e[s])&&t.push(e[s]);return t}}h.protocol=c.e},18136:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18137);const r={websocket:s(18151).a,polling:n.a}},18137:function(e,t,s){"use strict";s.d(t,"a",(function(){return p}));var n=s(18138),r=s(18147),i=s(18148),o=s(18139),a=s(18149),c=s(18144),h=s(18145),u=s(18146);function l(){}const d=null!=new a.a({xdomain:!1}).responseType;class p extends n.a{constructor(e){if(super(e),this.polling=!1,"undefined"!=typeof location){const t="https:"===location.protocol;let s=location.port;s||(s=t?"443":"80"),this.xd="undefined"!=typeof location&&e.hostname!==location.hostname||s!==e.port,this.xs=e.secure!==t}const t=e&&e.forceBase64;this.supportsBinary=d&&!t}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let e=0;this.polling&&(e++,this.once("pollComplete",(function(){--e||t()}))),this.writable||(e++,this.once("drain",(function(){--e||t()})))}else t()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){Object(o.b)(e,this.socket.binaryType).forEach(e=>{if("opening"===this.readyState&&"open"===e.type&&this.onOpen(),"close"===e.type)return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(e)}),"closed"!==this.readyState&&(this.polling=!1,this.emitReserved("pollComplete"),"open"===this.readyState&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};"open"===this.readyState?e():this.once("open",e)}write(e){this.writable=!1,Object(o.d)(e,e=>{this.doWrite(e,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){let e=this.query||{};const t=this.opts.secure?"https":"http";let s="";!1!==this.opts.timestampRequests&&(e[this.opts.timestampParam]=Object(r.a)()),this.supportsBinary||e.sid||(e.b64=1),this.opts.port&&("https"===t&&443!==Number(this.opts.port)||"http"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port);const n=Object(i.b)(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(n.length?"?"+n:"")}request(e={}){return Object.assign(e,{xd:this.xd,xs:this.xs},this.opts),new g(this.uri(),e)}doWrite(e,t){const s=this.request({method:"POST",data:e});s.on("success",t),s.on("error",(e,t)=>{this.onError("xhr post error",e,t)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(e,t)=>{this.onError("xhr poll error",e,t)}),this.pollXhr=e}}class g extends c.a{constructor(e,t){super(),Object(h.b)(this,t),this.opts=t,this.method=t.method||"GET",this.uri=e,this.async=!1!==t.async,this.data=void 0!==t.data?t.data:null,this.create()}create(){const e=Object(h.c)(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");e.xdomain=!!this.opts.xd,e.xscheme=!!this.opts.xs;const t=this.xhr=new a.a(e);try{t.open(this.method,this.uri,this.async);try{if(this.opts.extraHeaders){t.setDisableHeaderCheck&&t.setDisableHeaderCheck(!0);for(let e in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(e)&&t.setRequestHeader(e,this.opts.extraHeaders[e])}}catch(s){}if("POST"===this.method)try{t.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch(s){}try{t.setRequestHeader("Accept","*/*")}catch(s){}"withCredentials"in t&&(t.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(t.timeout=this.opts.requestTimeout),t.onreadystatechange=()=>{4===t.readyState&&(200===t.status||1223===t.status?this.onLoad():this.setTimeoutFn(()=>{this.onError("number"==typeof t.status?t.status:0)},0))},t.send(this.data)}catch(s){return void this.setTimeoutFn(()=>{this.onError(s)},0)}"undefined"!=typeof document&&(this.index=g.requestsCount++,g.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(void 0!==this.xhr&&null!==this.xhr){if(this.xhr.onreadystatechange=l,e)try{this.xhr.abort()}catch(t){}"undefined"!=typeof document&&delete g.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;null!==e&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}if(g.requestsCount=0,g.requests={},"undefined"!=typeof document)if("function"==typeof attachEvent)attachEvent("onunload",m);else if("function"==typeof addEventListener){const e="onpagehide"in u.a?"pagehide":"unload";addEventListener(e,m,!1)}function m(){for(let e in g.requests)g.requests.hasOwnProperty(e)&&g.requests[e].abort()}},18138:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(18139),r=s(18144),i=s(18145);class o extends Error{constructor(e,t,s){super(e),this.description=t,this.context=s,this.type="TransportError"}}class a extends r.a{constructor(e){super(),this.writable=!1,Object(i.b)(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,t,s){return super.emitReserved("error",new o(e,t,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return"opening"!==this.readyState&&"open"!==this.readyState||(this.doClose(),this.onClose()),this}send(e){"open"===this.readyState&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Object(n.a)(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}}},18139:function(e,t,s){"use strict";s.d(t,"e",(function(){return c})),s.d(t,"d",(function(){return o})),s.d(t,"b",(function(){return a}));var n=s(18140);s.d(t,"c",(function(){return n.a}));var r=s(18142);s.d(t,"a",(function(){return r.a}));const i=String.fromCharCode(30),o=(e,t)=>{const s=e.length,r=new Array(s);let o=0;e.forEach((e,a)=>{Object(n.a)(e,!1,e=>{r[a]=e,++o===s&&t(r.join(i))})})},a=(e,t)=>{const s=e.split(i),n=[];for(let i=0;i<s.length;i++){const e=Object(r.a)(s[i],t);if(n.push(e),"error"===e.type)break}return n},c=4},18140:function(e,t,s){"use strict";var n=s(18141);const r="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===Object.prototype.toString.call(Blob),i="function"==typeof ArrayBuffer,o=(e,t)=>{const s=new FileReader;return s.onload=function(){const e=s.result.split(",")[1];t("b"+(e||""))},s.readAsDataURL(e)};t.a=({type:e,data:t},s,a)=>{return r&&t instanceof Blob?s?a(t):o(t,a):i&&(t instanceof ArrayBuffer||(c=t,"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(c):c&&c.buffer instanceof ArrayBuffer))?s?a(t):o(new Blob([t]),a):a(n.b[e]+(t||""));var c}},18141:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"c",(function(){return r})),s.d(t,"a",(function(){return i}));const n=Object.create(null);n.open="0",n.close="1",n.ping="2",n.pong="3",n.message="4",n.upgrade="5",n.noop="6";const r=Object.create(null);Object.keys(n).forEach(e=>{r[n[e]]=e});const i={type:"error",data:"parser error"}},18142:function(e,t,s){"use strict";var n=s(18141),r=s(18143);const i="function"==typeof ArrayBuffer,o=(e,t)=>{if(i){const s=Object(r.a)(e);return a(s,t)}return{base64:!0,data:e}},a=(e,t)=>{switch(t){case"blob":return e instanceof ArrayBuffer?new Blob([e]):e;case"arraybuffer":default:return e}};t.a=(e,t)=>{if("string"!=typeof e)return{type:"message",data:a(e,t)};const s=e.charAt(0);if("b"===s)return{type:"message",data:o(e.substring(1),t)};return n.c[s]?e.length>1?{type:n.c[s],data:e.substring(1)}:{type:n.c[s]}:n.a}},18143:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r="undefined"==typeof Uint8Array?[]:new Uint8Array(256);for(let o=0;o<n.length;o++)r[n.charCodeAt(o)]=o;const i=e=>{let t,s,n,i,o,a=.75*e.length,c=e.length,h=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);const u=new ArrayBuffer(a),l=new Uint8Array(u);for(t=0;t<c;t+=4)s=r[e.charCodeAt(t)],n=r[e.charCodeAt(t+1)],i=r[e.charCodeAt(t+2)],o=r[e.charCodeAt(t+3)],l[h++]=s<<2|n>>4,l[h++]=(15&n)<<4|i>>2,l[h++]=(3&i)<<6|63&o;return u}},18144:function(e,t,s){"use strict";function n(e){if(e)return function(e){for(var t in n.prototype)e[t]=n.prototype[t];return e}(e)}s.d(t,"a",(function(){return n})),n.prototype.on=n.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this},n.prototype.once=function(e,t){function s(){this.off(e,s),t.apply(this,arguments)}return s.fn=t,this.on(e,s),this},n.prototype.off=n.prototype.removeListener=n.prototype.removeAllListeners=n.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var s,n=this._callbacks["$"+e];if(!n)return this;if(1==arguments.length)return delete this._callbacks["$"+e],this;for(var r=0;r<n.length;r++)if((s=n[r])===t||s.fn===t){n.splice(r,1);break}return 0===n.length&&delete this._callbacks["$"+e],this},n.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),s=this._callbacks["$"+e],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(s){n=0;for(var r=(s=s.slice(0)).length;n<r;++n)s[n].apply(this,t)}return this},n.prototype.emitReserved=n.prototype.emit,n.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]},n.prototype.hasListeners=function(e){return!!this.listeners(e).length}},18145:function(e,t,s){"use strict";s.d(t,"c",(function(){return r})),s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return c}));var n=s(18146);function r(e,...t){return t.reduce((t,s)=>(e.hasOwnProperty(s)&&(t[s]=e[s]),t),{})}const i=n.a.setTimeout,o=n.a.clearTimeout;function a(e,t){t.useNativeTimers?(e.setTimeoutFn=i.bind(n.a),e.clearTimeoutFn=o.bind(n.a)):(e.setTimeoutFn=n.a.setTimeout.bind(n.a),e.clearTimeoutFn=n.a.clearTimeout.bind(n.a))}function c(e){return"string"==typeof e?function(e){let t=0,s=0;for(let n=0,r=e.length;n<r;n++)t=e.charCodeAt(n),t<128?s+=1:t<2048?s+=2:t<55296||t>=57344?s+=3:(n++,s+=4);return s}(e):Math.ceil(1.33*(e.byteLength||e.size))}},18146:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="undefined"!=typeof self?self:"undefined"!=typeof window?window:Function("return this")()},18147:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));const n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),r={};let i,o=0,a=0;function c(e){let t="";do{t=n[e%64]+t,e=Math.floor(e/64)}while(e>0);return t}function h(){const e=c(+new Date);return e!==i?(o=0,i=e):e+"."+c(o++)}for(;a<64;a++)r[n[a]]=a},18148:function(e,t,s){"use strict";function n(e){let t="";for(let s in e)e.hasOwnProperty(s)&&(t.length&&(t+="&"),t+=encodeURIComponent(s)+"="+encodeURIComponent(e[s]));return t}function r(e){let t={},s=e.split("&");for(let n=0,r=s.length;n<r;n++){let e=s[n].split("=");t[decodeURIComponent(e[0])]=decodeURIComponent(e[1])}return t}s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return r}))},18149:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(18150),r=s(18146);function i(e){const t=e.xdomain;try{if("undefined"!=typeof XMLHttpRequest&&(!t||n.a))return new XMLHttpRequest}catch(s){}if(!t)try{return new(r.a[["Active"].concat("Object").join("X")])("Microsoft.XMLHTTP")}catch(s){}}},18150:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));let n=!1;try{n="undefined"!=typeof XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}catch(i){}const r=n},18151:function(e,t,s){"use strict";(function(e){s.d(t,"a",(function(){return u}));var n=s(18138),r=s(18148),i=s(18147),o=s(18145),a=s(18152),c=s(18139);const h="undefined"!=typeof navigator&&"string"==typeof navigator.product&&"reactnative"===navigator.product.toLowerCase();class u extends n.a{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),t=this.opts.protocols,s=h?{}:Object(o.c)(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=a.d&&!h?t?new a.a(e,t):new a.a(e):new a.a(e,t,s)}catch(n){return this.emitReserved("error",n)}this.ws.binaryType=this.socket.binaryType||a.b,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(t){this.writable=!1;for(let s=0;s<t.length;s++){const n=t[s],r=s===t.length-1;Object(c.c)(n,this.supportsBinary,t=>{const s={};if(!a.d&&(n.options&&(s.compress=n.options.compress),this.opts.perMessageDeflate)){("string"==typeof t?e.byteLength(t):t.length)<this.opts.perMessageDeflate.threshold&&(s.compress=!1)}try{a.d?this.ws.send(t):this.ws.send(t,s)}catch(i){}r&&Object(a.c)(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){void 0!==this.ws&&(this.ws.close(),this.ws=null)}uri(){let e=this.query||{};const t=this.opts.secure?"wss":"ws";let s="";this.opts.port&&("wss"===t&&443!==Number(this.opts.port)||"ws"===t&&80!==Number(this.opts.port))&&(s=":"+this.opts.port),this.opts.timestampRequests&&(e[this.opts.timestampParam]=Object(i.a)()),this.supportsBinary||(e.b64=1);const n=Object(r.b)(e);return t+"://"+(-1!==this.opts.hostname.indexOf(":")?"["+this.opts.hostname+"]":this.opts.hostname)+s+this.opts.path+(n.length?"?"+n:"")}check(){return!!a.a}}}).call(this,s(14397).Buffer)},18152:function(e,t,s){"use strict";s.d(t,"c",(function(){return r})),s.d(t,"a",(function(){return i})),s.d(t,"d",(function(){return o})),s.d(t,"b",(function(){return a}));var n=s(18146);const r="function"==typeof Promise&&"function"==typeof Promise.resolve?e=>Promise.resolve().then(e):(e,t)=>t(e,0),i=n.a.WebSocket||n.a.MozWebSocket,o=!0,a="arraybuffer"},18153:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));const n=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,r=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function i(e){const t=e,s=e.indexOf("["),i=e.indexOf("]");-1!=s&&-1!=i&&(e=e.substring(0,s)+e.substring(s,i).replace(/:/g,";")+e.substring(i,e.length));let o=n.exec(e||""),a={},c=14;for(;c--;)a[r[c]]=o[c]||"";return-1!=s&&-1!=i&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=function(e,t){const s=t.replace(/\/{2,9}/g,"/").split("/");"/"!=t.slice(0,1)&&0!==t.length||s.splice(0,1);"/"==t.slice(-1)&&s.splice(s.length-1,1);return s}(0,a.path),a.queryKey=function(e,t){const s={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,(function(e,t,n){t&&(s[t]=n)})),s}(0,a.query),a}},18154:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var n=s(18134),r=s(18155),i=s(18156),o=s(18159),a=s(18160),c=s(18144);class h extends c.a{constructor(e,t){var s;super(),this.nsps={},this.subs=[],e&&"object"==typeof e&&(t=e,e=void 0),(t=t||{}).path=t.path||"/socket.io",this.opts=t,Object(n.b)(this,t),this.reconnection(!1!==t.reconnection),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor(null!==(s=t.randomizationFactor)&&void 0!==s?s:.5),this.backoff=new a.a({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(null==t.timeout?2e4:t.timeout),this._readyState="closed",this.uri=e;const r=t.parser||i;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=!1!==t.autoConnect,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return void 0===e?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return void 0===e?this._reconnectionDelay:(this._reconnectionDelay=e,null===(t=this.backoff)||void 0===t||t.setMin(e),this)}randomizationFactor(e){var t;return void 0===e?this._randomizationFactor:(this._randomizationFactor=e,null===(t=this.backoff)||void 0===t||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return void 0===e?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,null===(t=this.backoff)||void 0===t||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&0===this.backoff.attempts&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new n.a(this.uri,this.opts);const t=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=Object(o.a)(t,"open",(function(){s.onopen(),e&&e()})),i=Object(o.a)(t,"error",t=>{s.cleanup(),s._readyState="closed",this.emitReserved("error",t),e?e(t):s.maybeReconnectOnOpen()});if(!1!==this._timeout){const e=this._timeout;0===e&&r();const s=this.setTimeoutFn(()=>{r(),t.close(),t.emit("error",new Error("timeout"))},e);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}return this.subs.push(r),this.subs.push(i),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Object(o.a)(e,"ping",this.onping.bind(this)),Object(o.a)(e,"data",this.ondata.bind(this)),Object(o.a)(e,"error",this.onerror.bind(this)),Object(o.a)(e,"close",this.onclose.bind(this)),Object(o.a)(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){Object(n.c)(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let s=this.nsps[e];return s?this._autoConnect&&!s.active&&s.connect():(s=new r.a(this,e,t),this.nsps[e]=s),s}_destroy(e){const t=Object.keys(this.nsps);for(const s of t){if(this.nsps[s].active)return}this._close()}_packet(e){const t=this.encoder.encode(e);for(let s=0;s<t.length;s++)this.engine.write(t[s],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,t){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),e.skipReconnect||e.open(t=>{t?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",t)):e.onreconnect()}))},t);this.opts.autoUnref&&s.unref(),this.subs.push((function(){clearTimeout(s)}))}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}},18155:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(18156),r=s(18159),i=s(18144);const o=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class a extends i.a{constructor(e,t,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Object(r.a)(e,"open",this.onopen.bind(this)),Object(r.a)(e,"packet",this.onpacket.bind(this)),Object(r.a)(e,"error",this.onerror.bind(this)),Object(r.a)(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected||(this.subEvents(),this.io._reconnecting||this.io.open(),"open"===this.io._readyState&&this.onopen()),this}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){if(o.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const s={type:n.PacketType.EVENT,data:t,options:{}};if(s.options.compress=!1!==this.flags.compress,"function"==typeof t[t.length-1]){const e=this.ids++,n=t.pop();this._registerAckCallback(e,n),s.id=e}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(s),this.packet(s)):this.sendBuffer.push(s)),this.flags={},this}_registerAckCallback(e,t){var s;const n=null!==(s=this.flags.timeout)&&void 0!==s?s:this._opts.ackTimeout;if(void 0===n)return void(this.acks[e]=t);const r=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let t=0;t<this.sendBuffer.length;t++)this.sendBuffer[t].id===e&&this.sendBuffer.splice(t,1);t.call(this,new Error("operation has timed out"))},n);this.acks[e]=(...e)=>{this.io.clearTimeoutFn(r),t.apply(this,[null,...e])}}emitWithAck(e,...t){const s=void 0!==this.flags.timeout||void 0!==this._opts.ackTimeout;return new Promise((n,r)=>{t.push((e,t)=>s?e?r(e):n(t):n(e)),this.emit(e,...t)})}_addToQueue(e){let t;"function"==typeof e[e.length-1]&&(t=e.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((e,...n)=>{if(s!==this._queue[0])return;return null!==e?s.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(e)):(this._queue.shift(),t&&t(null,...n)),s.pending=!1,this._drainQueue()}),this._queue.push(s),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||0===this._queue.length)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){"function"==typeof this.auth?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:n.PacketType.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case n.PacketType.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case n.PacketType.EVENT:case n.PacketType.BINARY_EVENT:this.onevent(e);break;case n.PacketType.ACK:case n.PacketType.BINARY_ACK:this.onack(e);break;case n.PacketType.DISCONNECT:this.ondisconnect();break;case n.PacketType.CONNECT_ERROR:this.destroy();const t=new Error(e.data.message);t.data=e.data.data,this.emitReserved("connect_error",t)}}onevent(e){const t=e.data||[];null!=e.id&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const s of t)s.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&"string"==typeof e[e.length-1]&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let s=!1;return function(...r){s||(s=!0,t.packet({type:n.PacketType.ACK,id:e,data:r}))}}onack(e){const t=this.acks[e.id];"function"==typeof t&&(t.apply(this,e.data),delete this.acks[e.id])}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:n.PacketType.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let s=0;s<t.length;s++)if(e===t[s])return t.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const s of t)s.apply(this,e.data)}}}},18156:function(e,t,s){"use strict";s.r(t),s.d(t,"protocol",(function(){return o})),s.d(t,"PacketType",(function(){return a})),s.d(t,"Encoder",(function(){return c})),s.d(t,"Decoder",(function(){return h}));var n=s(18144),r=s(18157),i=s(18158);const o=5;var a;!function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"}(a||(a={}));class c{constructor(e){this.replacer=e}encode(e){return e.type!==a.EVENT&&e.type!==a.ACK||!Object(i.a)(e)?[this.encodeAsString(e)]:this.encodeAsBinary({type:e.type===a.EVENT?a.BINARY_EVENT:a.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id})}encodeAsString(e){let t=""+e.type;return e.type!==a.BINARY_EVENT&&e.type!==a.BINARY_ACK||(t+=e.attachments+"-"),e.nsp&&"/"!==e.nsp&&(t+=e.nsp+","),null!=e.id&&(t+=e.id),null!=e.data&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Object(r.a)(e),s=this.encodeAsString(t.packet),n=t.buffers;return n.unshift(s),n}}class h extends n.a{constructor(e){super(),this.reviver=e}add(e){let t;if("string"==typeof e){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const s=t.type===a.BINARY_EVENT;s||t.type===a.BINARY_ACK?(t.type=s?a.EVENT:a.ACK,this.reconstructor=new u(t),0===t.attachments&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else{if(!Object(i.b)(e)&&!e.base64)throw new Error("Unknown type: "+e);if(!this.reconstructor)throw new Error("got binary data when not reconstructing a packet");t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t))}}decodeString(e){let t=0;const s={type:Number(e.charAt(0))};if(void 0===a[s.type])throw new Error("unknown packet type "+s.type);if(s.type===a.BINARY_EVENT||s.type===a.BINARY_ACK){const n=t+1;for(;"-"!==e.charAt(++t)&&t!=e.length;);const r=e.substring(n,t);if(r!=Number(r)||"-"!==e.charAt(t))throw new Error("Illegal attachments");s.attachments=Number(r)}if("/"===e.charAt(t+1)){const n=t+1;for(;++t;){if(","===e.charAt(t))break;if(t===e.length)break}s.nsp=e.substring(n,t)}else s.nsp="/";const n=e.charAt(t+1);if(""!==n&&Number(n)==n){const n=t+1;for(;++t;){const s=e.charAt(t);if(null==s||Number(s)!=s){--t;break}if(t===e.length)break}s.id=Number(e.substring(n,t+1))}if(e.charAt(++t)){const n=this.tryParse(e.substr(t));if(!h.isPayloadValid(s.type,n))throw new Error("invalid payload");s.data=n}return s}tryParse(e){try{return JSON.parse(e,this.reviver)}catch(t){return!1}}static isPayloadValid(e,t){switch(e){case a.CONNECT:return"object"==typeof t;case a.DISCONNECT:return void 0===t;case a.CONNECT_ERROR:return"string"==typeof t||"object"==typeof t;case a.EVENT:case a.BINARY_EVENT:return Array.isArray(t)&&("string"==typeof t[0]||"number"==typeof t[0]);case a.ACK:case a.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class u{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const e=Object(r.b)(this.reconPack,this.buffers);return this.finishedReconstruction(),e}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}},18157:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i}));var n=s(18158);function r(e){const t=[],s=e.data,r=e;return r.data=function e(t,s){if(!t)return t;if(Object(n.b)(t)){const e={_placeholder:!0,num:s.length};return s.push(t),e}if(Array.isArray(t)){const n=new Array(t.length);for(let r=0;r<t.length;r++)n[r]=e(t[r],s);return n}if("object"==typeof t&&!(t instanceof Date)){const n={};for(const r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=e(t[r],s));return n}return t}(s,t),r.attachments=t.length,{packet:r,buffers:t}}function i(e,t){return e.data=function e(t,s){if(!t)return t;if(t&&!0===t._placeholder){if("number"==typeof t.num&&t.num>=0&&t.num<s.length)return s[t.num];throw new Error("illegal attachments")}if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]=e(t[n],s);else if("object"==typeof t)for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(t[n]=e(t[n],s));return t}(e.data,t),delete e.attachments,e}},18158:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return c}));const n="function"==typeof ArrayBuffer,r=Object.prototype.toString,i="function"==typeof Blob||"undefined"!=typeof Blob&&"[object BlobConstructor]"===r.call(Blob),o="function"==typeof File||"undefined"!=typeof File&&"[object FileConstructor]"===r.call(File);function a(e){return n&&(e instanceof ArrayBuffer||(e=>"function"==typeof ArrayBuffer.isView?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer)(e))||i&&e instanceof Blob||o&&e instanceof File}function c(e,t){if(!e||"object"!=typeof e)return!1;if(Array.isArray(e)){for(let t=0,s=e.length;t<s;t++)if(c(e[t]))return!0;return!1}if(a(e))return!0;if(e.toJSON&&"function"==typeof e.toJSON&&1===arguments.length)return c(e.toJSON(),!0);for(const s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&c(e[s]))return!0;return!1}},18159:function(e,t,s){"use strict";function n(e,t,s){return e.on(t,s),function(){e.off(t,s)}}s.d(t,"a",(function(){return n}))},18160:function(e,t,s){"use strict";function n(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}s.d(t,"a",(function(){return n})),n.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),s=Math.floor(t*this.jitter*e);e=0==(1&Math.floor(10*t))?e-s:e+s}return 0|Math.min(e,this.max)},n.prototype.reset=function(){this.attempts=0},n.prototype.setMin=function(e){this.ms=e},n.prototype.setMax=function(e){this.max=e},n.prototype.setJitter=function(e){this.jitter=e}},18161:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{get repositoryUrl(){throw new Error("Invalid operation")}async getSnapshotTree(e){return e?Promise.reject(new Error("Invalid operation")):null}async getVersions(e,t){return[]}async uploadSummaryWithContext(e,t){return Promise.reject(new Error("Invalid operation"))}async downloadSummary(e){return Promise.reject(new Error("Invalid operation"))}async createBlob(e){return Promise.reject(new Error("Null blob storage can not create blob"))}async readBlob(e){return Promise.reject(new Error("Null blob storage can not read blob"))}}},18162:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(17940),r=s(17987),i=s(17988),o=s(18119);class a{constructor(e){this.historian=e,this.blobCache=new Map,this.commitCache=new Map,this.treeCache=new Map,this.refCache=new Map}async getHeader(e,t){const s=await this.historian.getHeader(t);for(const n of s.blobs)this.blobCache.set(n.sha,n);return Object(r.d)(s.tree)}async getFullTree(e){return this.historian.getFullTree(e)}async getCommit(e){return this.commitCache.has(e)?(Object(o.a)("Cache hit on "+e),this.commitCache.get(e)):this.historian.getCommit(e)}async getCommits(e,t){let s=e;if(this.refCache.has(e)&&(Object(o.a)("Commit cache hit on "+e),s=this.refCache.get(e),this.refCache.delete(e),!s))return[];if(this.commitCache.has(s)){const e=this.commitCache.get(s);return[{commit:{author:e.author,committer:e.committer,message:e.message,tree:e.tree,url:e.url},parents:e.parents,sha:e.sha,url:e.url}]}return this.historian.getCommits(s,t)}async getTree(e,t=!0){return this.treeCache.has(e)?(Object(o.a)("Tree cache hit on "+e),this.treeCache.get(e)):this.historian.getTree(e,t)}async getBlob(e){return this.blobCache.has(e)?(Object(o.a)("Blob cache hit on "+e),this.blobCache.get(e)):this.historian.getBlob(e)}getRawUrl(e){return`${this.historian.endpoint}/git/blobs/raw/${e}`}async getContent(e,t){return this.historian.getContent(t,e)}async createBlob(e,t){const s={content:e,encoding:t};return this.historian.createBlob(s)}async createGitTree(e){return this.historian.createTree(e)}async createTree(e){return this.createTreeCore(e,0)}async createCommit(e){return this.historian.createCommit(e)}async createSummary(e){return this.historian.createSummary(e)}async deleteSummary(e){return this.historian.deleteSummary(e)}async getSummary(e){return this.historian.getSummary(e)}async getRef(e){return this.historian.getRef("heads/"+e).catch(e=>{if(400===e||404===e)return null;throw e})}async createRef(e,t){const s={ref:"refs/heads/"+e,sha:t,config:{enabled:!0}};return this.historian.createRef(s)}async upsertRef(e,t){const s={force:!0,sha:t,config:{enabled:!0}};return this.historian.updateRef("heads/"+e,s)}addRef(e,t){this.refCache.set(e,t)}addCommit(e){this.commitCache.set(e.sha,e)}addTree(e){this.treeCache.set(e.sha,e)}addBlob(e){this.blobCache.set(e.sha,e)}async write(e,t,s,n){const r=await this.createTree(t),i={author:{date:(new Date).toISOString(),email:"kurtb@microsoft.com",name:"Kurt Berglund"},message:n,parents:s,tree:r.sha},o=await this.historian.createCommit(i);return await this.getRef(e)?await this.upsertRef(e,o.sha):await this.createRef(e,o.sha),o}async createTreeCore(e,t){if(e.id)return this.getTree(e.id);const s=[];for(const n of e.entries)switch(i.b[n.type]){case i.b.Blob:{const e=n.value;n.mode===i.a.Symlink&&(e.contents=this.translateSymlink(e.contents,t));const r=this.createBlob(e.contents,e.encoding);s.push(r);break}case i.b.Tree:{const e=n.value,r=this.createTreeCore(e,t+1);s.push(r);break}default:throw new Error("Unknown entry type")}const r=await Promise.all(s),o=[];Object(n.a)(r.length===e.entries.length,"File entries length is not correct");for(let n=0;n<e.entries.length;n++){const t=e.entries[n].type===i.b.Tree?"tree":e.entries[n].type===i.b.Blob?"blob":"commit";o.push({mode:e.entries[n].mode,path:e.entries[n].path,sha:r[n].sha,type:t})}const a={tree:o};return this.historian.createTree(a)}translateSymlink(e,t){let s="";for(let n=0;n<=t;n++)s+="../";return`${s}${e}`}}},18163:function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e[e.NoCaching=0]="NoCaching",e[e.Prefetch=1]="Prefetch"}(n||(n={}))},18164:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(18163),r=s(17995),i=s(18175),o=s(18165),a=s(18169);class c extends r.a{constructor(e,t,s,n={},r,i,o,a,h){super(c.loadInternalDocumentStorageService(e,t,s,n,r,i,o,a,h)),this.id=e,this.manager=t,this.noCacheGitManager=a,this._logTailSha=void 0}get logTailSha(){return this._logTailSha}static loadInternalDocumentStorageService(e,t,s,r,c,h,u,l,d){const p=(null==c?void 0:c.enableWholeSummaryUpload)?new o.a(e,t,s,r,c,h,u,l,d):new a.a(e,t,s,r,c,h,u,d);return(null==c?void 0:c.enableWholeSummaryUpload)||r.caching!==n.a.Prefetch?p:new i.a(p)}async getSnapshotTree(e){const t=await this.internalStorageService.getSnapshotTree(e);return null!==t&&(this._logTailSha=".logTail"in t.trees?t.trees[".logTail"].blobs.logTail:void 0),t}}},18165:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var n=s(17983),r=s(17940),i=s(18168),o=s(18166),a=s(18167),c=s(17944),h=s(18077);class u{constructor(e,t,s,n={},r,i=new h.a,o=new h.a,a,c=(async e=>e&&void 0!==this.noCacheGitManager?this.noCacheGitManager:this.manager)){this.id=e,this.manager=t,this.logger=s,this.policies=n,this.driverPolicies=r,this.blobCache=i,this.snapshotTreeCache=o,this.noCacheGitManager=a,this.getStorageManager=c,this.firstVersionsCall=!0}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new o.a(e)}async getVersions(e,t){var s;if(e!==this.id&&null!==e)return[{id:e,treeId:void 0}];if(this.firstVersionsCall&&1===t){this.firstVersionsCall=!1;const{id:e,snapshotTree:t}=(null===(s=this.driverPolicies)||void 0===s?void 0:s.enableDiscovery)?await this.fetchAndCacheSnapshotTree("latest",!0):await this.fetchAndCacheSnapshotTree("latest",!1);return[{id:e,treeId:t.id}]}const n=e||this.id;return(await c.c.timedExecAsync(this.logger,{eventName:"getVersions",versionId:n,count:t},async()=>(await this.getStorageManager()).getCommits(n,t))).map(e=>({date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha}))}async getSnapshotTree(e){let t=e;if(!t){const e=await this.getVersions(this.id,1);if(0===e.length)return null;t=e[0]}return(await this.fetchAndCacheSnapshotTree(t.id)).snapshotTree}async readBlob(e){const t=await this.blobCache.get(this.getCacheKey(e));if(void 0!==t)return t;const s=await c.c.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async t=>{const s=await this.getStorageManager(),n=await s.getBlob(e);return t.end({size:n.size}),n}),r=Object(n.d)(s.content,s.encoding);return await this.blobCache.put(this.getCacheKey(s.sha),r),r}async uploadSummaryWithContext(e,t){return await c.c.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var s;return(await this.getSummaryUploadManager()).writeSummaryTree(e,null!==(s=t.ackHandle)&&void 0!==s?s:"","channel")})}async downloadSummary(e){const t=await c.c.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e.handle},async t=>{var s;const n=await this.getStorageManager(),r=await n.getSummary(e.handle);return t.end({size:null===(s=r.trees[0])||void 0===s?void 0:s.entries.length}),r}),{blobs:s,snapshotTree:n}=Object(a.b)(t,"");return Object(i.a)(n,s)}async createBlob(e){const t=new Uint8Array(e);return c.c.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async e=>{const s=await this.getStorageManager(),r=await s.createBlob(Object(n.b)(t,"base64"),"base64").then(e=>({id:e.sha,url:e.url}));return e.end({blobId:r.id}),r})}async fetchAndCacheSnapshotTree(e,t){const s=await this.snapshotTreeCache.get(this.getCacheKey(e));if(void 0!==s)return{id:s.id,snapshotTree:s.snapshotTree};const n=await c.c.timedExecAsync(this.logger,{eventName:"getWholeFlatSummary",treeId:e},async s=>{var n;const r=await this.getStorageManager(t),i=await r.getSummary(e);return s.end({size:null===(n=i.trees[0])||void 0===n?void 0:n.entries.length}),i}),i=Object(a.b)(n),o=n.id,h=i.snapshotTree.id;Object(r.a)(void 0!==h,629);const u={id:o,snapshotTree:i.snapshotTree},l=[this.snapshotTreeCache.put(this.getCacheKey(h),u),this.initBlobCache(i.blobs)];return h!==e&&l.push(this.snapshotTreeCache.put(this.getCacheKey(e),u)),await Promise.all(l),u}async initBlobCache(e){const t=[];e.forEach((e,s)=>{const n=this.getCacheKey(s);t.push(this.blobCache.put(n,e))}),await Promise.all(t)}getCacheKey(e){return`${this.id}:${e}`}}},18166:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18167);class r{constructor(e){this.manager=e}async writeSummaryTree(e,t,s,n){const r=await this.writeSummaryTreeCore(t,e,s,null!=n?n:0);if(!r)throw new Error("Failed to write summary tree");return r}async writeSummaryTreeCore(e,t,s,r){const i={entries:Object(n.a)(e,t,"","channel"===s?".app":"").entries,message:void 0,sequenceNumber:r,type:s};return this.manager.createSummary(i).then(e=>e.id)}}},18167:function(e,t,s){"use strict";s.d(t,"a",(function(){return h})),s.d(t,"b",(function(){return u}));var n=s(17983),r=s(17989),i=s(17940),o=s(17987),a=s(17981);const c=(...e)=>e.map(e=>e.replace(/^\//,"").replace(/\/$/,"")).filter(e=>!!e).join("/");function h(e,t,s="",u=""){const l={type:"tree",entries:[]},d=Object.keys(t.tree);for(const p of d){const d=t.tree[p];let g,m,f;const b=c(""===s?u:s,p);switch(d.type){case a.a.Tree:m=h(e,d,b,u),f=d.unreferenced||void 0;break;case a.a.Blob:m="string"==typeof d.content?{type:"blob",content:d.content,encoding:"utf-8"}:{type:"blob",content:Object(n.b)(d.content,"base64"),encoding:"base64"};break;case a.a.Handle:if(d.embedded)g=d.handle;else{if(!e)throw Error("Parent summary does not exist to reference by handle.");g=c(e,u,d.handle)}break;case a.a.Attachment:g=d.id;break;default:Object(r.a)(d,"Unknown type: "+d.type)}const v={path:encodeURIComponent(p),type:Object(o.f)(d)};let y;if(m)Object(i.a)(void 0===g,173),y=Object.assign({value:m,unreferenced:f},v);else{if(!g)throw new Error("Invalid tree entry for "+d.type);y=Object.assign(Object.assign({},v),{id:g})}l.entries.push(y)}return l}function u(e,t=".app"){var s;const r=new Map;e.blobs&&e.blobs.forEach(e=>{var t;r.set(e.id,Object(n.d)(e.content,null!==(t=e.encoding)&&void 0!==t?t:"utf-8"))});const i=null===(s=e.trees)||void 0===s?void 0:s[0],o=null==i?void 0:i.sequenceNumber,a=function(e,t){const s={},n={id:e.id,blobs:{},trees:{}};s[""]=n;for(const r of e.entries){const e=r.path.replace(new RegExp(`^${t}/`),""),n=e.lastindexOf("/"),i=e.slice(0,Math.max(0,n)),o=e.slice(n+1),a=s[i];if("tree"===r.type){const t={blobs:{},trees:{},unreferenced:r.unreferenced};a.trees[decodeURIComponent(o)]=t,s[e]=t}else{if("blob"!==r.type)throw new Error("Unknown entry type!!");a.blobs[decodeURIComponent(o)]=r.id}}return n}(i,t);return{blobs:r,snapshotTree:a,sequenceNumber:o}}},18168:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(17940),r=s(17983),i=s(17981);class o{constructor(e){this.props=e,this.attachmentCounter=0,this.summaryTree={}}get summary(){var e;return{type:i.a.Tree,tree:Object.assign({},this.summaryTree),unreferenced:null===(e=this.props)||void 0===e?void 0:e.unreferenced}}addBlob(e,t){this.summaryTree[e]={type:i.a.Blob,content:t}}addHandle(e,t,s){this.summaryTree[e]={type:i.a.Handle,handleType:t,handle:s}}addTree(e,t){this.summaryTree[e]=t}addAttachment(e){this.summaryTree[this.attachmentCounter++]={id:e,type:i.a.Attachment}}}function a(e,t){const s=new o({unreferenced:e.unreferenced});for(const[i,o]of Object.entries(e.blobs)){const e=t.get(o);Object(n.a)(void 0!==e,733),s.addBlob(i,r.a.from(e).toString("utf-8"))}for(const[n,r]of Object.entries(e.trees)){const e=a(r,t);s.addTree(n,e)}return s.summary}},18169:function(e,t,s){"use strict";s.d(t,"a",(function(){return u}));var n=s(17983),r=s(17987),i=s(18170),o=s(17944),a=s(18077),c=s(18172);const h="undefined"==typeof window;class u{constructor(e,t,s,n={},r,i,o,c=(async()=>this.manager)){this.id=e,this.manager=t,this.logger=s,this.policies=n,this.getStorageManager=c,this.blobsShaCache=new Map,(!0===(null==r?void 0:r.enableRestLess)||h)&&(this.blobCache=null!=i?i:new a.a,this.snapshotTreeCache=null!=o?o:new a.a)}get repositoryUrl(){return""}async getSummaryUploadManager(){const e=await this.getStorageManager();return new i.a(new c.a(e,this.logger),this.blobsShaCache,this.getPreviousFullSnapshot.bind(this))}async getVersions(e,t){const s=e||this.id;return(await o.c.timedExecAsync(this.logger,{eventName:"getVersions",versionId:s,count:t},async()=>(await this.getStorageManager()).getCommits(s,t))).map(e=>({date:e.commit.author.date,id:e.sha,treeId:e.commit.tree.sha}))}async getSnapshotTree(e){var t,s;let n=e;if(!n){const e=await this.getVersions(this.id,1);if(0===e.length)return null;n=e[0]}const i=await(null===(t=this.snapshotTreeCache)||void 0===t?void 0:t.get(this.getCacheKey(n.treeId)));if(i)return i.snapshotTree;const a=await o.c.timedExecAsync(this.logger,{eventName:"getSnapshotTree",treeId:n.treeId},async e=>{const t=await this.getStorageManager(),s=await t.getTree(n.treeId);return e.end({size:s.tree.length}),s}),c=Object(r.d)(a,this.blobsShaCache,!0);return await(null===(s=this.snapshotTreeCache)||void 0===s?void 0:s.put(this.getCacheKey(c.id),{id:n.id,snapshotTree:c})),c}async readBlob(e){var t,s;const r=await(null===(t=this.blobCache)||void 0===t?void 0:t.get(this.getCacheKey(e)));if(r)return r;const i=await o.c.timedExecAsync(this.logger,{eventName:"readBlob",blobId:e},async t=>{const s=await this.getStorageManager(),n=await s.getBlob(e);return t.end({size:n.size}),n});this.blobsShaCache.set(i.sha,"");const a=Object(n.d)(i.content,i.encoding);return await(null===(s=this.blobCache)||void 0===s?void 0:s.put(this.getCacheKey(i.sha),a)),a}async uploadSummaryWithContext(e,t){return await o.c.timedExecAsync(this.logger,{eventName:"uploadSummaryWithContext"},async()=>{var s;return(await this.getSummaryUploadManager()).writeSummaryTree(e,null!==(s=t.ackHandle)&&void 0!==s?s:"","channel")})}async downloadSummary(e){throw new Error("NOT IMPLEMENTED!")}async createBlob(e){const t=new Uint8Array(e);return o.c.timedExecAsync(this.logger,{eventName:"createBlob",size:t.length},async e=>{const s=await this.getStorageManager(),r=await s.createBlob(Object(n.b)(t,"base64"),"base64").then(e=>({id:e.sha,url:e.url}));return e.end({blobId:r.id}),r})}async getPreviousFullSnapshot(e){return e?this.getVersions(e,1).then(async e=>(this.blobsShaCache.clear(),this.getSnapshotTree(e[0]))):void 0}getCacheKey(e){return`${this.id}:${e}`}}},18170:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var n=s(17989),r=s(17983),i=s(18171),o=s(17940),a=s(17987),c=s(17981);class h{constructor(e,t,s){this.manager=e,this.blobsShaCache=t,this.getPreviousFullSnapshot=s}async writeSummaryTree(e,t,s,n){const r=await this.getPreviousFullSnapshot(t);return this.writeSummaryTreeCore(e,null!=r?r:void 0)}async writeSummaryTreeCore(e,t){const s=await Promise.all(Object.keys(e.tree).map(async s=>{const n=e.tree[s],r=await this.writeSummaryTreeObject(n,t);return{mode:Object(a.e)(n),path:encodeURIComponent(s),sha:r,type:Object(a.f)(n)}}));return(await this.manager.createGitTree({tree:s})).sha}async writeSummaryTreeObject(e,t){switch(e.type){case c.a.Blob:return this.writeSummaryBlob(e.content);case c.a.Handle:if(void 0===t)throw Error("Parent summary does not exist to reference by handle.");return this.getIdFromPath(e.handleType,e.handle,t);case c.a.Tree:return this.writeSummaryTreeCore(e,t);case c.a.Attachment:return e.id;default:Object(n.a)(e,"Unknown type: "+e.type)}}async writeSummaryBlob(e){const{parsedContent:t,encoding:s}="string"==typeof e?{parsedContent:e,encoding:"utf-8"}:{parsedContent:Object(r.b)(e,"base64"),encoding:"base64"},n=await Object(i.a)(r.a.from(t,s));if(!this.blobsShaCache.has(n)){this.blobsShaCache.set(n,"");const e=await this.manager.createBlob(t,s);Object(o.a)(n===e.sha,182)}return n}getIdFromPath(e,t,s){const n=t.split("/").map(e=>decodeURIComponent(e));return""===n[0]&&n.shift(),0===n.length?s.id:this.getIdFromPathCore(e,n,s)}getIdFromPathCore(e,t,s){var n;Object(o.a)(t.length>0,179);const r=t[0];if(1===t.length)switch(e){case c.a.Blob:{const e=s.blobs[r];return Object(o.a)(!!e,180),e}case c.a.Tree:{const e=null===(n=s.trees[r])||void 0===n?void 0:n.id;return Object(o.a)(!!e,181),e}default:throw Error(`Unexpected handle summary object type: "${e}".`)}return this.getIdFromPathCore(e,t.slice(1),s.trees[r])}}},18171:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(14398),r=s(17983);async function i(e,t="SHA-1",r="hex"){if(void 0===crypto.subtle)return s.e(348).then(s.bind(null,33621)).then(async s=>s.hashFile(e,t,r));return function(e,t){switch(t){case"hex":return Array.prototype.map.call(e,e=>e.toString(16).padStart(2,"0")).join("");case"base64":return n.fromByteArray(e)}}(await async function(e,t){const s=await crypto.subtle.digest(t,e);return new Uint8Array(s)}(e,t),r)}async function o(e){const t=`blob ${e.byteLength.toString()}${String.fromCharCode(0)}`;return i(r.a.from(t+e.toString()))}},18172:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18173);class r{constructor(e,t){this.internalGitManager=e,this.logger=t}async getHeader(e,t){return this.runWithRetry(async()=>this.internalGitManager.getHeader(e,t),"gitManager_getHeader")}async getFullTree(e){return this.runWithRetry(async()=>this.internalGitManager.getFullTree(e),"gitManager_getFullTree")}async getCommit(e){return this.runWithRetry(async()=>this.internalGitManager.getCommit(e),"gitManager_getCommit")}async getCommits(e,t){return this.runWithRetry(async()=>this.internalGitManager.getCommits(e,t),"gitManager_getCommits")}async getTree(e,t){return this.runWithRetry(async()=>this.internalGitManager.getTree(e,t),"gitManager_getTree")}async getBlob(e){return this.runWithRetry(async()=>this.internalGitManager.getBlob(e),"gitManager_getBlob")}getRawUrl(e){return this.internalGitManager.getRawUrl(e)}async getContent(e,t){return this.runWithRetry(async()=>this.internalGitManager.getContent(e,t),"gitManager_getContent")}async createBlob(e,t){return this.runWithRetry(async()=>this.internalGitManager.createBlob(e,t),"gitManager_createBlob")}async createGitTree(e){return this.runWithRetry(async()=>this.internalGitManager.createGitTree(e),"gitManager_createGitTree")}async createTree(e){return this.runWithRetry(async()=>this.internalGitManager.createTree(e),"gitManager_createTree")}async createCommit(e){return this.runWithRetry(async()=>this.internalGitManager.createCommit(e),"gitManager_createCommit")}async getRef(e){return this.runWithRetry(async()=>this.internalGitManager.getRef(e),"gitManager_getRef")}async createRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.createRef(e,t),"gitManager_createRef")}async upsertRef(e,t){return this.runWithRetry(async()=>this.internalGitManager.upsertRef(e,t),"gitManager_upsertRef")}async write(e,t,s,n){return this.runWithRetry(async()=>this.internalGitManager.write(e,t,s,n),"gitManager_write")}async createSummary(e){return this.runWithRetry(async()=>this.internalGitManager.createSummary(e),"gitManager_createSummary")}async deleteSummary(e){return this.runWithRetry(async()=>this.internalGitManager.deleteSummary(e),"gitManager_deleteSummary")}async getSummary(e){return this.runWithRetry(async()=>this.internalGitManager.getSummary(e),"gitManager_getSummary")}async runWithRetry(e,t){return Object(n.a)(e,t,this.logger,{})}}},18173:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(17955),r=s(18017),i=s(18011),o=s(18010),a=s(18174);async function c(e,t,s,c){var h,u;let l,d=!1,p=1e3,g=0;const m=n.a.now();let f;do{try{l=await e(c.cancel),d=!0}catch(b){if(!Object(o.f)(b))throw s.sendTelemetryEvent({eventName:t+"_cancel",retry:g,duration:n.a.now()-m,fetchCallName:t},b),b;if(!0===(null===(h=c.cancel)||void 0===h?void 0:h.aborted))throw s.sendTelemetryEvent({eventName:t+"_runWithRetryAborted",retry:g,duration:n.a.now()-m,fetchCallName:t},b),new o.d("runWithRetry was Aborted",i.a.genericError,{driverVersion:a.a,fetchCallName:t});g++,f=b,p=null!==(u=Object(o.i)(b))&&void 0!==u?u:Math.min(2*p,8e3),c.onRetry&&c.onRetry(p,b),await Object(r.a)(p)}}while(!d);return g>0&&s.sendTelemetryEvent({eventName:t+"_lastError",retry:g,duration:n.a.now()-m,fetchCallName:t},f),l}},18174:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="1.3.6"},18175:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(18163),r=s(17995),i=s(18010);class o extends r.a{constructor(){super(...arguments),this.prefetchCache=new Map,this.prefetchEnabled=!0}get policies(){const e=this.internalStorageService.policies;if(e)return Object.assign(Object.assign({},e),{caching:n.a.NoCaching})}async getSnapshotTree(e){const t=this.internalStorageService.getSnapshotTree(e);return this.prefetchEnabled&&t.then(e=>{null!=e&&this.prefetchTree(e)}),t}async readBlob(e){return this.cachedRead(e)}stopPrefetch(){this.prefetchEnabled=!1,this.prefetchCache.clear()}async cachedRead(e){if(this.prefetchEnabled){const t=this.prefetchCache.get(e);if(void 0!==t)return t;const s=this.internalStorageService.readBlob(e);return this.prefetchCache.set(e,s.catch(t=>{throw Object(i.f)(t)&&this.prefetchCache.delete(e),t})),s}return this.internalStorageService.readBlob(e)}prefetchTree(e){const t=[];this.prefetchTreeCore(e,t);for(const s of t)this.cachedRead(s)}prefetchTreeCore(e,t){for(const s of Object.keys(e.blobs)){const n=e.blobs[s];s.startsWith(".")||"header"===s||s.startsWith("quorum")?null!==n&&this.cachedRead(n):s.startsWith("deltas")||null!==n&&t.push(n)}for(const s of Object.keys(e.trees))this.prefetchTreeCore(e.trees[s],t)}}},18176:function(e,t,s){"use strict";s.d(t,"b",(function(){return a})),s.d(t,"a",(function(){return c}));var n=s(18177),r=s(17982),i=s(17954),o=s(17944);class a{constructor(e,t,s,n){this.tenantId=e,this.id=t,this.deltaStorageService=s,this.documentStorageService=n,this.logtailSha=this.documentStorageService.logTailSha}fetchMessages(e,t,s,r,o){return r?n.a:Object(n.b)(this.getCore.bind(this),1,e,t,2e3,new i.b,s,o)}async getCore(e,t){const s=this.logtailSha?await Object(r.a)(this.documentStorageService,this.logtailSha):[];if(this.logtailSha=void 0,s.length>0){const t=s.filter(t=>t.sequenceNumber>=e);if(t.length>0)return{messages:t,partialResult:!0}}return this.deltaStorageService.get(this.tenantId,this.id,e,t)}}class c{constructor(e,t,s,n=(async()=>this.restWrapper),r=(()=>this.url)){this.url=e,this.restWrapper=t,this.logger=s,this.getRestWrapper=n,this.getDeltaStorageUrl=r}async get(e,t,s,n){return{messages:await o.c.timedExecAsync(this.logger,{eventName:"getDeltas",from:s,to:n},async e=>{const t=await this.getRestWrapper(),r=this.getDeltaStorageUrl(),i=await t.get(r,{from:s-1,to:n});return e.end({count:i.length}),i}),partialResult:!1}}}},18177:function(e,t,s){"use strict";s.d(t,"b",(function(){return d})),s.d(t,"a",(function(){return p}));var n=s(17979),r=s(17940),i=s(17955),o=s(17944),a=s(18010),c=s(18178),h=s(18174);class u{constructor(e,t,s,r,i,o){this.to=t,this.payloadSize=s,this.logger=r,this.requestCallback=i,this.responseCallback=o,this.results=new Map,this.workingState="working",this.requestsInFlight=0,this.endEvent=new n.a,this.requests=0,this.latestRequested=e,this.nextToDeliver=e,this.knewTo=void 0!==t}get working(){return"working"===this.workingState}get canceled(){return"canceled"===this.workingState}cancel(){this.working&&(this.workingState="canceled",this.endEvent.resolve())}async run(e){Object(r.a)(e>0,258),Object(r.a)(this.working,259);let t=e;for(;t>0;)t--,this.addRequest();return this.dispatch(),this.endEvent.promise}done(){Object(r.a)(void 0!==this.to,260),Object(r.a)(this.nextToDeliver>=this.to,261),this.working&&(this.workingState="done",this.endEvent.resolve())}fail(e){this.working&&(this.workingState="done",this.endEvent.reject(e))}dispatch(){for(;this.working;){const e=this.results.get(this.nextToDeliver);if(void 0===e)break;this.results.delete(this.nextToDeliver),Object(r.a)(e.length<=this.payloadSize,473),this.nextToDeliver+=e.length,this.responseCallback(e)}this.working&&(0===this.requestsInFlight?(Object(r.a)(0===this.results.size,263),this.done()):void 0!==this.to&&this.nextToDeliver>=this.to&&(Object(r.a)(!this.knewTo,264),this.done()))}getNextChunk(){if(!this.working)return;const e=this.latestRequested;return void 0!==this.to&&this.to<=e?void 0:(this.latestRequested+=this.payloadSize,void 0!==this.to&&(this.latestRequested=Math.min(this.to,this.latestRequested)),Object(r.a)(e<this.latestRequested,265),{from:e,to:this.latestRequested})}addRequest(){const e=this.getNextChunk();void 0!==e&&this.addRequestCore(e.from,e.to).catch(this.fail.bind(this))}async addRequestCore(e,t){Object(r.a)(this.working,266);let s=e,n=t;for(this.requestsInFlight++;this.working;){const e=n-s;Object(r.a)(e>0,267),void 0!==this.to&&(Object(r.a)(s<this.to,268),Object(r.a)(n<=this.to,269)),this.requests++;const t=this.requestCallback(this.requests,s,n,void 0!==this.to,{});this.dispatch();const{payload:i,cancel:o,partial:a}=await t;if(o&&this.cancel(),void 0!==this.to&&s>=this.to){Object(r.a)(!this.knewTo,270),0!==i.length&&this.logger.sendErrorEvent({eventName:"ParallelRequests_GotExtra",from:s,to:n,end:this.to,length:i.length});break}if(this.working){const t=s,o=i.length;let c=e<=o;if(0!==o){e<o&&this.logger.sendTelemetryEvent({eventName:"ParallelRequests_Over",from:s,to:n,length:o});const t=i.splice(0,e);this.results.set(s,t),s+=t.length}else Object(r.a)(!a,271),Object(r.a)(!this.knewTo,272);if(!a&&!c){if(!this.knewTo){(void 0===this.to||this.to>s)&&(this.to=s);break}this.logger.sendPerformanceEvent({eventName:"ParallelRequests_Partial",from:t,to:n,length:o})}if(n===this.latestRequested&&(0!==i.length&&(this.results.set(s,i),s+=i.length),this.latestRequested=s,c=!0),c){const e=this.getNextChunk();if(void 0===e)break;s=e.from,n=e.to}}}this.requestsInFlight--,this.dispatch()}}class l{constructor(){this.queue=[],this.done=!1}pushValue(e){this.pushCore(Promise.resolve({done:!1,value:e}))}pushError(e){this.pushCore(Promise.reject(e)),this.done=!0}pushDone(){this.pushCore(Promise.resolve({done:!0})),this.done=!0}pushCore(e){Object(r.a)(!this.done,274),this.deferred?(Object(r.a)(0===this.queue.length,275),this.deferred.resolve(e),this.deferred=void 0):this.queue.push(e)}async read(){Object(r.a)(void 0===this.deferred,276);const e=this.queue.shift();return void 0!==e?e:(Object(r.a)(!this.done,277),this.deferred=new n.a,this.deferred.promise)}}function d(e,t,s,n,d,p,g,m){let f,b=0,v=0;const y=new l,S={fromTotal:s,toTotal:n},w=o.c.start(p,Object.assign(Object.assign({eventName:"GetDeltas"},S),{reason:m})),C=new u(s,n,d,p,async(t,s,n,r,o)=>(b++,async function(e,t,s,n,r,o){let u,l=0;const d=[];for(;!0!==(null==r?void 0:r.aborted);){l++;let r=Math.min(1e4,100*Math.pow(2,l));const g=i.a.now();try{const n=e(Object.assign(Object.assign({},t),{retry:l})),{messages:r,partialResult:o}=await n;d.push(...r);if(0!==r.length||!s)return{payload:d,cancel:!1,partial:o};if(void 0===u)u=i.a.now();else if(i.a.now()-u>3e4)throw Object(a.g)("Failed to retrieve ops from storage (Too Many Retries)",{canRetry:!1},Object.assign({retry:l,driverVersion:h.a},t))}catch(p){const e=Object(a.f)(p);u=void 0;const s=Object(a.i)(p);if(Object(c.a)(n,Object.assign(Object.assign({eventName:"GetDeltas_Error"},t),{retry:l,duration:i.a.now()-g,retryAfter:s,reason:o}),p),!e)throw p;void 0!==s&&s>=0&&(r=s)}await Object(c.b)(r)}return{partial:!1,cancel:!0,payload:[]}}(async t=>e(s,n,t),Object.assign(Object.assign({request:t,from:s,to:n},S),o),r,p,g,m)),e=>{void 0===f?Object(r.a)(e[0].sequenceNumber===s,621):Object(r.a)(e[0].sequenceNumber===f+1,622),f=e[e.length-1].sequenceNumber,Object(r.a)(f-e[0].sequenceNumber+1===e.length,623),v+=e.length,y.pushValue(e)}),O=e=>{C.cancel()};return void 0!==g&&g.addEventListener("abort",O),C.run(t).finally(()=>{void 0!==g&&g.removeEventListener("abort",O)}).then(()=>{const e={lastFetch:f,length:v,requests:b};C.canceled?w.cancel(Object.assign(Object.assign({},e),{error:"ops request cancelled by client"})):(Object(r.a)(void 0===n||void 0!==f&&f>=n-1,624),w.end(e)),y.pushDone()}).catch(e=>{w.cancel({lastFetch:f,length:v,requests:b},e),y.pushError(e)}),y}const p={read:async()=>({done:!0})}},18178:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return i}));var n=s(18010);function r(e,t,s){var r,i;const o=Object.assign({},t),a=s.online;if(o.online="string"==typeof a?a:n.e[Object(n.k)()],"object"==typeof navigator&&null!==navigator){const e=navigator,t=null!==(i=null!==(r=e.connection)&&void 0!==r?r:e.mozConnection)&&void 0!==i?i:e.webkitConnection;null!==t&&"object"==typeof t&&(o.connectionType=t.type)}o.category=Object(n.f)(s)?"generic":"error",e.sendTelemetryEvent(o,s)}function i(e){return new Promise(t=>{let s=t,r=e;Object(n.k)()===n.e.Offline&&void 0!==(null===window||void 0===window?void 0:window.addEventListener)&&(s=()=>{t(),window.removeEventListener("online",s)},window.addEventListener("online",s,!1),r=Math.max(e,3e4)),setTimeout(s,r)})}},18179:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(18180),r=s(18127),i=s(18128);const o=["^0.4.0","^0.3.0","^0.2.0","^0.1.0"];class a extends n.a{static async create(e,t,s,n,r,c,h,u=2e4){const l=n(c,{query:{documentId:t,tenantId:e},reconnection:!1,transports:["websocket"],timeout:u}),d={client:r,id:t,mode:r.mode,tenantId:e,token:s,versions:o,relayUserAgent:[r.details.environment," driverVersion:"+i.a].join(";")},p=new a(l,t,h,!0);return await p.initialize(d,u),p}createErrorObject(e,t,s=!0){return s&&Number.isInteger(null==t?void 0:t.code)&&"string"==typeof(null==t?void 0:t.message)?Object(r.a)(t,e):super.createErrorObject(e,t,s)}}},18180:function(e,t,s){"use strict";s.d(t,"a",(function(){return d}));var n=s(17940),r=s(17954),i=s(18010),o=s(18182),a=s(17938),c=s(17952),h=s(17944),u=s(17945),l=s(18181);class d extends a.a{constructor(e,t,s,r=!1){super((e,t)=>{s.sendErrorEvent({eventName:"DeltaConnection:EventException",name:e},t)}),this.socket=e,this.documentId=t,this.enableLongPollingDowngrades=r,this.queuedMessages=[],this.queuedSignals=[],this.earlyOpHandlerAttached=!1,this.connectionListeners=new Map,this.trackedListeners=new Map,this._disposed=!1,this.earlyOpHandler=(e,t)=>{this.queuedMessages.push(...t)},this.earlySignalHandler=e=>{this.queuedSignals.push(e)},this.mc=Object(c.c)(h.a.create(s,"DeltaConnection")),this.on("newListener",(e,t)=>{if(Object(n.a)(!this.disposed,522),d.eventsAlwaysForwarded.includes(e))Object(n.a)(this.trackedListeners.has(e),581);else{if(!d.eventsToForward.includes(e))throw new Error("DocumentDeltaConnection: Registering for unknown event: "+e);Object(n.a)(0!==this.listeners(e).length===this.trackedListeners.has(e),523),this.trackedListeners.has(e)||this.addTrackedListener(e,(...t)=>{this.emit(e,...t)})}})}get hasDetails(){return!!this._details}get disposed(){return Object(n.a)(this._disposed||this.socket.connected,580),this._disposed}get logger(){return this.mc.logger}get details(){if(!this._details)throw new Error("Internal error: calling method before _details is initialized!");return this._details}get clientId(){return this.details.clientId}get mode(){return this.details.mode}get claims(){return this.details.claims}get existing(){return this.details.existing}get maxMessageSize(){return this.details.serviceConfiguration.maxMessageSize}get version(){return this.details.version}get serviceConfiguration(){return this.details.serviceConfiguration}checkNotClosed(){Object(n.a)(!this.disposed,524)}get initialMessages(){return this.checkNotClosed(),Object(n.a)(this.earlyOpHandlerAttached,142),Object(n.a)(0!==this.listeners("op").length,143),this.removeEarlyOpHandler(),this.queuedMessages.length>0&&(this.details.initialMessages.push(...this.queuedMessages),this.details.initialMessages.sort((e,t)=>e.sequenceNumber-t.sequenceNumber),this.queuedMessages.length=0),this.details.initialMessages}get initialSignals(){return this.checkNotClosed(),Object(n.a)(0!==this.listeners("signal").length,144),this.removeEarlySignalHandler(),this.queuedSignals.length>0&&(this.details.initialSignals.push(...this.queuedSignals),this.queuedSignals.length=0),this.details.initialSignals}get initialClients(){return this.checkNotClosed(),this.details.initialClients}emitMessages(e,t){this.disposed||this.socket.emit(e,this.clientId,t)}submitCore(e,t){this.emitMessages(e,[t])}submit(e){this.checkNotClosed(),this.submitCore("submitOp",e)}submitSignal(e){this.checkNotClosed(),this.submitCore("submitSignal",[e])}dispose(){this.disposeCore(!1,Object(i.g)("Client closing delta connection",{canRetry:!0},{driverVersion:l.a}))}disposeCore(e,t){this._disposed||(this._disposed=!0,this.removeTrackedListeners(),this.disconnect(e,t))}disconnect(e,t){this.socket.disconnect()}async initialize(e,t){this.socket.on("op",this.earlyOpHandler),this.socket.on("signal",this.earlySignalHandler),this.earlyOpHandlerAttached=!0;let s=0;const r=()=>this.socket.io.reconnection(),i=()=>r()?this.socket.io.reconnectionAttempts():0;this._details=await new Promise((n,a)=>{const c=(e,t)=>{this.disposeCore(e,t),a(t)};this.addConnectionListener("connect_error",e=>{var t;s++;let n=!1;try{const t=null==e?void 0:e.description;t&&"object"==typeof t&&("TransportError"===e.type&&(n=!0),t.target=void 0)}catch(o){}n&&this.enableLongPollingDowngrades&&"polling"!==(null===(t=this.socket.io.opts.transports)||void 0===t?void 0:t[0])&&(this.socket.io.opts.transports=["polling","websocket"],r()||(this.socket.io.reconnection(!0),this.socket.io.reconnectionAttempts(1))),r()&&s<i()+1||c(!0,this.createErrorObject("connect_error",e))}),this.addConnectionListener("connect_timeout",()=>{c(!0,this.createErrorObject("connect_timeout"))}),this.addConnectionListener("connect_document_success",t=>{if(void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce)return;const s=e.mode,r=t.mode;if(t.claims.scopes.includes(o.a.DocWrite)){if(r!==s)return void c(!1,this.createErrorObject("connect_document_success","Connected in a different mode than was requested",!1))}else if("write"===r)return void c(!1,this.createErrorObject("connect_document_success","Connected in write mode without write permissions",!1));this.checkpointSequenceNumber=t.checkpointSequenceNumber,this.removeConnectionListeners(),n(t)}),this.addTrackedListener("disconnect",e=>{const t=this.createErrorObject("disconnect",e);this.emit("disconnect",t),c(!0,t)}),this.addTrackedListener("error",e=>{const t=this.createErrorObject("error",e,"Invalid namespace"!==e);this.emit("error",t),c(!0,t)}),this.addConnectionListener("connect_document_error",t=>{void 0!==e.nonce&&void 0!==t.nonce&&t.nonce!==e.nonce||c(!1,this.createErrorObject("connect_document_error",t))}),this.socket.emit("connect_document",e),this.socketConnectionTimeout=setTimeout(()=>{c(!1,this.createErrorObject("orderingServiceHandshakeTimeout"))},t+2e3)}),Object(n.a)(!this.disposed,582)}removeEarlyOpHandler(){this.socket.removeListener("op",this.earlyOpHandler),this.earlyOpHandlerAttached=!1}removeEarlySignalHandler(){this.socket.removeListener("signal",this.earlySignalHandler)}addConnectionListener(e,t){Object(n.a)(!d.eventsAlwaysForwarded.includes(e),583),Object(n.a)(!d.eventsToForward.includes(e),584),this.socket.on(e,t),Object(n.a)(!this.connectionListeners.has(e),525),this.connectionListeners.set(e,t)}addTrackedListener(e,t){this.socket.on(e,t),Object(n.a)(!this.trackedListeners.has(e),526),this.trackedListeners.set(e,t)}removeTrackedListeners(){for(const[e,t]of this.trackedListeners.entries())this.socket.off(e,t);this.removeConnectionListeners(),this.removeEarlyOpHandler(),this.removeEarlySignalHandler(),this.trackedListeners.clear()}removeConnectionListeners(){void 0!==this.socketConnectionTimeout&&clearTimeout(this.socketConnectionTimeout);for(const[e,t]of this.connectionListeners.entries())this.socket.off(e,t);this.connectionListeners.clear()}createErrorObject(e,t,s=!0){let n;if("TransportError"===(null==t?void 0:t.type)){n=`${void 0!==(null==t?void 0:t.message)?t.message+": ":""}${JSON.stringify(t,Object(u.e)())}`}else n=Object(r.c)(t).message;return Object(i.g)(`socket.io (${e}): ${n}`,{canRetry:s},{driverVersion:l.a})}}d.eventsToForward=["nack","op","signal","pong"],d.eventsAlwaysForwarded=["disconnect","error"]},18181:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="1.3.6"},18182:function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e.DocRead="doc:read",e.DocWrite="doc:write",e.SummaryWrite="summary:write"}(n||(n={}))},18183:function(e,t,s){"use strict";var n;s.d(t,"a",(function(){return n})),function(e){e.Tree=1,e.Blob=2,e.Handle=3,e.Attachment=4}(n||(n={}))},18184:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(17939);class r extends n.a{constructor(e,t){super(),this.container=e,this.rootDataObject=t,this.connectedHandler=()=>this.emit("connected"),this.disconnectedHandler=()=>this.emit("disconnected"),this.disposedHandler=e=>this.emit("disposed",e),this.savedHandler=()=>this.emit("saved"),this.dirtyHandler=()=>this.emit("dirty"),e.on("connected",this.connectedHandler),e.on("closed",this.disposedHandler),e.on("disconnected",this.disconnectedHandler),e.on("saved",this.savedHandler),e.on("dirty",this.dirtyHandler)}get isDirty(){return this.container.isDirty}get attachState(){return this.container.attachState}get disposed(){return this.container.closed}get connectionState(){return this.container.connectionState}get initialObjects(){return this.rootDataObject.initialObjects}async attach(){throw new Error("Cannot attach container. Container is not in detached state")}async connect(){var e,t;null===(t=(e=this.container).connect)||void 0===t||t.call(e)}async disconnect(){var e,t;null===(t=(e=this.container).disconnect)||void 0===t||t.call(e)}async create(e){return this.rootDataObject.create(e)}dispose(){this.container.close(),this.container.off("connected",this.connectedHandler),this.container.off("closed",this.disposedHandler),this.container.off("disconnected",this.disconnectedHandler),this.container.off("saved",this.savedHandler),this.container.off("dirty",this.dirtyHandler)}}},18185:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(18187),r=s(18186);class i extends r.a{createServiceMember(e){const t=e.user;return Object(n.a)(void 0!==(null==t?void 0:t.name),'Provided user was not an "AzureUser".'),{userId:e.user.id,userName:t.name,connections:[],additionalDetails:t.additionalDetails}}}},18186:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(17939);class r extends n.a{constructor(e){super(),this.container=e,this.lastMembers=new Map,this.audience=e.audience,this.getMembers(),this.audience.on("addMember",(e,t)=>{if(this.shouldIncludeAsMember(t)){const t=this.getMember(e);this.emit("memberAdded",e,t),this.emit("membersChanged")}}),this.audience.on("removeMember",e=>{this.lastMembers.has(e)&&(this.emit("memberRemoved",e,this.lastMembers.get(e)),this.emit("membersChanged"))}),this.container.on("connected",()=>this.emit("membersChanged"))}getMembers(){const e=new Map,t=new Map;return this.audience.getMembers().forEach((s,n)=>{if(this.shouldIncludeAsMember(s)){const r=s.user.id;let i=e.get(r);void 0===i&&(i=this.createServiceMember(s),e.set(r,i)),i.connections.push({id:n,mode:s.mode}),t.set(n,i)}}),this.lastMembers=t,e}getMyself(){const e=this.container.clientId;if(void 0!==e)return this.getMember(e)}getMember(e){const t=this.audience.getMember(e);if(void 0===t)return;const s=this.getMembers().get(null==t?void 0:t.user.id);if(void 0===s)throw Error(`Attempted to fetch client ${e} that is not part of the current member list`);return s}shouldIncludeAsMember(e){return e.details.capabilities.interactive}}},18187:function(e,t,s){"use strict";function n(e,t){if(!e)throw new Error("number"==typeof t?"0x"+t.toString(16).padStart(3,"0"):t)}s.d(t,"a",(function(){return n}))},18188:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var n=s(18189),r=s(18203),i=s(18209),o=s(18192),a=s(17963),c=s(17997),h=s(18202);class u extends n.a{constructor(){super(...arguments),this.initialObjectsDirKey="initial-objects-key",this._initialObjects={}}get initialObjectsDir(){const e=this.root.getSubDirectory(this.initialObjectsDirKey);if(void 0===e)throw new Error("InitialObjects sub-directory was not initialized");return e}async initializingFirstTime(e){this.root.createSubDirectory(this.initialObjectsDirKey);const t=[];Object.entries(e.initialObjects).forEach(([e,s])=>{t.push((async()=>{const t=await this.create(s);this.initialObjectsDir.set(e,t.handle)})())}),await Promise.all(t)}async hasInitialized(){const e=[];for(const[t,s]of Array.from(this.initialObjectsDir.entries())){const n=async()=>{const e=await s.get();Object.assign(this._initialObjects,{[t]:e})};e.push(n())}await Promise.all(e)}get initialObjects(){if(0===Object.keys(this._initialObjects).length)throw new Error("Initial Objects were not correctly initialized");return this._initialObjects}async create(e){if(Object(h.a)(e))return this.createDataObject(e);if(Object(h.b)(e))return this.createSharedObject(e);throw new Error("Could not create new Fluid object because an unknown object was passed")}async createDataObject(e){const t=e.factory,s=[...this.context.packagePath,t.type],n=await this.context.containerRuntime.createDataStore(s);return Object(c.d)(n,"/")}createSharedObject(e){const t=e.getFactory();return this.runtime.createChannel(void 0,t.type)}}class l extends r.a{constructor(e){const[t,s]=Object(h.c)(e),n=new i.a("rootDO",u,s,{},t);super([n.registryEntry],void 0,[Object(o.b)("rootDOId")],{flushMode:a.FlushMode.Immediate}),this.rootDataObjectFactory=n,this.initialObjects=e.initialObjects}async containerInitializingFirstTime(e){await this.rootDataObjectFactory.createRootInstance("rootDOId",e,{initialObjects:this.initialObjects})}}},18189:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(18196),r=s(18200),i=s(18025),o=s(17997),a=s(18190);class c extends a.a{constructor(){super(...arguments),this.rootDirectoryId="root"}async request(e){const t=i.a.create(e);if("bigBlobs"===t.pathParts[0]){const e=this.root.get(t.pathParts.join("/"));return void 0===e?Object(o.a)(t):{mimeType:"fluid/object",status:200,value:e}}return super.request(t)}get root(){if(!this.internalRoot)throw new Error(this.getUninitializedErrorString("root"));return this.internalRoot}async initializeInternal(e){e?(this.internalRoot=await this.runtime.getChannel(this.rootDirectoryId),this.internalRoot.attributes.type===r.a.Type&&this.runtime.logger.send({category:"generic",eventName:"MapDataObject",message:"Legacy document, SharedMap is masquerading as SharedDirectory in DataObject"})):(this.internalRoot=n.b.create(this.runtime,this.rootDirectoryId),this.internalRoot.bindToContext()),await super.initializeInternal(e)}getUninitializedErrorString(e){return e+" must be initialized before being accessed."}}},18190:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var n=s(18191),r=s(17940),i=s(17942),o=s(18194),a=s(18195),c=s(18192);class h extends n.a{constructor(e){super(),this._disposed=!1,this.runtime=e.runtime,this.context=e.context,this.providers=e.providers,this.initProps=e.initProps,Object(r.a)(void 0===this.runtime._dataObject,189),this.runtime._dataObject=this,this.innerHandle=new i.a(this,"",this.runtime.objectsRoutingContext),this.runtime.once("dispose",()=>{this._disposed=!0,this.dispose()})}get disposed(){return this._disposed}get id(){return this.runtime.id}get IFluidRouter(){return this}get IFluidLoadable(){return this}get IFluidHandle(){return this.innerHandle}get handle(){return this.innerHandle}static async getDataObject(e){const t=e._dataObject;return Object(r.a)(void 0!==t,188),await t.finishInitialization(!0),t}async request(e){return Object(c.a)(this,e)}async finishInitialization(e){return void 0!==this.initializeP||(this.initializeP=this.initializeInternal(e)),this.initializeP}async initializeInternal(e){var t;await this.preInitialize(),e?(Object(r.a)(void 0===this.initProps,190),await this.initializingFromExisting()):await this.initializingFirstTime(null!==(t=this.context.createProps)&&void 0!==t?t:this.initProps),await this.hasInitialized()}async getFluidObjectFromDirectory(e,t,s){const n=s?s(e,t):t.get(e),r=null==n?void 0:n.IFluidHandle;if(r)return r.get()}async getService(e){return Object(o.a)(`/${a.a}/${e}`,this.context.containerRuntime).get()}async preInitialize(){}async initializingFirstTime(e){}async initializingFromExisting(){}async hasInitialized(){}dispose(){super.dispose()}}},18191:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(17939);class r extends n.a{constructor(e){if(super(),this.isDisposed=!1,this.forwardingEvents=new Map,void 0!==e){const t=t=>this.unforwardEvent(e,t),s=t=>this.forwardEvent(e,t);this.on(r.removeListenerEvent,t),this.on(r.newListenerEvent,s)}}static isEmitterEvent(e){return e===r.newListenerEvent||e===r.removeListenerEvent}get disposed(){return this.isDisposed}dispose(){this.isDisposed=!0;for(const t of this.forwardingEvents.values())for(const s of t.values())try{s()}catch(e){}this.removeAllListeners(),this.forwardingEvents.clear()}forwardEvent(e,...t){for(const s of t)if(void 0!==e&&void 0!==s&&!r.isEmitterEvent(s)){let t=this.forwardingEvents.get(s);if(void 0===t&&(t=new Map,this.forwardingEvents.set(s,t)),!t.has(e)){const n=(...e)=>this.emit(s,...e);t.set(e,()=>e.off(s,n)),e.on(s,n)}}}unforwardEvent(e,...t){for(const s of t)if(void 0!==s&&!r.isEmitterEvent(s)){const t=this.forwardingEvents.get(s);if((null==t?void 0:t.has(e))&&0===this.listenerCount(s)){const n=t.get(e);void 0!==n&&n(),t.delete(e),0===t.size&&this.forwardingEvents.delete(s)}}}}r.newListenerEvent="newListener",r.removeListenerEvent="removeListener"},18192:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return o}));s(18193);var n=s(18025),r=s(17997);const i=e=>async(t,s)=>{const r=n.a.create(t);if(0===r.pathParts.length)return s.IFluidHandleContext.resolveHandle({url:`/${e}${r.query}`,headers:t.headers})};function o(e,t){return""===t.url||"/"===t.url||t.url.startsWith("/?")?{mimeType:"fluid/object",status:200,value:e}:Object(r.a)(t)}},18193:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(18025),r=s(17997);class i{constructor(){this.handlers=[]}pushHandler(...e){void 0!==e&&this.handlers.push(...e)}async handleRequest(e,t){const s=n.a.create(e);for(const n of this.handlers){const e=await n(s,t);if(void 0!==e)return e}return Object(r.a)(e)}}function o(...e){const t=new i;return t.pushHandler(...e),async(e,s)=>t.handleRequest(e,s)}},18194:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(17940);s(18025);class r{constructor(e,t){this.absolutePath=e,this.runtime=t,this.isAttached=!0}get IFluidHandle(){return this}attachGraph(){Object(n.a)(!1,202)}async get(){const e=await this.runtime.IFluidHandleContext.resolveHandle({url:this.absolutePath});if(200===e.status&&"fluid/object"===e.mimeType)return e.value;throw new Error("Failed to resolve container path "+this.absolutePath)}bind(e){throw new Error("Cannot bind to LegacyUriHandle")}}function i(e,t){return new r(e,t)}},18195:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));s(17997);const n="_services"},18196:function(e,t,s){"use strict";s.d(t,"a",(function(){return b})),s.d(t,"b",(function(){return v}));var n,r,i=s(17940),o=s(17939),a=s(17957),c=s(17982),h=s(17970),u=s(17937),l=s(18032),d=s(17991),p=s(18197),g=s(18199),m=s(18198);const f=p.posix;class b{get type(){return b.Type}get attributes(){return b.Attributes}async load(e,t,s,n){const r=new v(t,e,n);return await r.load(s),r}create(e,t){const s=new v(t,e,b.Attributes);return s.initializeLocal(),s}}b.Type="https://graph.microsoft.com/types/directory",b.Attributes={type:b.Type,snapshotFormatVersion:"0.1",packageVersion:m.a};class v extends u.a{constructor(e,t,s){super(e,t,s,"fluid_directory_"),this[n]="SharedDirectory",this.root=new C(this,this.runtime,this.serializer,f.sep),this.messageHandlers=new Map,this.localValueMaker=new g.a(this.serializer),this.setMessageHandlers(),this.root.on("containedValueChanged",(e,t)=>{this.emit("containedValueChanged",e,t,this)}),this.root.on("subDirectoryCreated",(e,t)=>{this.emit("subDirectoryCreated",e,t,this)}),this.root.on("subDirectoryDeleted",(e,t)=>{this.emit("subDirectoryDeleted",e,t,this)})}static create(e,t){return e.createChannel(t,b.Type)}static getFactory(){return new b}get absolutePath(){return this.root.absolutePath}get(e){return this.root.get(e)}set(e,t){return this.root.set(e,t),this}dispose(e){this.root.dispose(e)}get disposed(){return this.root.disposed}delete(e){return this.root.delete(e)}clear(){this.root.clear()}has(e){return this.root.has(e)}get size(){return this.root.size}forEach(e){this.root.forEach(e)}[(n=Symbol.toStringTag,Symbol.iterator)](){return this.root[Symbol.iterator]()}entries(){return this.root.entries()}countSubDirectory(){return this.root.countSubDirectory()}keys(){return this.root.keys()}values(){return this.root.values()}createSubDirectory(e){return this.root.createSubDirectory(e)}getSubDirectory(e){return this.root.getSubDirectory(e)}hasSubDirectory(e){return this.root.hasSubDirectory(e)}deleteSubDirectory(e){return this.root.deleteSubDirectory(e)}subdirectories(){return this.root.subdirectories()}getWorkingDirectory(e){const t=this.makeAbsolute(e);if(t===f.sep)return this.root;let s=this.root;const n=t.substr(1).split(f.sep);for(const r of n)if(s=s.getSubDirectory(r),!s)return;return s}summarizeCore(e,t){return this.serializeDirectory(this.root,e)}submitDirectoryMessage(e,t){this.submitLocalMessage(e,t)}onDisconnect(){}reSubmitCore(e,t){const s=e,n=this.messageHandlers.get(s.type);Object(i.a)(void 0!==n,13),n.submit(s,t)}async loadCore(e){const t=await Object(c.a)(e,"header"),s=t;Array.isArray(s.blobs)?(this.populate(s.content),await Promise.all(s.blobs.map(async t=>{const s=await Object(c.a)(e,t);this.populate(s)}))):this.populate(t)}populate(e){const t=[];for(t.push([this.root,e]);t.length>0;){const[e,s]=t.pop();if(s.subdirectories)for(const[n,r]of Object.entries(s.subdirectories)){let s=e.getSubDirectory(n);s||(s=new C(this,this.runtime,this.serializer,f.join(e.absolutePath,n)),e.populateSubDirectory(n,s)),t.push([s,r])}if(s.storage)for(const[t,n]of Object.entries(s.storage)){const s=this.makeLocal(t,e.absolutePath,n);e.populateStorage(t,s)}}}processCore(e,t,s){if(e.type===h.a.Operation){const n=e.contents,r=this.messageHandlers.get(n.type);Object(i.a)(void 0!==r,14),r.process(n,t,s)}}rollback(e,t){const s=e,n=this.getWorkingDirectory(s.path);n&&n.rollback(s,t)}makeAbsolute(e){return f.resolve(f.sep,e)}makeLocal(e,t,s){return Object(i.a)(s.type===l.a[l.a.Plain]||s.type===l.a[l.a.Shared],484),this.localValueMaker.fromSerializable(s)}setMessageHandlers(){this.messageHandlers.set("clear",{process:(e,t,s)=>{const n=this.getWorkingDirectory(e.path);n&&n.processClearMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitClearMessage(e,t)}}),this.messageHandlers.set("delete",{process:(e,t,s)=>{const n=this.getWorkingDirectory(e.path);n&&n.processDeleteMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("set",{process:(e,t,s)=>{const n=this.getWorkingDirectory(e.path);if(n){const r=t?void 0:this.makeLocal(e.key,e.path,e.value);n.processSetMessage(e,r,t,s)}},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitKeyMessage(e,t)}}),this.messageHandlers.set("createSubDirectory",{process:(e,t,s)=>{const n=this.getWorkingDirectory(e.path);n&&n.processCreateSubDirectoryMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitSubDirectoryMessage(e,t)}}),this.messageHandlers.set("deleteSubDirectory",{process:(e,t,s)=>{const n=this.getWorkingDirectory(e.path);n&&n.processDeleteSubDirectoryMessage(e,t,s)},submit:(e,t)=>{const s=this.getWorkingDirectory(e.path);s&&s.resubmitSubDirectoryMessage(e,t)}})}applyStashedOp(){throw new Error("not implemented")}serializeDirectory(e,t,s){const n=new d.a;let r=0;const i=[],o=[],a={};for(o.push([e,a]);o.length>0;){const[e,s]=o.pop();for(const[o,a]of e.getSerializedStorage(t)){s.storage||(s.storage={});const t={type:a.type,value:a.value&&JSON.parse(a.value)};if(a.value&&a.value.length>=8192){const s={};let a=s;if(e.absolutePath!==f.sep)for(const t of e.absolutePath.substr(1).split(f.sep)){const e={};a.subdirectories={[t]:e},a=e}a.storage={[o]:t};const c="blob"+r;r++,i.push(c),n.addBlob(c,JSON.stringify(s))}else s.storage[o]=t}for(const[t,n]of e.subdirectories()){s.subdirectories||(s.subdirectories={});const e={};s.subdirectories[t]=e,o.push([n,e])}}const c={blobs:i,content:a};return n.addBlob("header",JSON.stringify(c)),n.getSummaryTree()}}function y(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&"edit"===e.type}function S(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId&&"object"==typeof e.previousStorage}function w(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("createSubDir"===e.type&&"boolean"==typeof e.previouslyExisted||"deleteSubDir"===e.type)}class C extends o.a{constructor(e,t,s,n){super(),this.directory=e,this.runtime=t,this.serializer=s,this.absolutePath=n,this._deleted=!1,this[r]="SubDirectory",this._storage=new Map,this._subdirectories=new Map,this.pendingKeys=new Map,this.pendingSubDirectories=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[]}dispose(e){this._deleted=!0,this.emit("disposed",this)}undispose(){this._deleted=!1}get disposed(){return this._deleted}throwIfDisposed(){if(this._deleted)throw new a.f("Cannot access Disposed subDirectory")}has(e){return this.throwIfDisposed(),this._storage.has(e)}get(e){var t;return this.throwIfDisposed(),null===(t=this._storage.get(e))||void 0===t?void 0:t.value}set(e,t){if(this.throwIfDisposed(),null==e)throw new Error("Undefined and null keys are not supported");const s=this.directory.localValueMaker.fromInMemory(t),n=Object(g.b)(s,this.serializer,this.directory.handle),r=this.setCore(e,s,!0);if(!this.directory.isAttached())return this;const i={key:e,path:this.absolutePath,type:"set",value:n};return this.submitKeyMessage(i,r),this}countSubDirectory(){return this._subdirectories.size}createSubDirectory(e){if(this.throwIfDisposed(),null==e)throw new Error("SubDirectory name may not be undefined or null");if(e.includes(f.sep))throw new Error("SubDirectory name may not contain "+f.sep);const t=this.createSubDirectoryCore(e,!0),s=this._subdirectories.get(e);if(!this.directory.isAttached())return s;const n={path:this.absolutePath,subdirName:e,type:"createSubDirectory"};return this.submitCreateSubDirectoryMessage(n,!t),s}getSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.get(e)}hasSubDirectory(e){return this.throwIfDisposed(),this._subdirectories.has(e)}deleteSubDirectory(e){this.throwIfDisposed();const t=this.deleteSubDirectoryCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const s={path:this.absolutePath,subdirName:e,type:"deleteSubDirectory"};return this.submitDeleteSubDirectoryMessage(s,t),void 0!==t}subdirectories(){return this.throwIfDisposed(),this._subdirectories.entries()}getWorkingDirectory(e){return this.throwIfDisposed(),this.directory.getWorkingDirectory(this.makeAbsolute(e))}delete(e){this.throwIfDisposed();const t=this.deleteCore(e,!0);if(!this.directory.isAttached())return void 0!==t;const s={key:e,path:this.absolutePath,type:"delete"};return this.submitKeyMessage(s,t),void 0!==t}clear(){if(this.throwIfDisposed(),!this.directory.isAttached())return void this.clearCore(!0);const e=new Map(this._storage);this.clearCore(!0);const t={path:this.absolutePath,type:"clear"};this.submitClearMessage(t,e)}forEach(e){this.throwIfDisposed(),this._storage.forEach((t,s,n)=>{e(t.value,s,n)})}get size(){return this.throwIfDisposed(),this._storage.size}entries(){this.throwIfDisposed();const e=this._storage.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}keys(){return this.throwIfDisposed(),this._storage.keys()}values(){this.throwIfDisposed();const e=this._storage.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[(r=Symbol.toStringTag,Symbol.iterator)](){return this.throwIfDisposed(),this.entries()}processClearMessage(e,t,s){if(this.throwIfDisposed(),t){Object(i.a)(S(s),15);const e=this.pendingClearMessageIds.shift();Object(i.a)(e===s.pendingMessageId,810)}else this.clearExceptPendingKeys()}processDeleteMessage(e,t,s){this.throwIfDisposed(),this.needProcessStorageOperation(e,t,s)&&this.deleteCore(e.key,t)}processSetMessage(e,t,s,n){this.throwIfDisposed(),this.needProcessStorageOperation(e,s,n)&&this.setCore(e.key,t,s)}processCreateSubDirectoryMessage(e,t,s){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,s)&&this.createSubDirectoryCore(e.subdirName,t)}processDeleteSubDirectoryMessage(e,t,s){this.throwIfDisposed(),this.needProcessSubDirectoryOperation(e,t,s)&&this.deleteSubDirectoryCore(e.subdirName,t)}submitClearMessage(e,t){this.throwIfDisposed();const s=++this.pendingMessageId;this.pendingClearMessageIds.push(s);const n={type:"clear",pendingMessageId:s,previousStorage:t};this.directory.submitDirectoryMessage(e,n)}resubmitClearMessage(e,t){Object(i.a)(S(t),811);const s=this.pendingClearMessageIds.shift();Object(i.a)(s===t.pendingMessageId,812),this.submitClearMessage(e,t.previousStorage)}getKeyMessageId(e){const t=++this.pendingMessageId,s=this.pendingKeys.get(e.key);return void 0!==s?s.push(t):this.pendingKeys.set(e.key,[t]),t}submitKeyMessage(e,t){this.throwIfDisposed();const s={type:"edit",pendingMessageId:this.getKeyMessageId(e),previousValue:t};this.directory.submitDirectoryMessage(e,s)}resubmitKeyMessage(e,t){Object(i.a)(y(t),813);const s=this.pendingKeys.get(e.key);Object(i.a)(void 0!==s&&s[0]===t.pendingMessageId,814),s.shift(),0===s.length&&this.pendingKeys.delete(e.key),this.submitKeyMessage(e,t.previousValue)}getSubDirMessageId(e){const t=++this.pendingMessageId,s=this.pendingSubDirectories.get(e.subdirName);return void 0!==s?s.push(t):this.pendingSubDirectories.set(e.subdirName,[t]),t}submitCreateSubDirectoryMessage(e,t){this.throwIfDisposed();const s={type:"createSubDir",pendingMessageId:this.getSubDirMessageId(e),previouslyExisted:t};this.directory.submitDirectoryMessage(e,s)}submitDeleteSubDirectoryMessage(e,t){this.throwIfDisposed();const s={type:"deleteSubDir",pendingMessageId:this.getSubDirMessageId(e),subDirectory:t};this.directory.submitDirectoryMessage(e,s)}resubmitSubDirectoryMessage(e,t){Object(i.a)(w(t),815);const s=this.pendingSubDirectories.get(e.subdirName);Object(i.a)(void 0!==s&&s[0]===t.pendingMessageId,816),s.shift(),0===s.length&&this.pendingSubDirectories.delete(e.subdirName),"createSubDir"===t.type?this.submitCreateSubDirectoryMessage(e,t.previouslyExisted):this.submitDeleteSubDirectoryMessage(e,t.subDirectory)}*getSerializedStorage(e){this.throwIfDisposed();for(const[t,s]of this._storage){const n=[t,s.makeSerialized(e,this.directory.handle)];yield n}}populateStorage(e,t){this.throwIfDisposed(),this._storage.set(e,t)}populateSubDirectory(e,t){this.throwIfDisposed(),this._subdirectories.set(e,t)}getLocalValue(e){return this.throwIfDisposed(),this._storage.get(e)}rollbackPendingMessageId(e,t,s){const n=e.get(t),r=null==n?void 0:n.pop();if(!n||r!==s)throw new Error("Rollback op does not match last pending");0===n.length&&e.delete(t)}rollback(e,t){if(void 0===(s=t)||"number"!=typeof s.pendingMessageId||!("edit"===s.type||"deleteSubDir"===s.type||"clear"===s.type&&"object"==typeof s.previousStorage||"createSubDir"===s.type&&"boolean"==typeof s.previouslyExisted))throw new Error("Invalid localOpMetadata");var s;if("clear"===e.type&&"clear"===t.type){t.previousStorage.forEach((e,t)=>{this.setCore(t,e,!0)});const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else if("delete"!==e.type&&"set"!==e.type||"edit"!==t.type)if("createSubDirectory"===e.type&&"createSubDir"===t.type)t.previouslyExisted||this.deleteSubDirectoryCore(e.subdirName,!0),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId);else{if("deleteSubDirectory"!==e.type||"deleteSubDir"!==t.type)throw new Error("Unsupported op for rollback");void 0!==t.subDirectory&&(this.undeleteSubDirectoryTree(t.subDirectory),this._subdirectories.set(e.subdirName,t.subDirectory),this.emit("subDirectoryCreated",e.subdirName,!0,this)),this.rollbackPendingMessageId(this.pendingSubDirectories,e.subdirName,t.pendingMessageId)}else void 0===t.previousValue?this.deleteCore(e.key,!0):this.setCore(e.key,t.previousValue,!0),this.rollbackPendingMessageId(this.pendingKeys,e.key,t.pendingMessageId)}makeAbsolute(e){return f.resolve(this.absolutePath,e)}needProcessStorageOperation(e,t,s){if(this.pendingClearMessageIds.length>0)return t&&Object(i.a)(void 0!==s&&y(s)&&s.pendingMessageId<this.pendingClearMessageIds[0],16),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){Object(i.a)(void 0!==s&&y(s),17);const t=this.pendingKeys.get(e.key);Object(i.a)(void 0!==t&&t[0]===s.pendingMessageId,817),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}needProcessSubDirectoryOperation(e,t,s){if(void 0!==this.pendingSubDirectories.get(e.subdirName)){if(t){Object(i.a)(w(s),18);const t=this.pendingSubDirectories.get(e.subdirName);Object(i.a)(void 0!==t&&t[0]===s.pendingMessageId,818),t.shift(),0===t.length&&this.pendingSubDirectories.delete(e.subdirName)}return!1}return!t}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,s,n)=>{e.set(s,this._storage.get(s))}),this.clearCore(!1),e.forEach((e,t,s)=>{this.setCore(t,e,!0)})}clearCore(e){this._storage.clear(),this.directory.emit("clear",e,this.directory)}deleteCore(e,t){const s=this._storage.get(e),n=null==s?void 0:s.value;if(this._storage.delete(e)){const s={key:e,path:this.absolutePath,previousValue:n};this.directory.emit("valueChanged",s,t,this.directory);const r={key:e,previousValue:n};this.emit("containedValueChanged",r,t,this)}return s}setCore(e,t,s){const n=this._storage.get(e),r=null==n?void 0:n.value;this._storage.set(e,t);const i={key:e,path:this.absolutePath,previousValue:r};this.directory.emit("valueChanged",i,s,this.directory);const o={key:e,previousValue:r};return this.emit("containedValueChanged",o,s,this),n}createSubDirectoryCore(e,t){if(!this._subdirectories.has(e)){const s=f.join(this.absolutePath,e),n=new C(this.directory,this.runtime,this.serializer,s);return this.registerEventsOnSubDirectory(n,e),this._subdirectories.set(e,n),this.emit("subDirectoryCreated",e,t,this),!0}return!1}registerEventsOnSubDirectory(e,t){e.on("subDirectoryCreated",(e,s)=>{this.emit("subDirectoryCreated",f.join(t,e),s,this)}),e.on("subDirectoryDeleted",(e,s)=>{this.emit("subDirectoryDeleted",f.join(t,e),s,this)})}deleteSubDirectoryCore(e,t){const s=this._subdirectories.get(e);return void 0!==s&&(this._subdirectories.delete(e),this.disposeSubDirectoryTree(s),this.emit("subDirectoryDeleted",e,t,this)),s}disposeSubDirectoryTree(e){if(!e)return;const t=e.subdirectories();for(const[s,n]of t)this.disposeSubDirectoryTree(n);"function"==typeof e.dispose&&e.dispose()}undeleteSubDirectoryTree(e){for(const[t,s]of this._subdirectories.entries())this.undeleteSubDirectoryTree(s);e.undispose()}}},18197:function(e,t,s){"use strict";(function(t){function s(e){if("string"!=typeof e)throw new TypeError("Path must be a string. Received "+JSON.stringify(e))}function n(e,t){for(var s,n="",r=0,i=-1,o=0,a=0;a<=e.length;++a){if(a<e.length)s=e.charCodeAt(a);else{if(47===s)break;s=47}if(47===s){if(i===a-1||1===o);else if(i!==a-1&&2===o){if(n.length<2||2!==r||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){var c=n.lastindexOf("/");if(c!==n.length-1){-1===c?(n="",r=0):r=(n=n.slice(0,c)).length-1-n.lastindexOf("/"),i=a,o=0;continue}}else if(2===n.length||1===n.length){n="",r=0,i=a,o=0;continue}t&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+="/"+e.slice(i+1,a):n=e.slice(i+1,a),r=a-i-1;i=a,o=0}else 46===s&&-1!==o?++o:o=-1}return n}var r={resolve:function(){for(var e,r="",i=!1,o=arguments.length-1;o>=-1&&!i;o--){var a;o>=0?a=arguments[o]:(void 0===e&&(e=t.cwd()),a=e),s(a),0!==a.length&&(r=a+"/"+r,i=47===a.charCodeAt(0))}return r=n(r,!i),i?r.length>0?"/"+r:"/":r.length>0?r:"."},normalize:function(e){if(s(e),0===e.length)return".";var t=47===e.charCodeAt(0),r=47===e.charCodeAt(e.length-1);return 0!==(e=n(e,!t)).length||t||(e="."),e.length>0&&r&&(e+="/"),t?"/"+e:e},isAbsolute:function(e){return s(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0===arguments.length)return".";for(var e,t=0;t<arguments.length;++t){var n=arguments[t];s(n),n.length>0&&(void 0===e?e=n:e+="/"+n)}return void 0===e?".":r.normalize(e)},relative:function(e,t){if(s(e),s(t),e===t)return"";if((e=r.resolve(e))===(t=r.resolve(t)))return"";for(var n=1;n<e.length&&47===e.charCodeAt(n);++n);for(var i=e.length,o=i-n,a=1;a<t.length&&47===t.charCodeAt(a);++a);for(var c=t.length-a,h=o<c?o:c,u=-1,l=0;l<=h;++l){if(l===h){if(c>h){if(47===t.charCodeAt(a+l))return t.slice(a+l+1);if(0===l)return t.slice(a+l)}else o>h&&(47===e.charCodeAt(n+l)?u=l:0===l&&(u=0));break}var d=e.charCodeAt(n+l);if(d!==t.charCodeAt(a+l))break;47===d&&(u=l)}var p="";for(l=n+u+1;l<=i;++l)l!==i&&47!==e.charCodeAt(l)||(0===p.length?p+="..":p+="/..");return p.length>0?p+t.slice(a+u):(a+=u,47===t.charCodeAt(a)&&++a,t.slice(a))},_makeLong:function(e){return e},dirname:function(e){if(s(e),0===e.length)return".";for(var t=e.charCodeAt(0),n=47===t,r=-1,i=!0,o=e.length-1;o>=1;--o)if(47===(t=e.charCodeAt(o))){if(!i){r=o;break}}else i=!1;return-1===r?n?"/":".":n&&1===r?"//":e.slice(0,r)},basename:function(e,t){if(void 0!==t&&"string"!=typeof t)throw new TypeError('"ext" argument must be a string');s(e);var n,r=0,i=-1,o=!0;if(void 0!==t&&t.length>0&&t.length<=e.length){if(t.length===e.length&&t===e)return"";var a=t.length-1,c=-1;for(n=e.length-1;n>=0;--n){var h=e.charCodeAt(n);if(47===h){if(!o){r=n+1;break}}else-1===c&&(o=!1,c=n+1),a>=0&&(h===t.charCodeAt(a)?-1==--a&&(i=n):(a=-1,i=c))}return r===i?i=c:-1===i&&(i=e.length),e.slice(r,i)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!o){r=n+1;break}}else-1===i&&(o=!1,i=n+1);return-1===i?"":e.slice(r,i)},extname:function(e){s(e);for(var t=-1,n=0,r=-1,i=!0,o=0,a=e.length-1;a>=0;--a){var c=e.charCodeAt(a);if(47!==c)-1===r&&(i=!1,r=a+1),46===c?-1===t?t=a:1!==o&&(o=1):-1!==t&&(o=-1);else if(!i){n=a+1;break}}return-1===t||-1===r||0===o||1===o&&t===r-1&&t===n+1?"":e.slice(t,r)},format:function(e){if(null===e||"object"!=typeof e)throw new TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return function(e,t){var s=t.dir||t.root,n=t.base||(t.name||"")+(t.ext||"");return s?s===t.root?s+n:s+e+n:n}("/",e)},parse:function(e){s(e);var t={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return t;var n,r=e.charCodeAt(0),i=47===r;i?(t.root="/",n=1):n=0;for(var o=-1,a=0,c=-1,h=!0,u=e.length-1,l=0;u>=n;--u)if(47!==(r=e.charCodeAt(u)))-1===c&&(h=!1,c=u+1),46===r?-1===o?o=u:1!==l&&(l=1):-1!==o&&(l=-1);else if(!h){a=u+1;break}return-1===o||-1===c||0===l||1===l&&o===c-1&&o===a+1?-1!==c&&(t.base=t.name=0===a&&i?e.slice(1,c):e.slice(a,c)):(0===a&&i?(t.name=e.slice(1,o),t.base=e.slice(1,c)):(t.name=e.slice(a,o),t.base=e.slice(a,c)),t.ext=e.slice(o,c)),a>0?t.dir=e.slice(0,a-1):i&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};r.posix=r,e.exports=r}).call(this,s(12023))},18198:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="1.3.6"},18199:function(e,t,s){"use strict";s.d(t,"b",(function(){return i})),s.d(t,"a",(function(){return a}));var n=s(18032),r=s(18033);function i(e,t,s){const n=e.makeSerialized(t,s);return{type:n.type,value:n.value&&JSON.parse(n.value)}}class o{constructor(e){this.value=e}get type(){return n.a[n.a.Plain]}makeSerialized(e,t){const s=Object(r.d)(this.value,e,t);return{type:this.type,value:s}}}class a{constructor(e){this.serializer=e}fromSerializable(e){if(e.type===n.a[n.a.Shared]){e.type=n.a[n.a.Plain];const t={type:"__fluid_handle__",url:e.value};e.value=t}const t=Object(r.c)(e.value,this.serializer);return new o(t)}fromInMemory(e){return new o(e)}}},18200:function(e,t,s){"use strict";s.d(t,"a",(function(){return u})),s.d(t,"b",(function(){return l}));var n,r=s(17970),i=s(17982),o=s(17937),a=s(17991),c=s(18201),h=s(18198);class u{get type(){return u.Type}get attributes(){return u.Attributes}async load(e,t,s,n){const r=new l(t,e,n);return await r.load(s),r}create(e,t){const s=new l(t,e,u.Attributes);return s.initializeLocal(),s}}u.Type="https://graph.microsoft.com/types/map",u.Attributes={type:u.Type,snapshotFormatVersion:"0.2",packageVersion:h.a};class l extends o.a{constructor(e,t,s){super(e,t,s,"fluid_map_"),this[n]="SharedMap",this.kernel=new c.a(this.serializer,this.handle,(e,t)=>this.submitLocalMessage(e,t),()=>this.isAttached(),this)}static create(e,t){return e.createChannel(t,u.Type)}static getFactory(){return new u}keys(){return this.kernel.keys()}entries(){return this.kernel.entries()}values(){return this.kernel.values()}[(n=Symbol.toStringTag,Symbol.iterator)](){return this.kernel.entries()}get size(){return this.kernel.size}forEach(e){this.kernel.forEach(e)}get(e){return this.kernel.get(e)}has(e){return this.kernel.has(e)}set(e,t){return this.kernel.set(e,t),this}delete(e){return this.kernel.delete(e)}clear(){this.kernel.clear()}summarizeCore(e,t){let s=0,n=0,r={};const i=[],o=new a.a,c=this.kernel.getSerializedStorage(e);for(const a of Object.keys(c)){const e=c[a];if(e.value&&e.value.length>=8192){const t="blob"+n;n++,i.push(t);const s={[a]:{type:e.type,value:JSON.parse(e.value)}};o.addBlob(t,JSON.stringify(s))}else{if(s+=e.type.length+21,e.value&&(s+=e.value.length),s>16384){const e="blob"+n;n++,i.push(e),o.addBlob(e,JSON.stringify(r)),r={},s=0}r[a]={type:e.type,value:void 0===e.value?void 0:JSON.parse(e.value)}}}const h={blobs:i,content:r};return o.addBlob("header",JSON.stringify(h)),o.getSummaryTree()}async loadCore(e){const t=await Object(i.a)(e,"header"),s=t;Array.isArray(s.blobs)?(this.kernel.populateFromSerializable(s.content),await Promise.all(s.blobs.map(async t=>{const s=await Object(i.a)(e,t);this.kernel.populateFromSerializable(s)}))):this.kernel.populateFromSerializable(t)}onDisconnect(){}reSubmitCore(e,t){this.kernel.trySubmitMessage(e,t)}applyStashedOp(e){return this.kernel.tryProcessMessage(e,!1,void 0),this.kernel.tryGetStashedOpLocalMetadata(e)}processCore(e,t,s){e.type===r.a.Operation&&this.kernel.tryProcessMessage(e.contents,t,s)}rollback(e,t){this.kernel.rollback(e,t)}}},18201:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(18032),r=s(17940),i=s(18199);function o(e){return void 0!==e&&"number"==typeof e.pendingMessageId&&("add"===e.type||"edit"===e.type)}function a(e){return void 0!==e&&"clear"===e.type&&"number"==typeof e.pendingMessageId}class c{constructor(e,t,s,n,r){this.serializer=e,this.handle=t,this.submitMessage=s,this.isAttached=n,this.eventEmitter=r,this.messageHandlers=new Map,this.data=new Map,this.pendingKeys=new Map,this.pendingMessageId=-1,this.pendingClearMessageIds=[],this.localValueMaker=new i.a(e),this.messageHandlers=this.getMessageHandlers()}get size(){return this.data.size}keys(){return this.data.keys()}entries(){const e=this.data.entries();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:[t.value[0],t.value[1].value],done:!1}},[Symbol.iterator](){return this}}}values(){const e=this.data.values();return{next(){const t=e.next();return t.done?{value:void 0,done:!0}:{value:t.value.value,done:!1}},[Symbol.iterator](){return this}}}[Symbol.iterator](){return this.entries()}forEach(e){this.data.forEach((t,s,n)=>{e(t.value,s,n)})}get(e){const t=this.data.get(e);return void 0===t?void 0:t.value}has(e){return this.data.has(e)}set(e,t){if(null==e)throw new Error("Undefined and null keys are not supported");const s=this.localValueMaker.fromInMemory(t),n=Object(i.b)(s,this.serializer,this.handle),r=this.setCore(e,s,!0);if(!this.isAttached())return;const o={key:e,type:"set",value:n};this.submitMapKeyMessage(o,r)}delete(e){const t=this.deleteCore(e,!0);if(!this.isAttached())return void 0!==t;const s={key:e,type:"delete"};return this.submitMapKeyMessage(s,t),void 0!==t}clear(){const e=this.isAttached()?new Map(this.data):void 0;if(this.clearCore(!0),!this.isAttached())return;this.submitMapClearMessage({type:"clear"},e)}getSerializedStorage(e){const t={};return this.data.forEach((s,n)=>{t[n]=s.makeSerialized(e,this.handle)}),t}getSerializableStorage(e){const t={};return this.data.forEach((s,n)=>{t[n]=Object(i.b)(s,e,this.handle)}),t}serialize(e){return JSON.stringify(this.getSerializableStorage(e))}populateFromSerializable(e){for(const[t,s]of Object.entries(e)){const e={key:t,value:this.makeLocal(t,s)};this.data.set(e.key,e.value)}}populate(e){this.populateFromSerializable(JSON.parse(e))}trySubmitMessage(e,t){const s=this.messageHandlers.get(e.type);return void 0!==s&&(s.submit(e,t),!0)}tryGetStashedOpLocalMetadata(e){const t=this.messageHandlers.get(e.type);if(void 0===t)throw new Error("no apply stashed op handler");return t.getStashedOpLocalMetadata(e)}tryProcessMessage(e,t,s){const n=this.messageHandlers.get(e.type);return void 0!==n&&(n.process(e,t,s),!0)}rollback(e,t){if(void 0===(s=t)||"number"!=typeof s.pendingMessageId||"add"!==s.type&&"edit"!==s.type&&"clear"!==s.type)throw new Error("Invalid localOpMetadata");var s;if("clear"===e.type&&"clear"===t.type){if(void 0===t.previousMap)throw new Error("Cannot rollback without previous map");t.previousMap.forEach((e,t)=>{this.setCore(t,e,!0)});const e=this.pendingClearMessageIds.pop();if(void 0===e||e!==t.pendingMessageId)throw new Error("Rollback op does match last clear")}else{if("delete"!==e.type&&"set"!==e.type)throw new Error("Unsupported op for rollback");{if("add"===t.type)this.deleteCore(e.key,!0);else{if("edit"!==t.type||void 0===t.previousValue)throw new Error("Cannot rollback without previous value");this.setCore(e.key,t.previousValue,!0)}const s=this.pendingKeys.get(e.key),n=null==s?void 0:s.pop();if(!s||n!==t.pendingMessageId)throw new Error("Rollback op does not match last pending");0===s.length&&this.pendingKeys.delete(e.key)}}}setCore(e,t,s){const n=this.data.get(e),r=null==n?void 0:n.value;return this.data.set(e,t),this.eventEmitter.emit("valueChanged",{key:e,previousValue:r},s,this.eventEmitter),n}clearCore(e){this.data.clear(),this.eventEmitter.emit("clear",e,this.eventEmitter)}deleteCore(e,t){const s=this.data.get(e),n=null==s?void 0:s.value;return this.data.delete(e)&&this.eventEmitter.emit("valueChanged",{key:e,previousValue:n},t,this.eventEmitter),s}clearExceptPendingKeys(){const e=new Map;this.pendingKeys.forEach((t,s)=>{e.set(s,this.data.get(s))}),this.clearCore(!1),e.forEach((e,t)=>{this.setCore(t,e,!0)})}makeLocal(e,t){if(t.type===n.a[n.a.Plain]||t.type===n.a[n.a.Shared])return this.localValueMaker.fromSerializable(t);throw new Error("Unknown local value type")}needProcessKeyOperation(e,t,s){if(this.pendingClearMessageIds.length>0)return t&&Object(r.a)(void 0!==s&&o(s)&&s.pendingMessageId<this.pendingClearMessageIds[0],19),!1;if(void 0!==this.pendingKeys.get(e.key)){if(t){Object(r.a)(void 0!==s&&o(s),20);const t=this.pendingKeys.get(e.key);Object(r.a)(void 0!==t&&t[0]===s.pendingMessageId,762),t.shift(),0===t.length&&this.pendingKeys.delete(e.key)}return!1}return!t}getMessageHandlers(){const e=new Map;return e.set("clear",{process:(e,t,s)=>{if(t){Object(r.a)(a(s),21);const e=this.pendingClearMessageIds.shift();Object(r.a)(e===s.pendingMessageId,763)}else 0===this.pendingKeys.size?this.clearCore(t):this.clearExceptPendingKeys()},submit:(e,t)=>{Object(r.a)(a(t),764);const s=this.pendingClearMessageIds.shift();Object(r.a)(s===t.pendingMessageId,765),this.submitMapClearMessage(e,t.previousMap)},getStashedOpLocalMetadata:e=>({type:"clear",pendingMessageId:this.getMapClearMessageId()})}),e.set("delete",{process:(e,t,s)=>{this.needProcessKeyOperation(e,t,s)&&this.deleteCore(e.key,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e.set("set",{process:(e,t,s)=>{if(!this.needProcessKeyOperation(e,t,s))return;const n=this.makeLocal(e.key,e.value);this.setCore(e.key,n,t)},submit:(e,t)=>{this.resubmitMapKeyMessage(e,t)},getStashedOpLocalMetadata:e=>({type:"edit",pendingMessageId:this.getMapKeyMessageId(e)})}),e}getMapClearMessageId(){const e=++this.pendingMessageId;return this.pendingClearMessageIds.push(e),e}submitMapClearMessage(e,t){const s={type:"clear",pendingMessageId:this.getMapClearMessageId(),previousMap:t};this.submitMessage(e,s)}getMapKeyMessageId(e){const t=++this.pendingMessageId,s=this.pendingKeys.get(e.key);return void 0!==s?s.push(t):this.pendingKeys.set(e.key,[t]),t}submitMapKeyMessage(e,t){const s=this.getMapKeyMessageId(e),n=t?{type:"edit",pendingMessageId:s,previousValue:t}:{type:"add",pendingMessageId:s};this.submitMessage(e,n)}resubmitMapKeyMessage(e,t){Object(r.a)(o(t),766);const s=this.pendingKeys.get(e.key);Object(r.a)(void 0!==s&&s[0]===t.pendingMessageId,767),s.shift(),0===s.length&&this.pendingKeys.delete(e.key);const n=this.getMapKeyMessageId(e),i="edit"===t.type?{type:"edit",pendingMessageId:n,previousValue:t.previousValue}:{type:"add",pendingMessageId:n};this.submitMessage(e,i)}}},18202:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return r})),s.d(t,"c",(function(){return i}));const n=e=>void 0!==(null==e?void 0:e.factory),r=e=>void 0!==(null==e?void 0:e.getFactory),i=e=>{var t;const s=new Set,i=new Set;if(new Set([...Object.values(e.initialObjects),...null!==(t=e.dynamicObjectTypes)&&void 0!==t?t:[]]).forEach(e=>{if(r(e))i.add(e.getFactory());else{if(!n(e))throw new Error("Entry is neither a DataObject or a SharedObject");s.add([e.factory.type,Promise.resolve(e.factory)])}}),0===s.size&&0===i.size)throw new Error("Container cannot be initialized without any DataTypes");return[Array.from(s),Array.from(i)]}},18203:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var n=s(18024),r=s(17962),i=s(18207),o=s(18193),a=s(18205),c=s(18204);class h extends c.a{constructor(e,t,s=[],r){super(),this.registryEntries=e,this.dependencyContainer=t,this.requestHandlers=s,this.runtimeOptions=r,this.registry=new n.a(e)}get IFluidDataStoreRegistry(){return this.registry}async instantiateFirstTime(e){await this.containerInitializingFirstTime(e),await this.containerHasInitialized(e)}async instantiateFromExisting(e){await this.containerHasInitialized(e)}async preInitialize(e,t){const s=e.scope,n=new a.a(this.dependencyContainer,s.IFluidDependencySynthesizer);s.IFluidDependencySynthesizer=n;const c=await r.a.load(e,this.registryEntries,Object(o.a)(...this.requestHandlers),this.runtimeOptions,s,t);return n.register(i.IContainerRuntime,c),c}async containerInitializingFirstTime(e){}async containerHasInitialized(e){}}},18204:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{get IRuntimeFactory(){return this}async instantiateRuntime(e,t){const s=void 0===t?!0===e.existing:t,n=await this.preInitialize(e,s);return s?await this.instantiateFromExisting(n):await this.instantiateFirstTime(n),await this.hasInitialized(n),n}async instantiateFirstTime(e){}async instantiateFromExisting(e){}async hasInitialized(e){}}},18205:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18206);class r{constructor(...e){this.providers=new Map,this.parents=e.filter(e=>void 0!==e)}get IFluidDependencySynthesizer(){return this}register(e,t){if(this.providers.has(e))throw new Error(`Attempting to register a provider of type ${e} that already exists`);this.providers.set(e,t)}unregister(e){this.providers.has(e)&&this.providers.delete(e)}synthesize(e,t){const s={};return this.generateRequired(s,t),this.generateOptional(s,e),Object.defineProperty(s,n.a,{get:()=>this}),s}has(e,t){return!!this.providers.has(e)||!0!==t&&this.parents.some(t=>t.has(e))}getProvider(e){if(this.has(e)){if(this.providers.has(e))return this.providers.get(e);for(const t of this.parents){if(t instanceof r)return t.getProvider(e);{const s=t;if(void 0!==(null==s?void 0:s.getProvider))return s.getProvider(e)}}}}generateRequired(e,t){if(void 0!==t)for(const s of Object.keys(t)){const t=this.resolveProvider(s);if(void 0===t)throw new Error("Object attempted to be created without registered required provider "+s);Object.defineProperty(e,s,t)}}generateOptional(e,t){var s;if(void 0!==t)for(const n of Object.keys(t)){const t=null!==(s=this.resolveProvider(n))&&void 0!==s?s:{get:async()=>{}};Object.defineProperty(e,n,t)}}resolveProvider(e){const t=this.providers.get(e);if(void 0!==t)return"function"==typeof t?{get(){if(t&&"function"==typeof t)return Promise.resolve(this[n.a]).then(async e=>t(e)).then(t=>null==t?void 0:t[e])}}:{get(){if(t)return Promise.resolve(t).then(t=>{if(t)return t[e]})}};for(const s of this.parents){const t={[e]:e},n=s.synthesize(t,{}),r=Object.getOwnPropertyDescriptor(n,e);if(void 0!==r)return r}}}},18206:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="IFluidDependencySynthesizer"},18207:function(e,t,s){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,s,n){void 0===n&&(n=s),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[s]}})}:function(e,t,s,n){void 0===n&&(n=s),e[n]=t[s]}),r=this&&this.__exportStar||function(e,t){for(var s in e)"default"===s||Object.prototype.hasOwnProperty.call(t,s)||n(t,e,s)};Object.defineProperty(t,"__esModule",{value:!0}),r(s(18208),t)},18208:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IContainerRuntime=void 0,t.IContainerRuntime="IContainerRuntime"},18209:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(18196),r=s(18200),i=s(18211),o=s(18210);class a extends o.a{constructor(e,t,s=[],o,a,c=i.a){const h=[...s];s.find(e=>e.type===n.a.Type)||h.push(n.b.getFactory()),s.find(e=>e.type===r.a.Type)||h.push(r.b.getFactory()),super(e,t,h,o,a,c)}}},18210:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(18211),r=s(18024),i=s(18205),o=s(18190);async function a(e,t,s,r,a,c,h){let u=a;u=Object(n.b)(async(e,t)=>(await o.a.getDataObject(t)).request(e),u);const l=new u(t,s,c),d=t.scope,p=new e({runtime:l,context:t,providers:new i.a(d.IFluidDependencySynthesizer).synthesize(r,{}),initProps:h});return c||await p.finishInitialization(c),{instance:p,runtime:l}}class c{constructor(e,t,s,i,o,a=n.a){if(this.type=e,this.ctor=t,this.optionalProviders=i,this.runtimeClass=a,""===this.type)throw new Error("undefined type member");void 0!==o&&(this.registry=new r.a(o)),this.sharedObjectRegistry=new Map(s.map(e=>[e.type,e]))}get IFluidDataStoreFactory(){return this}get IFluidDataStoreRegistry(){return this.registry}get registryEntry(){return[this.type,Promise.resolve(this)]}async instantiateDataStore(e,t){const{runtime:s}=await a(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,t);return s}async createChildInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,[...e.packagePath,this.type],t)}async createPeerInstance(e,t){return this.createNonRootInstanceCore(e.containerRuntime,e.packagePath,t)}async createInstance(e,t){return this.createNonRootInstanceCore(e,[this.type],t)}async createRootInstance(e,t,s){const n=t.createDetachedRootDataStore([this.type],e);return this.createInstanceCore(n,s)}async createNonRootInstanceCore(e,t,s){const n=e.createDetachedDataStore(t);return this.createInstanceCore(n,s)}async createInstanceCore(e,t){const{instance:s,runtime:n}=await a(this.ctor,e,this.sharedObjectRegistry,this.optionalProviders,this.runtimeClass,!1,t);return await e.attachRuntime(this,n),s}}},18211:function(e,t,s){"use strict";s.d(t,"a",(function(){return M})),s.d(t,"b",(function(){return k}));var n,r=s(17959),i=s(17957),o=s(17939),a=s(17979),c=s(17940),h=s(17989),u=s(17944),l=s(18026),d=s(17945),p=s(17993),g=s(17981),m=s(17963),f=s(17943),b=s(18025),v=s(17997),y=s(17991),S=s(17998),w=s(17946),C=s(18213),O=s(18212),j=s(18217);!function(e){e.Attach="attach",e.ChannelOp="op"}(n||(n={}));class M extends o.a{constructor(e,t,s){super(),this.dataStoreContext=e,this.sharedObjectRegistry=t,this._disposed=!1,this.contexts=new Map,this.contextsDeferred=new Map,this.pendingAttach=new Map,this.deferredAttached=new a.a,this.localChannelContextQueue=new Map,this.notBoundedChannelContextSet=new Set,this.pendingHandlesToMakeVisible=new Set,Object(c.a)(!e.id.includes("/"),782),this.logger=u.a.create(e.logger,"FluidDataStoreRuntime",{all:{dataStoreId:Object(w.a)()}}),this.id=e.id,this.options=e.options,this.deltaManager=e.deltaManager,this.quorum=e.getQuorum(),this.audience=e.getAudience();const n=e.baseSnapshot;this.channelsBaseGCDetails=new a.b(async()=>{var e,t,s;const n=await(null!==(s=null===(t=(e=this.dataStoreContext).getBaseGCDetails)||void 0===t?void 0:t.call(e))&&void 0!==s?s:this.dataStoreContext.getInitialGCSummaryDetails());return Object(S.g)(n)}),void 0!==(null==n?void 0:n.trees)&&Object.keys(n.trees).forEach(t=>{if("_search"===t)return;let s;e.isLocalDataStore?(s=new O.c(t,this.sharedObjectRegistry,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(e,s)=>this.submitChannelOp(t,e,s),e=>this.setChannelDirty(e),(e,t)=>this.addedGCOutboundReference(e,t),n.trees[t]),e.attachState!==r.a.Detached?s.makeVisible():this.localChannelContextQueue.set(t,s)):s=new j.a(this,e,e.storage,(e,s)=>this.submitChannelOp(t,e,s),e=>this.setChannelDirty(e),(e,t)=>this.addedGCOutboundReference(e,t),t,n.trees[t],this.sharedObjectRegistry,void 0,this.dataStoreContext.getCreateChildSummarizerNodeFn(t,{type:m.CreateSummarizerNodeSource.FromSummary}),async()=>this.getChannelBaseGCDetails(t));const i=new a.a;i.resolve(s),this.contexts.set(t,s),this.contextsDeferred.set(t,i)}),this.attachListener(),this.bindState=s?r.b.Bound:r.b.NotBound,this._attachState=e.attachState,this.visibilityState=s?e.attachState===r.a.Detached?m.VisibilityState.LocallyVisible:m.VisibilityState.GloballyVisible:m.VisibilityState.NotVisible,s&&this.deferredAttached.resolve()}static load(e,t,s){return new M(e,t,s)}get IFluidRouter(){return this}get connected(){return this.dataStoreContext.connected}get clientId(){return this.dataStoreContext.clientId}get clientDetails(){return this.dataStoreContext.clientDetails}get isAttached(){return this.attachState!==r.a.Detached}get attachState(){return this._attachState}get absolutePath(){return Object(f.a)(this.id,this.routeContext)}get routeContext(){return this.dataStoreContext.IFluidHandleContext}get IFluidHandleContext(){return this}get rootRoutingContext(){return this}get channelsRoutingContext(){return this}get objectsRoutingContext(){return this}get disposed(){return this._disposed}dispose(){this._disposed||(this._disposed=!0,this.emit("dispose"),this.removeAllListeners())}async resolveHandle(e){return this.request(e)}async request(e){try{const s=b.a.create(e),n=s.pathParts[0];if("_channels"===n||"_custom"===n)return this.request(s.createSubRequest(1));if(this.contextsDeferred.has(n)&&s.isLeaf(1))try{const e=await this.contextsDeferred.get(n).promise;return{mimeType:"fluid/object",status:200,value:await e.getChannel()}}catch(t){return this.logger.sendErrorEvent({eventName:"GetChannelFailedInRequest"},t),Object(v.b)(500,"Failed to get Channel: "+t,e)}return Object(v.a)(e)}catch(t){return Object(v.c)(t)}}async getChannel(e){this.verifyNotClosed(),this.contextsDeferred.has(e)||this.contextsDeferred.set(e,new a.a);const t=await this.contextsDeferred.get(e).promise;return await t.getChannel()}createChannel(e=Object(w.a)(),t){if(e.includes("/"))throw new i.f("Id cannot contain slashes: "+e);this.verifyNotClosed(),Object(c.a)(!this.contexts.has(e),377),this.notBoundedChannelContextSet.add(e);const s=new O.a(e,this.sharedObjectRegistry,t,this,this.dataStoreContext,this.dataStoreContext.storage,this.logger,(t,s)=>this.submitChannelOp(e,t,s),e=>this.setChannelDirty(e),(e,t)=>this.addedGCOutboundReference(e,t));if(this.contexts.set(e,s),this.contextsDeferred.has(e))this.contextsDeferred.get(e).resolve(s);else{const t=new a.a;t.resolve(s),this.contextsDeferred.set(e,t)}return Object(c.a)(!!s.channel,378),s.channel}bindChannel(e){Object(c.a)(this.notBoundedChannelContextSet.has(e.id),379),this.notBoundedChannelContextSet.delete(e.id),this.isAttached?this.attachChannel(e):this.pendingHandlesToMakeVisible.has(e.handle)||(this.bind(e.handle),this.localChannelContextQueue.has(e.id)||this.localChannelContextQueue.set(e.id,this.contexts.get(e.id)))}makeVisibleAndAttachGraph(){this.visibilityState===m.VisibilityState.NotVisible&&(this.visibilityState=m.VisibilityState.LocallyVisible,this.pendingHandlesToMakeVisible.forEach(e=>{e.attachGraph()}),this.pendingHandlesToMakeVisible.clear(),this.bindToContext())}attachGraph(){this.makeVisibleAndAttachGraph()}bindToContext(){this.bindState===r.b.NotBound&&(this.bindState=r.b.Binding,this.dataStoreContext.bindToContext(),this.bindState=r.b.Bound)}bind(e){this.visibilityState===m.VisibilityState.NotVisible?this.pendingHandlesToMakeVisible.add(e):e.attachGraph()}setConnectionState(e,t){this.verifyNotClosed();for(const[,s]of this.contexts)s.setConnectionState(e,t);Object(l.c)(this.logger,this,e,t)}getQuorum(){return this.quorum}getAudience(){return this.audience}async uploadBlob(e){return this.verifyNotClosed(),this.dataStoreContext.uploadBlob(e)}process(e,t,s){this.verifyNotClosed();try{switch(e.type){case n.Attach:{const s=e.contents,n=s.id;if(t)Object(c.a)(this.pendingAttach.has(n),380),this.pendingAttach.delete(n);else{Object(c.a)(!this.contexts.has(n),381);const t=new Map,r=Object(p.a)(s.snapshot.entries,t),i=new j.a(this,this.dataStoreContext,this.dataStoreContext.storage,(e,t)=>this.submitChannelOp(n,e,t),e=>this.setChannelDirty(e),(e,t)=>this.addedGCOutboundReference(e,t),n,r,this.sharedObjectRegistry,t,this.dataStoreContext.getCreateChildSummarizerNodeFn(n,{type:m.CreateSummarizerNodeSource.FromAttach,sequenceNumber:e.sequenceNumber,snapshot:s.snapshot}),async()=>this.getChannelBaseGCDetails(n),s.type);if(this.contexts.set(n,i),this.contextsDeferred.has(n))this.contextsDeferred.get(n).resolve(i);else{const e=new a.a;e.resolve(i),this.contextsDeferred.set(n,e)}}break}case n.ChannelOp:this.processChannelOp(e,t,s)}this.emit("op",e)}catch(r){throw i.c.wrapIfUnrecognized(r,"fluidDataStoreRuntimeFailedToProcessMessage",e)}}processSignal(e,t){this.emit("signal",e,t)}isChannelAttached(e){return!this.notBoundedChannelContextSet.has(e)&&!this.localChannelContextQueue.has(e)&&!this.pendingAttach.has(e)}getOutboundRoutes(){const e=[];for(const[t]of this.contexts)e.push(`${this.absolutePath}/${t}`);return e}updateGCNodes(e){e.addRouteToAllNodes(this.absolutePath),e.addNode("/",this.getOutboundRoutes())}async getGCData(e=!1){const t=new S.a;return await Promise.all(Array.from(this.contexts).filter(([e,t])=>this.isChannelAttached(e)).map(async([s,n])=>{const r=await n.getGCData(e);t.prefixAndAddNodes(s,r.gcNodes)})),this.updateGCNodes(t),t.getGCData()}updateUsedRoutes(e,t){var s;const n=Object(S.h)(e);for(const[r]of n)Object(c.a)(this.contexts.has(r),382);for(const[r,i]of this.contexts)i.updateUsedRoutes(null!==(s=n.get(r))&&void 0!==s?s:[],t)}addedGCOutboundReference(e,t){var s,n;null===(n=(s=this.dataStoreContext).addedGCOutboundReference)||void 0===n||n.call(s,e,t)}async getChannelBaseGCDetails(e){var t;let s=(await this.channelsBaseGCDetails).get(e);return void 0===s?s={}:void 0!==(null===(t=s.gcData)||void 0===t?void 0:t.gcNodes)&&Object(S.e)(s.gcData.gcNodes,this.absolutePath),void 0!==s.usedRoutes&&0!==s.usedRoutes.length||(s.usedRoutes=[""]),s}async summarize(e=!1,t=!0,s){const n=new y.a;return await Promise.all(Array.from(this.contexts).filter(([e,t])=>{const s=this.isChannelAttached(e);return Object(c.a)(s,383),s}).map(async([r,i])=>{const o=await i.summarize(e,t,s);n.addWithStats(r,o)})),n.getSummaryTree()}getAttachSummary(e){this.attachGraph();const t=new y.a;for(const[s,n]of this.contexts){if(!(n instanceof O.b))throw new d.a("Should only be called with local channel handles");if(!this.notBoundedChannelContextSet.has(s)){let r;if(n.isLoaded){const t=n.getAttachSummary(e);Object(c.a)(t.summary.type===g.a.Tree,384),r={stats:t.stats,summary:t.summary}}else Object(c.a)(!!this.dataStoreContext.baseSnapshot,385),r=Object(y.g)(this.dataStoreContext.baseSnapshot.trees[s]);t.addWithStats(s,r)}}return t.getSummaryTree()}submitMessage(e,t,s){this.submit(e,t,s)}submitSignal(e,t){return this.verifyNotClosed(),this.dataStoreContext.submitSignal(e,t)}async waitAttached(){return this.deferredAttached.promise}attachChannel(e){if(this.verifyNotClosed(),e.handle.isAttached)return;e.handle.attachGraph(),Object(c.a)(this.isAttached,386),Object(c.a)(this.visibilityState===m.VisibilityState.GloballyVisible,720);const t=Object(C.c)(e,!0,!1),s=Object(y.h)(t.summary),r={id:e.id,snapshot:s,type:e.attributes.type};this.pendingAttach.set(e.id,r),this.submit(n.Attach,r);this.contexts.get(e.id).makeVisible()}submitChannelOp(e,t,s){const r={address:e,contents:t};this.submit(n.ChannelOp,r,s)}submit(e,t,s){this.verifyNotClosed(),this.dataStoreContext.submitMessage(e,t,s)}reSubmit(e,t,s){switch(this.verifyNotClosed(),e){case n.ChannelOp:{const e=t,n=this.contexts.get(e.address);Object(c.a)(!!n,387),n.reSubmit(e.contents,s);break}case n.Attach:this.submit(e,t,s);break;default:Object(h.a)(e)}}rollback(e,t,s){switch(this.verifyNotClosed(),e){case n.ChannelOp:{const e=t,n=this.contexts.get(e.address);Object(c.a)(!!n,749),n.rollback(e.contents,s);break}default:throw new d.a(`Can't rollback ${e} message`)}}async applyStashedOp(e){const t=e,s=this.contexts.get(t.address);return Object(c.a)(!!s,388),await s.getChannel(),s.applyStashedOp(t.contents)}setChannelDirty(e){this.verifyNotClosed(),this.dataStoreContext.setChannelDirty(e)}processChannelOp(e,t,s){this.verifyNotClosed();const n=e.contents,r=Object.assign(Object.assign({},e),{contents:n.contents}),i=this.contexts.get(n.address);return Object(c.a)(!!i,389),i.processOp(r,t,s),i}attachListener(){this.setMaxListeners(Number.MAX_SAFE_INTEGER),this.dataStoreContext.once("attaching",()=>{this.attachGraph(),this._attachState=r.a.Attaching,Object(c.a)(this.visibilityState===m.VisibilityState.LocallyVisible,721),this.visibilityState=m.VisibilityState.GloballyVisible,this.localChannelContextQueue.forEach(e=>{e.makeVisible()}),this.localChannelContextQueue.clear(),this.deferredAttached.resolve(),this.emit("attaching")}),this.dataStoreContext.once("attached",()=>{Object(c.a)(this.visibilityState===m.VisibilityState.GloballyVisible,722),this._attachState=r.a.Attached,this.emit("attached")})}verifyNotClosed(){if(this._disposed)throw new d.a("Runtime is closed")}}const k=(e,t=M)=>class extends t{async request(t){const s=await super.request(t);return 404===s.status?e(t,this):s}}},18212:function(e,t,s){"use strict";s.d(t,"b",(function(){return u})),s.d(t,"c",(function(){return l})),s.d(t,"a",(function(){return d}));var n=s(16645),r=s.n(n),i=s(17982),o=s(17957),a=s(17940),c=s(17953),h=s(18213);class u{constructor(e,t,s,n){this.id=e,this.registry=t,this.runtime=s,this.servicesGetter=n,this.globallyVisible=!1,this.pending=[],Object(a.a)(!this.id.includes("/"),783)}async getChannel(){return Object(a.a)(void 0!==this.channel,519),this.channel}get isLoaded(){return void 0!==this.channel}setConnectionState(e,t){this.globallyVisible&&this.isLoaded&&this.servicesGetter().value.deltaConnection.setConnectionState(e)}processOp(e,t,s){Object(a.a)(this.globallyVisible,723),this.isLoaded?this.servicesGetter().value.deltaConnection.process(e,t,s):(Object(a.a)(!1===t,393),this.pending.push(e))}reSubmit(e,t){Object(a.a)(this.isLoaded,394),Object(a.a)(this.globallyVisible,724),this.servicesGetter().value.deltaConnection.reSubmit(e,t)}rollback(e,t){Object(a.a)(this.isLoaded,750),Object(a.a)(this.globallyVisible,751),this.servicesGetter().value.deltaConnection.rollback(e,t)}applyStashedOp(){throw new Error("no stashed ops on local channel")}async summarize(e=!1,t=!1,s){return Object(a.a)(this.isLoaded&&void 0!==this.channel,396),Object(h.d)(this.channel,e,t,s)}getAttachSummary(e){return Object(a.a)(this.isLoaded&&void 0!==this.channel,397),Object(h.c)(this.channel,!0,!1,e)}makeVisible(){if(this.globallyVisible)throw new Error("Channel is already globally visible");this.isLoaded&&(Object(a.a)(!!this.channel,402),this.channel.connect(this.servicesGetter().value)),this.globallyVisible=!0}async getGCData(e=!1){return Object(a.a)(this.isLoaded&&void 0!==this.channel,403),this.channel.getGCData(e)}updateUsedRoutes(e,t){}}class l extends u{constructor(e,t,s,n,i,o,a,u,l,d){super(e,t,s,()=>this.services),this.snapshotTree=d;const p=new Map,g=r()(this.snapshotTree);this.isSnapshotInOldFormatAndCollectBlobs(g,p)&&this.sanitizeSnapshot(g),this.services=new c.a(()=>Object(h.b)(this.id,n.connected,a,this.dirtyFn,l,i,o,g,p)),this.dirtyFn=()=>{u(e)}}async getChannel(){return void 0===this.channel&&(this.channel=await this.loadChannel().catch(e=>{throw o.c.wrapIfUnrecognized(e,"rehydratedLocalChannelContextFailedToLoadChannel",void 0)})),this.channel}async loadChannel(){Object(a.a)(!this.isLoaded,398),Object(a.a)(await this.services.value.objectStorage.contains(".attributes"),400);const e=await Object(i.a)(this.services.value.objectStorage,".attributes");if(Object(a.a)(void 0===this.factory,520),this.factory=this.registry.get(e.type),void 0===this.factory)throw new Error(`Channel Factory ${e.type} not registered`);const t=await this.factory.load(this.runtime,this.id,this.services.value,e);this.channel=t;for(const s of this.pending)this.services.value.deltaConnection.process(s,!1,void 0);return this.channel}isSnapshotInOldFormatAndCollectBlobs(e,t){let s=!1;const n=e.blobsContents;Object.entries(n).forEach(([n,r])=>{t.set(n,r),void 0!==e.blobs[n]&&(s=!0)});for(const r of Object.values(e.trees))s=s||this.isSnapshotInOldFormatAndCollectBlobs(r,t);return s}sanitizeSnapshot(e){const t=new Map(Object.entries(e.blobs));for(const[s,n]of t.entries()){void 0===t.get(n)&&delete e.blobs[s]}for(const s of Object.values(e.trees))this.sanitizeSnapshot(s)}}class d extends u{constructor(e,t,s,n,r,i,o,u,l,d){if(super(e,t,n,()=>this.services),Object(a.a)(void 0!==s,521),this.factory=t.get(s),void 0===this.factory)throw new Error(`Channel Factory ${s} not registered`);this.channel=this.factory.create(n,e),this.services=new c.a(()=>Object(h.b)(this.id,r.connected,u,this.dirtyFn,d,i,o)),this.dirtyFn=()=>{l(e)}}}},18213:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return c})),s.d(t,"d",(function(){return h}));var n=s(17991),r=s(18214),i=s(18215);const o=".attributes";function a(e,t,s,n,o,a,c,h,u){return{deltaConnection:new r.a(e,t,(e,t)=>s(e,t),n,o),objectStorage:new i.a(h,a,c,u)}}function c(e,t=!1,s=!1,r){const i=e.getAttachSummary(t,s,r);return Object(n.c)(i,o,JSON.stringify(e.attributes)),i}async function h(e,t=!1,s=!1,r){const i=await e.summarize(t,s,r);return Object(n.c)(i,o,JSON.stringify(e.attributes)),i}},18214:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(17940),r=s(17957);class i{constructor(e,t,s,n,r){this.objectId=e,this._connected=t,this.submit=s,this.dirty=n,this.addedGCOutboundReference=r}get handler(){return Object(n.a)(!!this._handler,375),this._handler}get connected(){return this._connected}attach(e){Object(n.a)(void 0===this._handler,376),this._handler=e}setConnectionState(e){this._connected=e,this.handler.setConnectionState(e)}process(e,t,s){try{this.handler.process(e,t,s)}catch(n){throw r.c.wrapIfUnrecognized(n,"channelDeltaConnectionFailedToProcessMessage",e)}}reSubmit(e,t){this.handler.reSubmit(e,t)}rollback(e,t){if(void 0===this.handler.rollback)throw new Error("Handler doesn't support rollback");this.handler.rollback(e,t)}applyStashedOp(e){return this.handler.applyStashedOp(e)}}},18215:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18216);class r{constructor(e,t,s,n){this.tree=e,this.storage=t,this.logger=s,this.extraBlobs=n,this.flattenedTree={},void 0!==e&&r.flattenTree("",e,this.flattenedTree)}static flattenTree(e,t,s){for(const n in t.trees)r.flattenTree(`${e}${n}/`,t.trees[n],s);for(const n in t.blobs)s[`${e}${n}`]=t.blobs[n]}async contains(e){return void 0!==this.flattenedTree[e]}async readBlob(e){const t=await this.getIdForPath(e),s=void 0!==this.extraBlobs?this.extraBlobs.get(t):void 0;if(void 0!==s)return s;const n=this.storage.readBlob(t);return n.catch(e=>this.logger.sendErrorEvent({eventName:"ChannelStorageBlobError"},e)),n}async list(e){var t;let s=this.tree;const r=Object(n.a)(e);for(;void 0!==s&&r.length>0;){const e=r.shift();s=s.trees[e]}if(void 0===s||0!==r.length)throw new Error("path does not exist");return Object.keys(null!==(t=null==s?void 0:s.blobs)&&void 0!==t?t:{})}async getIdForPath(e){return this.flattenedTree[e]}}},18216:function(e,t,s){"use strict";function n(e){let t=e;return t.startsWith("/")&&(t=t.substr(1)),t.endsWith("/")&&(t=t.substr(0,t.length-1)),t.length>0?t.split("/"):[]}s.d(t,"a",(function(){return n}))},18217:function(e,t,s){"use strict";s.d(t,"a",(function(){return h}));var n=s(17940),r=s(17957),i=s(17982),o=s(17944),a=s(17990),c=s(18213);class h{constructor(e,t,s,r,i,u,l,d,p,g,m,f,b){this.runtime=e,this.dataStoreContext=t,this.id=l,this.registry=p,this.attachMessageType=b,this.isLoaded=!1,this.pending=[],Object(n.a)(!this.id.includes("/"),784),this.subLogger=o.a.create(this.runtime.logger,"RemoteChannelContext"),this.services=Object(c.b)(this.id,this.dataStoreContext.connected,r,()=>i(this.id),u,s,this.subLogger,d,g);this.summarizerNode=m(async(e,t,s)=>this.summarizeInternal(e,t,s),async e=>this.getGCDataInternal(e),async()=>f()),this.thresholdOpsCounter=new a.a(h.pendingOpsCountThreshold,this.subLogger)}getChannel(){return void 0===this.channelP&&(this.channelP=this.loadChannel()),this.channelP}setConnectionState(e,t){this.isLoaded&&this.services.deltaConnection.setConnectionState(e)}applyStashedOp(e){return Object(n.a)(this.isLoaded,404),this.services.deltaConnection.applyStashedOp(e)}processOp(e,t,s){this.summarizerNode.invalidate(e.sequenceNumber),this.isLoaded?this.services.deltaConnection.process(e,t,s):(Object(n.a)(!t,405),Object(n.a)(void 0!==this.pending,574),this.pending.push(e),this.thresholdOpsCounter.sendIfMultiple("StorePendingOps",this.pending.length))}reSubmit(e,t){Object(n.a)(this.isLoaded,406),this.services.deltaConnection.reSubmit(e,t)}rollback(e,t){Object(n.a)(this.isLoaded,752),this.services.deltaConnection.rollback(e,t)}async summarize(e=!1,t=!0,s){return this.summarizerNode.summarize(e,t,s)}async summarizeInternal(e,t,s){const n=await this.getChannel(),r=await Object(c.d)(n,e,t,s);return Object.assign(Object.assign({},r),{id:this.id})}async loadChannel(){let e,t;if(Object(n.a)(!this.isLoaded,407),await this.services.objectStorage.contains(c.a)&&(e=await Object(i.a)(this.services.objectStorage,c.a)),void 0===e){if(void 0===this.attachMessageType)throw new r.b("channelTypeNotAvailable",{channelId:{value:this.id,tag:o.e.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:o.e.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/")});if(t=this.registry.get(this.attachMessageType),void 0===t)throw new r.b("channelFactoryNotRegisteredForAttachMessageType",{channelId:{value:this.id,tag:o.e.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:o.e.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:this.attachMessageType});e=t.attributes}else if(t=this.registry.get(e.type),void 0===t)throw new r.b("channelFactoryNotRegisteredForGivenType",{channelId:{value:this.id,tag:o.e.PackageData},dataStoreId:{value:this.dataStoreContext.id,tag:o.e.PackageData},dataStorePackagePath:this.dataStoreContext.packagePath.join("/"),channelFactoryType:e.type});void 0!==e.snapshotFormatVersion&&e.snapshotFormatVersion!==t.attributes.snapshotFormatVersion&&this.subLogger.sendTelemetryEvent({eventName:"ChannelAttributesVersionMismatch",channelType:{value:e.type,tag:o.e.PackageData},channelSnapshotVersion:{value:`${e.snapshotFormatVersion}@${e.packageVersion}`,tag:o.e.PackageData},channelCodeVersion:{value:`${t.attributes.snapshotFormatVersion}@${t.attributes.packageVersion}`,tag:o.e.PackageData}});const s=await t.load(this.runtime,this.id,this.services,e);Object(n.a)(void 0!==this.pending,575);for(const n of this.pending)this.services.deltaConnection.process(n,!1,void 0);return this.thresholdOpsCounter.send("ProcessPendingOps",this.pending.length),this.channel=s,this.pending=void 0,this.isLoaded=!0,this.services.deltaConnection.setConnectionState(this.dataStoreContext.connected),this.channel}async getGCData(e=!1){return this.summarizerNode.getGCData(e)}async getGCDataInternal(e=!1){return(await this.getChannel()).getGCData(e)}updateUsedRoutes(e,t){this.summarizerNode.updateUsedRoutes([""])}}h.pendingOpsCountThreshold=1e3},18218:function(e,t,s){"use strict";s.d(t,"b",(function(){return m})),s.d(t,"a",(function(){return b}));var n=s(17946),r=s(18013),i=s(17952),o=s(18245),a=s(17944),c=s(18078),h=s(18246),u=s(18247),l=s(18219),d=s(18223),p=s(18236);function g(e){return void 0===e.headers||!1!==e.headers[r.a.cache]}class m{constructor(e,t){this.container=e,this.loader=t}get IFluidRouter(){return this}async resolve(e){var t,s,n,i,o;if(e.url.startsWith("/")){if(g(e))return this.container;{const a=this.container.resolvedUrl;Object(c.a)(a);return await l.a.load(this.loader,{canReconnect:null===(t=e.headers)||void 0===t?void 0:t[r.a.reconnect],clientDetailsOverride:null===(s=e.headers)||void 0===s?void 0:s[r.a.clientDetails],resolvedUrl:Object.assign({},a),version:null!==(i=null===(n=e.headers)||void 0===n?void 0:n[r.a.version])&&void 0!==i?i:void 0,loadMode:null===(o=e.headers)||void 0===o?void 0:o[r.a.loadMode]})}}if(void 0===this.loader)throw new Error("Cannot resolve external containers");return this.loader.resolve(e)}async request(e){if(e.url.startsWith("/")){return(await this.resolve(e)).request(e)}return void 0===this.loader?{status:404,value:"Cannot request external containers",mimeType:"plain/text"}:this.loader.request(e)}}function f(e){const t=Object.create(e),s=new Map;return t.resolve=async t=>g(t)?(s.has(t.url)||s.set(t.url,e.resolve(t)),s.get(t.url)):e.resolve(t),t}class b{constructor(e){var t,s;this.containers=new Map;const r=Object.assign({},e.scope);!1!==(null===(t=e.options)||void 0===t?void 0:t.provideScopeLoader)&&(r.ILoader=this);const c={loaderId:Object(n.a)(),loaderVersion:p.a},l=Object(i.d)(o.a.mixinDebugLogger("fluid:telemetry",e.logger,{all:c}),i.e.value,e.configProvider);this.services={urlResolver:f(h.a.create(e.urlResolver)),documentServiceFactory:u.a.create(e.documentServiceFactory),codeLoader:e.codeLoader,options:null!==(s=e.options)&&void 0!==s?s:{},scope:r,subLogger:l.logger,detachedBlobStorage:e.detachedBlobStorage},this.mc=Object(i.c)(a.a.create(this.services.subLogger,"Loader"))}get IFluidRouter(){return this}async createDetachedContainer(e){const t=await l.a.createDetached(this,e);return this.cachingEnabled&&t.once("attached",()=>{Object(c.a)(t.resolvedUrl);const e=Object(d.c)(t.resolvedUrl.url);void 0!==e&&this.addToContainerCache(e.id,Promise.resolve(t))}),t}async rehydrateDetachedContainerFromSnapshot(e){return l.a.rehydrateDetachedFromSnapshot(this,e)}async resolve(e,t){const s=void 0===t?"Resolve":"ResolveWithPendingState";return a.c.timedExecAsync(this.mc.logger,{eventName:s},async()=>(await this.resolveCore(e,void 0!==t?JSON.parse(t):void 0)).container)}async request(e){return a.c.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>{const t=await this.resolveCore(e);return t.container.request(Object.assign(Object.assign({},e),{url:`${t.parsed.path}${t.parsed.query}`}))})}getKeyForContainerCache(e,t){var s;return void 0!==(null===(s=e.headers)||void 0===s?void 0:s[r.a.version])?`${t.id}@${e.headers[r.a.version]}`:t.id}addToContainerCache(e,t){this.containers.set(e,t),t.then(t=>{t.closed?this.containers.delete(e):t.once("closed",()=>{this.containers.delete(e)})}).catch(e=>{})}async resolveCore(e,t){const s=await this.services.urlResolver.resolve(e);Object(c.a)(s);const n=Object(d.c)(s.url);if(void 0===n)throw new Error("Invalid URL "+s.url);if(void 0!==t){const e=Object(d.c)(t.url);if((null==e?void 0:e.id)!==n.id||(null==e?void 0:e.path.replace(/\/$/,""))!==n.path.replace(/\/$/,"")){const e=`URL ${s.url} does not match pending state URL ${t.url}`;throw new Error(e)}}const{canCache:r,fromSequenceNumber:i}=this.parseHeader(n,e);let o;if(void 0===t&&r){const t=this.getKeyForContainerCache(e,n),r=await this.containers.get(t);if(void 0!==r)o=r;else{const n=this.loadContainer(e,s);this.addToContainerCache(t,n),o=await n}}else o=await this.loadContainer(e,s,t);return o.deltaManager.lastSequenceNumber<=i&&await new Promise((e,t)=>{o.on("op",(function t(s){s.sequenceNumber>i&&(e(),o.removeListener("op",t))}))}),{container:o,parsed:n}}get cachingEnabled(){return!1!==this.services.options.cache}canCacheForRequest(e){return this.cachingEnabled&&!1!==e[r.a.cache]}parseHeader(e,t){var s,n;let i=-1;t.headers=null!==(s=t.headers)&&void 0!==s?s:{};const o=t.headers[r.a.sequenceNumber];void 0!==o&&(i=o),t.headers[r.a.version]=null!==(n=e.version)&&void 0!==n?n:t.headers[r.a.version];return{canCache:this.canCacheForRequest(t.headers),fromSequenceNumber:i}}async loadContainer(e,t,s){var n,i,o,a,c;return l.a.load(this,{canReconnect:null===(n=e.headers)||void 0===n?void 0:n[r.a.reconnect],clientDetailsOverride:null===(i=e.headers)||void 0===i?void 0:i[r.a.clientDetails],resolvedUrl:t,version:null!==(a=null===(o=e.headers)||void 0===o?void 0:o[r.a.version])&&void 0!==a?a:void 0,loadMode:null===(c=e.headers)||void 0===c?void 0:c[r.a.loadMode]},s)}}},18219:function(e,t,s){"use strict";s.d(t,"a",(function(){return z}));var n=s(11443),r=s.n(n),i=s(17946),o=s(17940),a=s(17955),c=s(17989),h=s(17959),u=s(18229),l=s(17957),d=s(18080),p=s(18078),g=s(18173),m=s(17982),f=s(18010),b=s(17971),v=s(18234),y=s(17981),S=s(17970),w=s(17945),C=s(18026),O=s(17944),j=s(17938),M=s(17952),k=s(18220),N=s(18243),E=s(18228),D=s(18237),I=s(18244),T=s(18218),_=s(18236),q=s(18221),x=s(18232),R=s(18233),P=s(18222),A=s(18223),L=s(18230),F=s(18242),B=s(18241),U=s(18072);async function H(e,t,s){const n=O.c.start(e,{eventName:t}),r=await s();n.duration>1e3&&n.end(r)}class z extends j.a{constructor(e,t){var s,n;super((e,t)=>{this.mc.logger.sendErrorEvent({eventName:"ContainerEventHandlerException",name:"string"==typeof e?e:void 0},t)}),this.loader=e,this._canReconnect=!0,this._lifecycleState="loading",this._attachState=h.a.Detached,this.inboundQueuePausedFromInit=!0,this.firstConnection=!0,this.connectionTransitionTimes=[],this.messageCountAfterDisconnection=0,this.attachStarted=!1,this._dirtyContainer=!1,this.setAutoReconnectTime=a.a.now(),this._audience=new k.a,this.clientDetailsOverride=t.clientDetailsOverride,this._resolvedUrl=t.resolvedUrl,void 0!==t.canReconnect&&(this._canReconnect=t.canReconnect);const r=this.client.details.type,o=`${this.client.details.capabilities.interactive?"interactive":"noninteractive"}${void 0!==r&&""!==r?"/"+r:""}`;this.subLogger=O.a.create(e.services.subLogger,void 0,{all:{clientType:o,containerId:Object(i.a)(),docId:()=>{var e,t;return null!==(t=null===(e=this._resolvedUrl)||void 0===e?void 0:e.id)&&void 0!==t?t:void 0},containerAttachState:()=>this._attachState,containerLifecycleState:()=>this._lifecycleState,containerConnectionState:()=>U.a[this.connectionState],serializedContainer:void 0!==t.serializedContainerState},error:{dmInitialSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.initialSequenceNumber},dmLastProcessedSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.lastSequenceNumber},dmLastKnownSeqNumber:()=>{var e;return null===(e=this._deltaManager)||void 0===e?void 0:e.lastKnownSeqNumber},containerLoadedFromVersionId:()=>{var e;return null===(e=this.loadedFromVersion)||void 0===e?void 0:e.id},containerLoadedFromVersionDate:()=>{var e;return null===(e=this.loadedFromVersion)||void 0===e?void 0:e.date},dmLastMsqSeqNumber:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.sequenceNumber},dmLastMsqSeqTimestamp:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.timestamp},dmLastMsqSeqClientId:()=>{var e,t;return null===(t=null===(e=this.deltaManager)||void 0===e?void 0:e.lastMessage)||void 0===t?void 0:t.clientId},connectionStateDuration:()=>a.a.now()-this.connectionTransitionTimes[this.connectionState]}}),this.mc=Object(M.c)(O.a.create(this.subLogger,"Container"));const c=null!==(s=this.mc.config.getBoolean("Fluid.Container.summarizeProtocolTree"))&&void 0!==s?s:this.loader.services.options.summarizeProtocolTree;this.options=Object.assign(Object.assign({},this.loader.services.options),{summarizeProtocolTree:c}),this.connectionStateHandler=new q.a({quorumClients:()=>{var e;return null===(e=this._protocolHandler)||void 0===e?void 0:e.quorum},logConnectionStateChangeTelemetry:(e,t,s)=>this.logConnectionStateChangeTelemetry(e,t,s),shouldClientJoinWrite:()=>this._deltaManager.connectionManager.shouldJoinWrite(),maxClientLeaveWaitTime:this.loader.services.options.maxClientLeaveWaitTime,logConnectionIssue:(e,t)=>{this._deltaManager.logConnectionIssue(Object.assign({eventName:e,duration:a.a.now()-this.connectionTransitionTimes[U.a.CatchingUp]},void 0===t?{}:{details:JSON.stringify(t)}))},connectionStateChanged:()=>{"loaded"===this._lifecycleState&&this.propagateConnectionState()}},this.mc.logger,null===(n=t.serializedContainerState)||void 0===n?void 0:n.clientId),this.on("saved",()=>{this.connectionStateHandler.containerSaved()}),this._deltaManager=this.createDeltaManager(),this._storage=new P.b(()=>{if(this.attachState!==h.a.Attached){if(void 0!==this.loader.services.detachedBlobStorage)return new P.a(this.loader.services.detachedBlobStorage,this.mc.logger);throw this.mc.logger.sendErrorEvent({eventName:"NoRealStorageInDetachedContainer"}),new Error("Real storage calls not allowed in Unattached container")}return this.storageService});"object"==typeof document&&null!==document&&"function"==typeof document.addEventListener&&null!==document.addEventListener&&(this.lastVisible=document.hidden?a.a.now():void 0,this.visibilityEventHandler=()=>{document.hidden?this.lastVisible=a.a.now():setTimeout(()=>{this.lastVisible=void 0},0)},document.addEventListener("visibilitychange",this.visibilityEventHandler)),this.on("newListener",(e,t)=>{Promise.resolve().then(()=>{switch(e){case"dirty":this._dirtyContainer&&t();break;case"saved":this._dirtyContainer||t();break;case C.a:this.connected&&t(this.clientId);break;case C.b:this.connected||t()}}).catch(e=>{this.mc.logger.sendErrorEvent({eventName:"RaiseConnectedEventError"},e)})})}static async load(e,t,s){const n=new z(e,{clientDetailsOverride:t.clientDetailsOverride,resolvedUrl:t.resolvedUrl,canReconnect:t.canReconnect,serializedContainerState:s});return O.c.timedExecAsync(n.mc.logger,{eventName:"Load"},async e=>new Promise((r,i)=>{var o,a;const c=t.version,h={opsBeforeReturn:"cached"},u=s?Object.assign(Object.assign({},null!==(o=t.loadMode)&&void 0!==o?o:h),{opsBeforeReturn:void 0}):null!==(a=t.loadMode)&&void 0!==a?a:h,d=e=>{i(null!=e?e:new l.d("Container closed without error during load"))};n.on("closed",d),n.load(c,u,s).finally(()=>{n.removeListener("closed",d)}).then(s=>{e.end(Object.assign(Object.assign({},s),t.loadMode)),r(n)},e=>{const t=Object(w.h)(e);n.close(t),d(t)})}),{start:!0,end:!0,cancel:"generic"})}static async createDetached(e,t){const s=new z(e,{});return O.c.timedExecAsync(s.mc.logger,{eventName:"CreateDetached"},async e=>(await s.createDetached(t),s),{start:!0,end:!0,cancel:"generic"})}static async rehydrateDetachedFromSnapshot(e,t){const s=new z(e,{});return O.c.timedExecAsync(s.mc.logger,{eventName:"RehydrateDetachedFromSnapshot"},async e=>{const n=JSON.parse(t);return await s.rehydrateDetachedFromSnapshot(n),s},{start:!0,end:!0,cancel:"generic"})}setLoaded(){"loading"===this._lifecycleState&&(this.propagateConnectionState(),this._lifecycleState="loaded")}get closed(){return"closing"===this._lifecycleState||"closed"===this._lifecycleState}get storage(){return this._storage}get storageService(){if(void 0===this._storageService)throw new Error("Attempted to access storageService before it was defined");return this._storageService}get context(){if(void 0===this._context)throw new l.d("Attempted to access context before it was defined");return this._context}get protocolHandler(){if(void 0===this._protocolHandler)throw new Error("Attempted to access protocolHandler before it was defined");return this._protocolHandler}get connectionMode(){return this._deltaManager.connectionManager.connectionMode}get IFluidRouter(){return this}get resolvedUrl(){return this._resolvedUrl}get loadedFromVersion(){return this._loadedFromVersion}get readOnlyInfo(){return this._deltaManager.readOnlyInfo}get closeSignal(){return this._deltaManager.closeAbortController.signal}forceReadonly(e){this._deltaManager.connectionManager.forceReadonly(e)}get deltaManager(){return this._deltaManager}get connectionState(){return this.connectionStateHandler.connectionState}get connected(){return this.connectionStateHandler.connected}get serviceConfiguration(){return this._deltaManager.serviceConfiguration}get clientId(){return this.connectionStateHandler.clientId}get scopes(){return this._deltaManager.connectionManager.scopes}get clientDetails(){return this._deltaManager.clientDetails}getSpecifiedCodeDetails(){return this.getCodeDetailsFromQuorum()}getLoadedCodeDetails(){var e;return null===(e=this._context)||void 0===e?void 0:e.codeDetails}get audience(){return this._audience}get isDirty(){return this._dirtyContainer}get serviceFactory(){return this.loader.services.documentServiceFactory}get urlResolver(){return this.loader.services.urlResolver}get scope(){return this.loader.services.scope}get codeLoader(){return this.loader.services.codeLoader}getQuorum(){return this.protocolHandler.quorum}close(e){this._deltaManager.close(e),Object(o.a)(this.connectionState===U.a.Disconnected,207),Object(o.a)("closed"===this._lifecycleState,788)}closeCore(e){var t,s,n,r;Object(o.a)(!this.closed,789);try{try{this.mc.logger.sendTelemetryEvent({eventName:"ContainerClose",category:void 0===e?"generic":"error"},e),this._lifecycleState="closing",null===(t=this._protocolHandler)||void 0===t||t.close(),this.connectionStateHandler.dispose(),null===(s=this._context)||void 0===s||s.dispose(void 0!==e?new Error(e.message):void 0),null===(n=this._storageService)||void 0===n||n.dispose(),null===(r=this.service)||void 0===r||r.dispose(e)}catch(i){this.mc.logger.sendErrorEvent({eventName:"ContainerCloseException"},i)}this.emit("closed",e),this.removeAllListeners(),void 0!==this.visibilityEventHandler&&document.removeEventListener("visibilitychange",this.visibilityEventHandler)}finally{this._lifecycleState="closed"}}closeAndGetPendingLocalState(){Object(o.a)(this.attachState===h.a.Attached,209),Object(o.a)(void 0!==this.resolvedUrl&&"fluid"===this.resolvedUrl.type,210),Object(o.a)(!!this._protocolHandler,739),Object(o.a)(void 0!==this._protocolHandler.attributes.term,779);const e={pendingRuntimeState:this.context.getPendingLocalState(),url:this.resolvedUrl.url,protocol:this.protocolHandler.getProtocolState(),term:this._protocolHandler.attributes.term,clientId:this.clientId};return this.close(),JSON.stringify(e)}get attachState(){return this._attachState}serialize(){Object(o.a)(this.attachState===h.a.Detached,211);const e=this.context.createSummary(),t=this.captureProtocolSummary(),s=Object(d.a)(e,t);return this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0&&(s.tree[".hasAttachmentBlobs"]={type:y.a.Blob,content:"true"}),JSON.stringify(s)}async attach(e){await O.c.timedExecAsync(this.mc.logger,{eventName:"Attach"},async()=>{if("loaded"!==this._lifecycleState)throw new l.f(`The Container is not in a valid state for attach [${this._lifecycleState}]`);Object(o.a)(this._attachState===h.a.Detached&&!this.attachStarted,517),this.attachStarted=!0;const t=void 0!==this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0;try{let s;if(Object(o.a)(0===this.deltaManager.inbound.length,214),!t){const e=this.context.createSummary(),t=this.captureProtocolSummary();s=Object(d.a)(e,t),this._attachState=h.a.Attaching,this.context.notifyAttaching(Object(A.b)(s))}const n=await this.urlResolver.resolve(e);Object(p.a)(n),void 0===this.service&&(Object(o.a)("summarizer"!==this.client.details.type,708),this.service=await Object(g.a)(async()=>this.serviceFactory.createContainer(s,n,this.subLogger,!1),"containerAttach",this.mc.logger,{cancel:this.closeSignal}));const r=this.service.resolvedUrl;if(Object(p.a)(r),this._resolvedUrl=r,await this.connectStorageService(),t){Object(o.a)(!!this.loader.services.detachedBlobStorage,590);const e=new Map;for(;e.size<this.loader.services.detachedBlobStorage.size;){const t=this.loader.services.detachedBlobStorage.getBlobIds().filter(t=>!e.has(t));for(const s of t){const t=await this.loader.services.detachedBlobStorage.readBlob(s),n=await this.storageService.createBlob(t);e.set(s,n.id)}}const t=this.context.createSummary(e),n=this.captureProtocolSummary();s=Object(d.a)(t,n),this._attachState=h.a.Attaching,this.context.notifyAttaching(Object(A.b)(s)),await this.storageService.uploadSummaryWithContext(s,{referenceSequenceNumber:0,ackHandle:void 0,proposalHandle:void 0})}this._attachState=h.a.Attached,this.emit("attached"),this.propagateConnectionState(),this.closed||this.resumeInternal({fetchOpsFromStorage:!1,reason:"createDetached"})}catch(s){const e=Object(w.h)(s),t=this.resolvedUrl;throw Object(p.b)(t)&&e.addTelemetryProperties({resolvedUrl:t.url}),this.close(e),e}},{start:!0,end:!0,cancel:"generic"})}async request(e){return O.c.timedExecAsync(this.mc.logger,{eventName:"Request"},async()=>this.context.request(e),{end:!0,cancel:"error"})}setAutoReconnectInternal(e){if(this._deltaManager.connectionManager.reconnectMode===e)return;const t=a.a.now(),s=t-this.setAutoReconnectTime;this.setAutoReconnectTime=t,this.mc.logger.sendTelemetryEvent({eventName:e===E.a.Enabled?"AutoReconnectEnabled":"AutoReconnectDisabled",connectionMode:this.connectionMode,connectionState:U.a[this.connectionState],duration:s}),this._deltaManager.connectionManager.setAutoReconnect(e)}connect(){if(this.closed)throw new l.f("The Container is closed and cannot be connected");if(this._attachState!==h.a.Attached)throw new l.f("The Container is not attached and cannot be connected");this.connected||this.connectInternal({reason:"DocumentConnect",fetchOpsFromStorage:!1})}connectInternal(e){Object(o.a)(!this.closed,709),Object(o.a)(this._attachState===h.a.Attached,710),this.resumeInternal(e);const t=E.a.Enabled;this.setAutoReconnectInternal(t)}disconnect(){if(this.closed)throw new l.f("The Container is closed and cannot be disconnected");this.disconnectInternal()}disconnectInternal(){Object(o.a)(!this.closed,711);const e=E.a.Disabled;this.setAutoReconnectInternal(e)}resumeInternal(e){Object(o.a)(!this.closed,217),this.inboundQueuePausedFromInit&&(this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume()),this.connectToDeltaStream(e)}async getAbsoluteUrl(e){var t;if(void 0!==this.resolvedUrl)return this.urlResolver.getAbsoluteUrl(this.resolvedUrl,e,Object(E.b)(null===(t=this._context)||void 0===t?void 0:t.codeDetails))}async proposeCodeDetails(e){if(!Object(u.a)(e))throw new Error("Provided codeDetails are not IFluidCodeDetails");if(this.codeLoader.IFluidCodeDetailsComparer){const t=await this.codeLoader.IFluidCodeDetailsComparer.compare(e,this.getCodeDetailsFromQuorum());if(void 0!==t&&t<=0)throw new Error("Proposed code details should be greater than the current")}return this.protocolHandler.quorum.propose("code",e).then(()=>!0).catch(()=>!1)}async processCodeProposal(){const e=this.getCodeDetailsFromQuorum();if(await Promise.all([this.deltaManager.inbound.pause(),this.deltaManager.inboundSignal.pause()]),!0===await this.context.satisfies(e))return this.deltaManager.inbound.resume(),void this.deltaManager.inboundSignal.resume();this.close(new l.d("Existing context does not satisfy incoming proposal"))}async getVersion(e){return(await this.storageService.getVersions(e,1))[0]}recordConnectStartTime(){void 0===this.connectionTransitionTimes[U.a.Disconnected]&&(this.connectionTransitionTimes[U.a.Disconnected]=a.a.now())}connectToDeltaStream(e){this.recordConnectStartTime(),this._canReconnect&&this.client.details.capabilities.interactive||(e.mode="write"),this._deltaManager.connect(e)}async load(e,t,s){if(void 0===this._resolvedUrl)throw new Error("Attempting to load without a resolved url");this.service=await this.serviceFactory.createDocumentService(this._resolvedUrl,this.subLogger,"summarizer"===this.client.details.type);const n={reason:"DocumentOpen",mode:"write",fetchOpsFromStorage:!1};void 0===t.deltaConnection&&this.connectToDeltaStream(n),s?this.connectStorageService().catch(e=>this.close(e)):await this.connectStorageService(),this._attachState=h.a.Attached;const{snapshot:r,versionId:i}=void 0===s?await this.fetchSnapshotTree(e):{snapshot:void 0,versionId:void 0};Object(o.a)(void 0!==r||void 0!==s,567);const a=void 0===s?await this.getDocumentAttributes(this.storageService,r):{sequenceNumber:s.protocol.sequenceNumber,minimumSequenceNumber:s.protocol.minimumSequenceNumber,term:s.term};let u;switch(t.opsBeforeReturn){case void 0:this.attachDeltaManagerOpHandler(a,"none"!==t.deltaConnection?"all":"none");break;case"cached":u=this.attachDeltaManagerOpHandler(a,"cached");break;case"all":u=this.attachDeltaManagerOpHandler(a,"all");break;default:Object(c.a)(t.opsBeforeReturn)}this._protocolHandler=void 0===s?await this.initializeProtocolStateFromSnapshot(a,this.storageService,r):await this.initializeProtocolState(a,s.protocol.members,s.protocol.proposals,s.protocol.values);const l=this.getCodeDetailsFromQuorum();if(await this.instantiateContext(!0,l,r,null==s?void 0:s.pendingRuntimeState),!this.closed)switch(void 0!==u&&(this._deltaManager.inbound.resume(),await H(this.mc.logger,"WaitOps",async()=>(await u,{})),await H(this.mc.logger,"WaitOpProcessing",async()=>this._deltaManager.inbound.waitTillProcessingDone()),this._deltaManager.inbound.pause()),t.deltaConnection){case void 0:case"delayed":Object(o.a)(this.inboundQueuePausedFromInit,838),this.inboundQueuePausedFromInit=!1,this._deltaManager.inbound.resume(),this._deltaManager.inboundSignal.resume();break;case"none":break;default:Object(c.a)(t.deltaConnection)}if(this.closed)throw new Error("Container was closed while load()");return this.setLoaded(),{sequenceNumber:a.sequenceNumber,version:i,dmLastProcessedSeqNumber:this._deltaManager.lastSequenceNumber,dmLastKnownSeqNumber:this._deltaManager.lastKnownSeqNumber}}async createDetached(e){const t={sequenceNumber:0,term:1,minimumSequenceNumber:0};await this.attachDeltaManagerOpHandler(t);const s=Object(L.c)(e);this._protocolHandler=await this.initializeProtocolState(t,[],[],s),await this.instantiateContextDetached(!1),this.setLoaded()}async rehydrateDetachedFromSnapshot(e){void 0!==e.tree[".hasAttachmentBlobs"]&&(Object(o.a)(!!this.loader.services.detachedBlobStorage&&this.loader.services.detachedBlobStorage.size>0,592),delete e.tree[".hasAttachmentBlobs"]);const t=Object(A.b)(e);this._storage.loadSnapshotForRehydratingContainer(t);const s=await this.getDocumentAttributes(this._storage,t);await this.attachDeltaManagerOpHandler(s);const n=Object(A.a)(t),r=await Object(m.a)(this._storage,n.blobs.quorumValues),i=Object(L.b)(r);this._protocolHandler=await this.initializeProtocolState(s,[],[],void 0!==i?Object(L.c)(i):[]),await this.instantiateContextDetached(!0,t),this.setLoaded()}async connectStorageService(){var e,t;if(void 0!==this._storageService)return;Object(o.a)(void 0!==this.service,495);const s=await this.service.connectToStorage();this._storageService=new x.a(s,this.mc.logger),!0===this.options.summarizeProtocolTree&&(this.mc.logger.sendTelemetryEvent({eventName:"summarizeProtocolTreeEnabled"}),this._storageService=new R.a(this._storageService,()=>this.captureProtocolSummary())),Object(o.a)((null===(e=s.policies)||void 0===e?void 0:e.minBlobSize)===(null===(t=this.storageService.policies)||void 0===t?void 0:t.minBlobSize),224)}async getDocumentAttributes(e,t){if(void 0===t)return{minimumSequenceNumber:0,sequenceNumber:0,term:1};const s=".protocol"in t.trees?t.trees[".protocol"].blobs.attributes:t.blobs[".attributes"],n=await Object(m.a)(e,s);return void 0===n.term&&(n.term=1),n}async initializeProtocolStateFromSnapshot(e,t,s){let n=[],r=[],i=[];if(void 0!==s){const e=Object(A.a)(s);[n,r,i]=await Promise.all([Object(m.a)(t,e.blobs.quorumMembers),Object(m.a)(t,e.blobs.quorumProposals),Object(m.a)(t,e.blobs.quorumValues)])}return await this.initializeProtocolState(e,n,r,i)}async initializeProtocolState(e,t,s,n){const r=new v.a(e.minimumSequenceNumber,e.sequenceNumber,e.term,t,s,n,(e,t)=>this.submitMessage(S.a.Propose,{key:e,value:t})),i=O.a.create(this.subLogger,"ProtocolHandler");return r.quorum.on("error",e=>{i.sendErrorEvent(e)}),this.connectionStateHandler.initProtocol(r),r.quorum.on("addProposal",e=>{"code"!==e.key&&"code2"!==e.key||this.emit("codeDetailsProposed",e.value,e)}),r.quorum.on("approveProposal",(e,t,s)=>{"code"!==t&&"code2"!==t||(Object(u.a)(s)||this.mc.logger.sendErrorEvent({eventName:"CodeProposalNotIFluidCodeDetails"}),this.processCodeProposal().catch(e=>{throw this.close(Object(w.h)(e)),e}))}),r}captureProtocolSummary(){const e=this.protocolHandler.snapshot();return{tree:{attributes:{content:JSON.stringify(this.protocolHandler.attributes),type:y.a.Blob},quorumMembers:{content:JSON.stringify(e.members),type:y.a.Blob},quorumProposals:{content:JSON.stringify(e.proposals),type:y.a.Blob},quorumValues:{content:JSON.stringify(e.values),type:y.a.Blob}},type:y.a.Tree}}getCodeDetailsFromQuorum(){return(e=>{var t;return null!==(t=e.get("code"))&&void 0!==t?t:e.get("code2")})(this.protocolHandler.quorum)}get client(){var e;const t=void 0!==(null===(e=this.options)||void 0===e?void 0:e.client)?this.options.client:{details:{capabilities:{interactive:!0}},mode:"read",permission:[],scopes:[],user:{id:""}};return void 0!==this.clientDetailsOverride&&r()(t.details,this.clientDetailsOverride),t.details.environment=[t.details.environment," loaderVersion:"+_.a].join(";"),t}activeConnection(){return this.connectionState===U.a.Connected&&"write"===this.connectionMode}createDeltaManager(){const e=()=>this.service,t=new D.a(e,O.a.create(this.subLogger,"DeltaManager"),()=>this.activeConnection(),t=>new B.a(e,this.client,this._canReconnect,O.a.create(this.subLogger,"ConnectionManager"),t));return t.inbound.pause(),t.inboundSignal.pause(),t.on("connect",(e,t)=>{var s;this._audience.clear();for(const n of null!==(s=e.initialClients)&&void 0!==s?s:[])this._audience.addMember(n.clientId,n.client);this.connectionStateHandler.receivedConnectEvent(this.connectionMode,e)}),t.on("disconnect",e=>{var t;null===(t=this.collabWindowTracker)||void 0===t||t.stopSequenceNumberUpdate(),this.connectionStateHandler.receivedDisconnectEvent(e)}),t.on("throttled",e=>{const t=e;!0!==t.logged&&this.logContainerError(t),this.emit("warning",t)}),t.on("readonly",e=>{this.emit("readonly",e)}),t.on("closed",e=>{this.closeCore(e)}),t}async attachDeltaManagerOpHandler(e,t){var s;return this._deltaManager.attachOpHandler(e.minimumSequenceNumber,e.sequenceNumber,null!==(s=e.term)&&void 0!==s?s:1,{process:e=>this.processRemoteMessage(e),processSignal:e=>{this.processSignal(e)}},t)}logConnectionStateChangeTelemetry(e,t,s){var n;const r=a.a.now();this.connectionTransitionTimes[e]=r;const i=r-this.connectionTransitionTimes[t];let o,c,h,u,l;e===U.a.Disconnected?h=this._deltaManager.connectionManager.reconnectMode:(e===U.a.Connected?(o=r-this.connectionTransitionTimes[U.a.Disconnected],o=O.f.formatTick(o)):(u=this.deltaManager.lastKnownSeqNumber,this.deltaManager.hasCheckpointSequenceNumber&&(l=u-this.deltaManager.lastSequenceNumber)),c=this.firstConnection?"InitialConnect":"AutoReconnect"),this.mc.logger.sendPerformanceEvent(Object.assign({eventName:"ConnectionStateChange_"+U.a[e],from:U.a[t],duration:i,durationFromDisconnected:o,reason:s,connectionInitiationReason:c,pendingClientId:this.connectionStateHandler.pendingClientId,clientId:this.clientId,autoReconnect:h,opsBehind:l,online:f.e[Object(f.k)()],lastVisible:void 0!==this.lastVisible?a.a.now()-this.lastVisible:void 0,checkpointSequenceNumber:u,quorumSize:null===(n=this._protocolHandler)||void 0===n?void 0:n.quorum.getMembers().size},this._deltaManager.connectionProps)),e===U.a.Connected&&(this.firstConnection=!1)}propagateConnectionState(){var e;const t=this.connectionState===U.a.Connected&&!this.firstConnection&&"write"===this.connectionMode;t&&(this.messageCountAfterDisconnection=0);const s=this.connectionState===U.a.Connected;!1===(null===(e=this._context)||void 0===e?void 0:e.disposed)&&this.context.setConnectionState(s,this.clientId),this.protocolHandler.setConnectionState(s,this.clientId),Object(C.c)(this.mc.logger,this,s,this.clientId),t&&this.mc.logger.sendTelemetryEvent({eventName:"OpsSentOnReconnect",count:this.messageCountAfterDisconnection})}submitContainerMessage(e,t,s,n){switch(e){case S.a.Operation:case S.a.RemoteHelp:break;case S.a.Summarize:{const e=t;void 0===e.details&&(e.details={}),e.details.includesProtocolTree=!0===this.options.summarizeProtocolTree;break}default:return this.close(new l.d("invalidContainerSubmitOpType",void 0,{messageType:e})),-1}return this.submitMessage(e,t,s,n)}submitMessage(e,t,s,n){var r;return this.connectionState!==U.a.Connected?(this.mc.logger.sendErrorEvent({eventName:"SubmitMessageWithNoConnection",type:e}),-1):(this.messageCountAfterDisconnection+=1,null===(r=this.collabWindowTracker)||void 0===r||r.stopSequenceNumberUpdate(),this._deltaManager.submit(e,t,s,n))}processRemoteMessage(e){const t=this.clientId===e.clientId;let s={immediateNoOp:!1};try{s=this.protocolHandler.processMessage(e,t)}catch(n){this.close(Object(w.i)(n,t=>new l.b(t,Object(l.g)(e))))}return Object(b.c)(e)&&!Object(b.b)(e)&&this.mc.logger.sendTelemetryEvent({eventName:"UnpackedRuntimeMessage",type:e.type}),(Object(b.b)(e)||Object(b.c)(e))&&this.context.process(e,t,void 0),this.activeConnection()&&(void 0===this.collabWindowTracker&&(Object(o.a)(void 0!==this.serviceConfiguration,740),this.collabWindowTracker=new F.a((e,t)=>{Object(o.a)(this.activeConnection(),577),this.submitMessage(e,t)},this.serviceConfiguration.noopTimeFrequency,this.serviceConfiguration.noopCountFrequency)),this.collabWindowTracker.scheduleSequenceNumberUpdate(e,!0===s.immediateNoOp)),this.emit("op",e),s}submitSignal(e){this._deltaManager.submitSignal(JSON.stringify(e))}processSignal(e){if(null===e.clientId){const t=e.content;if(t.type===S.a.ClientJoin){const e=t.content;this._audience.addMember(e.clientId,e.client)}else if(t.type===S.a.ClientLeave){const e=t.content;this._audience.removeMember(e)}}else{const t=this.clientId===e.clientId;this.context.processSignal(e,t)}}async fetchSnapshotTree(e){var t;const s=await this.getVersion(null!=e?e:null);void 0===s&&void 0!==e&&this.mc.logger.sendErrorEvent({eventName:"NoVersionFoundWhenSpecified",id:e}),this._loadedFromVersion=s;const n=null!==(t=await this.storageService.getSnapshotTree(s))&&void 0!==t?t:void 0;return void 0===n&&void 0!==s&&this.mc.logger.sendErrorEvent({eventName:"getSnapshotTreeFailed",id:s.id}),{snapshot:n,versionId:null==s?void 0:s.id}}async instantiateContextDetached(e,t){const s=this.getCodeDetailsFromQuorum();if(void 0===s)throw new Error("pkg should be provided in create flow!!");await this.instantiateContext(e,s,t)}async instantiateContext(e,t,s,n){var r;Object(o.a)(!1!==(null===(r=this._context)||void 0===r?void 0:r.disposed),221);const i=new T.b(this,this.loader);this._context=await N.a.createOrLoad(this,this.scope,this.codeLoader,t,s,new I.a(this._deltaManager),new L.a(this.protocolHandler.quorum),i,(e,t,s,n)=>this.submitContainerMessage(e,t,s,n),e=>this.submitSignal(e),e=>this.close(e),z.version,e=>this.updateDirtyContainerState(e),e,n),this.emit("contextChanged",t)}updateDirtyContainerState(e){this._dirtyContainer!==e&&(this._dirtyContainer=e,this.emit(e?"dirty":"saved"))}logContainerError(e){this.mc.logger.sendErrorEvent({eventName:"ContainerWarning"},e)}}z.version="^0.1.0"},18220:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(15576);class r extends n.EventEmitter{constructor(){super(...arguments),this.members=new Map}on(e,t){return super.on(e,t)}addMember(e,t){this.members.set(e,t),this.emit("addMember",e,t)}removeMember(e){const t=this.members.get(e);return void 0!==t&&(this.members.delete(e),this.emit("removeMember",e,t),!0)}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}clear(){const e=this.members.keys();for(const t of e)this.removeMember(t)}}},18221:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(17978),r=s(17940),i=s(17944),o=s(18072);class a{constructor(e,t,s){var i;this.handler=e,this.logger=t,this._clientId=s,this._connectionState=o.a.Disconnected,this.prevClientLeftTimer=new n.b(null!==(i=this.handler.maxClientLeaveWaitTime)&&void 0!==i?i:3e5,()=>{Object(r.a)(!this.connected,684),this.applyForConnectedState("timeout")}),this.joinOpTimer=new n.b(45e3,()=>{var e;if(this.connectionState!==o.a.CatchingUp)return;const t=this.handler.quorumClients(),s={quorumInitialized:void 0!==t,hasPendingClientId:void 0!==this.pendingClientId,inQuorum:void 0!==(null==t?void 0:t.getMember(null!==(e=this.pendingClientId)&&void 0!==e?e:"")),waitingForLeaveOp:this.waitingForLeaveOp};this.handler.logConnectionIssue("NoJoinOp",s)})}get connectionState(){return this._connectionState}get connected(){return this.connectionState===o.a.Connected}get clientId(){return this._clientId}get pendingClientId(){return this._pendingClientId}startJoinOpTimer(){Object(r.a)(!this.joinOpTimer.hasTimer,564),this.joinOpTimer.start()}stopJoinOpTimer(){Object(r.a)(this.joinOpTimer.hasTimer,565),this.joinOpTimer.clear()}get waitingForLeaveOp(){return this.prevClientLeftTimer.hasTimer}dispose(){Object(r.a)(!this.joinOpTimer.hasTimer,677),this.prevClientLeftTimer.clear()}containerSaved(){this.waitingForLeaveOp&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("containerSaved"))}receivedAddMemberEvent(e){e===this.pendingClientId&&(this.joinOpTimer.hasTimer?this.stopJoinOpTimer():this.handler.logConnectionIssue("ReceivedJoinOp"),this.waitingForLeaveOp&&(this.waitEvent=i.c.start(this.logger,{eventName:"WaitBeforeClientLeave",details:JSON.stringify({waitOnClientId:this._clientId,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.applyForConnectedState("addMemberEvent"))}applyForConnectedState(e){var t,s;const n=this.handler.quorumClients();Object(r.a)(void 0!==n,566),Object(r.a)(!1===this.waitingForLeaveOp||void 0!==this.clientId&&void 0!==n.getMember(this.clientId),738),this.pendingClientId===this.clientId||void 0===this.pendingClientId||void 0===n.getMember(this.pendingClientId)||this.waitingForLeaveOp?this.logger.sendTelemetryEvent({eventName:"connectedStateRejected",category:"timeout"===e?"error":"generic",details:JSON.stringify({source:e,pendingClientId:this.pendingClientId,clientId:this.clientId,waitingForLeaveOp:this.waitingForLeaveOp,inQuorum:void 0!==(null==n?void 0:n.getMember(null!==(s=this.pendingClientId)&&void 0!==s?s:""))})}):(null===(t=this.waitEvent)||void 0===t||t.end({source:e}),this.setConnectionState(o.a.Connected))}receivedRemoveMemberEvent(e){this.clientId===e&&(this.prevClientLeftTimer.clear(),this.applyForConnectedState("removeMemberEvent"))}receivedDisconnectEvent(e){this.joinOpTimer.hasTimer&&this.stopJoinOpTimer(),this.setConnectionState(o.a.Disconnected,e)}receivedConnectEvent(e,t){const s=this._connectionState;this._connectionState=o.a.CatchingUp;const n="write"===e;Object(r.a)(n||!this.handler.shouldClientJoinWrite(),778),Object(r.a)(n||!this.waitingForLeaveOp,678);const i=this.handler.quorumClients();this._pendingClientId=t.clientId,this.handler.logConnectionStateChangeTelemetry(o.a.CatchingUp,s);n&&void 0===(null==i?void 0:i.getMember(this._pendingClientId))?this.startJoinOpTimer():this.waitingForLeaveOp||this.setConnectionState(o.a.Connected)}setConnectionState(e,t){if(this.connectionState===e)return void this.logger.sendErrorEvent({eventName:"setConnectionStateSame",value:e});const s=this._connectionState;this._connectionState=e;const n=this.handler.quorumClients();let i;void 0!==this._clientId&&(i=null==n?void 0:n.getMember(this._clientId)),e===o.a.Connected?(Object(r.a)(s===o.a.CatchingUp,472),void 0!==i&&(i.shouldHaveLeft=!0),this._clientId=this.pendingClientId):e===o.a.Disconnected&&(this._pendingClientId=void 0,void 0!==i&&this.handler.shouldClientJoinWrite()&&!1===this.prevClientLeftTimer.hasTimer?this.prevClientLeftTimer.restart():this.logger.sendTelemetryEvent({eventName:"noWaitOnDisconnected",details:JSON.stringify({inQuorum:void 0!==i,waitingForLeaveOp:this.waitingForLeaveOp,hadOutstandingOps:this.handler.shouldClientJoinWrite()})})),this.handler.logConnectionStateChangeTelemetry(this._connectionState,s,t),this.handler.connectionStateChanged()}initProtocol(e){e.quorum.on("addMember",(e,t)=>{this.receivedAddMemberEvent(e)}),e.quorum.on("removeMember",e=>{this.receivedRemoveMemberEvent(e)}),void 0!==this.clientId&&void 0!==e.quorum.getMember(this.clientId)&&this.prevClientLeftTimer.restart()}}},18222:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return r}));class n{constructor(e){this.storageGetter=e,this.blobContents={}}loadSnapshotForRehydratingContainer(e){this.getBlobContents(e)}getBlobContents(e){for(const[t,s]of Object.entries(e.blobsContents))this.blobContents[t]=s;for(const[t,s]of Object.entries(e.trees))this.getBlobContents(s)}get policies(){try{return this.storageGetter().policies}catch(e){}}get repositoryUrl(){return this.storageGetter().repositoryUrl}async getSnapshotTree(e,t){return this.storageGetter().getSnapshotTree(e,t)}async readBlob(e){const t=this.blobContents[e];return void 0!==t?t:this.storageGetter().readBlob(e)}async getVersions(e,t,s){return this.storageGetter().getVersions(e,t,s)}async uploadSummaryWithContext(e,t){return this.storageGetter().uploadSummaryWithContext(e,t)}async downloadSummary(e){return this.storageGetter().downloadSummary(e)}async createBlob(e){return this.storageGetter().createBlob(e)}}class r{constructor(e,t){this.blobStorage=e,this.logger=t,this.getSnapshotTree=this.notCalled,this.getVersions=this.notCalled,this.write=this.notCalled,this.uploadSummaryWithContext=this.notCalled,this.downloadSummary=this.notCalled}async createBlob(e){return this.blobStorage.createBlob(e)}async readBlob(e){return this.blobStorage.readBlob(e)}get policies(){return this.notCalled()}get repositoryUrl(){return this.notCalled()}notCalled(){try{throw new Error("BlobOnlyStorage not implemented method used")}catch(e){throw this.logger.sendErrorEvent({eventName:"BlobOnlyStorageWrongCall"},e),e}}}},18223:function(e,t,s){"use strict";s.d(t,"c",(function(){return l})),s.d(t,"b",(function(){return p})),s.d(t,"a",(function(){return g}));var n=s(18224),r=s(17946),i=s(17983),o=s(18227),a=s(17989),c=s(17940),h=s(17981),u=s(17945);function l(e){var t;const s=Object(n.parse)(e,!0);if("string"!=typeof s.pathname)throw new u.a("Failed to parse pathname");const r=null!==(t=s.search)&&void 0!==t?t:"",i=/^\/([^/]*\/[^/]*)(\/?.*)$/.exec(s.pathname);return 3===(null==i?void 0:i.length)?{id:i[1],path:i[2],query:r,version:s.query.version}:void 0}function d(e,t){const s={type:h.a.Tree,tree:Object.assign({},t.tree)};s.tree[".protocol"]=e;return function e(t){const s={blobs:{},blobsContents:{},trees:{},id:Object(r.a)(),unreferenced:t.unreferenced},n=Object.keys(t.tree);for(const c of n){const n=t.tree[c];switch(n.type){case h.a.Tree:s.trees[c]=e(n);break;case h.a.Attachment:s.blobs[c]=n.id;break;case h.a.Blob:{const e=Object(r.a)();s.blobs[c]=e;const t="string"==typeof n.content?Object(i.d)(n.content,"utf8"):Object(o.a)(n.content);s.blobsContents[e]=t;break}case h.a.Handle:throw new u.a("No handles should be there in summary in detached container!!");default:Object(a.a)(n,"Unknown tree type "+n.type)}}return s}(s)}const p=e=>{const t=e.tree[".protocol"],s=e.tree[".app"];Object(c.a)(void 0!==t&&void 0!==s,480);return d(t,s)};function g(e){return".protocol"in e.trees?e.trees[".protocol"]:e}},18224:function(e,t,s){"use strict";var n=s(18225),r=s(18226);function i(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=y,t.resolve=function(e,t){return y(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?y(e,!1,!0).resolveObject(t):t},t.format=function(e){r.isString(e)&&(e=y(e));return e instanceof i?e.format():i.prototype.format.call(e)},t.Url=i;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,c=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,h=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),u=["'"].concat(h),l=["%","/","?",";","#"].concat(u),d=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,g=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},f={javascript:!0,"javascript:":!0},b={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},v=s(18086);function y(e,t,s){if(e&&r.isObject(e)&&e instanceof i)return e;var n=new i;return n.parse(e,t,s),n}i.prototype.parse=function(e,t,s){if(!r.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var i=e.indexOf("?"),a=-1!==i&&i<e.indexOf("#")?"?":"#",h=e.split(a);h[0]=h[0].replace(/\\/g,"/");var y=e=h.join(a);if(y=y.trim(),!s&&1===e.split("#").length){var S=c.exec(y);if(S)return this.path=y,this.href=y,this.pathname=S[1],S[2]?(this.search=S[2],this.query=t?v.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var w=o.exec(y);if(w){var C=(w=w[0]).toLowerCase();this.protocol=C,y=y.substr(w.length)}if(s||w||y.match(/^\/\/[^@\/]+@[^@\/]+/)){var O="//"===y.substr(0,2);!O||w&&f[w]||(y=y.substr(2),this.slashes=!0)}if(!f[w]&&(O||w&&!b[w])){for(var j,M,k=-1,N=0;N<d.length;N++){-1!==(E=y.indexOf(d[N]))&&(-1===k||E<k)&&(k=E)}-1!==(M=-1===k?y.lastindexOf("@"):y.lastindexOf("@",k))&&(j=y.slice(0,M),y=y.slice(M+1),this.auth=decodeURIComponent(j)),k=-1;for(N=0;N<l.length;N++){var E;-1!==(E=y.indexOf(l[N]))&&(-1===k||E<k)&&(k=E)}-1===k&&(k=y.length),this.host=y.slice(0,k),y=y.slice(k),this.parseHost(),this.hostname=this.hostname||"";var D="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!D)for(var I=this.hostname.split(/\./),T=(N=0,I.length);N<T;N++){var _=I[N];if(_&&!_.match(p)){for(var q="",x=0,R=_.length;x<R;x++)_.charCodeAt(x)>127?q+="x":q+=_[x];if(!q.match(p)){var P=I.slice(0,N),A=I.slice(N+1),L=_.match(g);L&&(P.push(L[1]),A.unshift(L[2])),A.length&&(y="/"+A.join(".")+y),this.hostname=P.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),D||(this.hostname=n.toASCII(this.hostname));var F=this.port?":"+this.port:"",B=this.hostname||"";this.host=B+F,this.href+=this.host,D&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==y[0]&&(y="/"+y))}if(!m[C])for(N=0,T=u.length;N<T;N++){var U=u[N];if(-1!==y.indexOf(U)){var H=encodeURIComponent(U);H===U&&(H=escape(U)),y=y.split(U).join(H)}}var z=y.indexOf("#");-1!==z&&(this.hash=y.substr(z),y=y.slice(0,z));var V=y.indexOf("?");if(-1!==V?(this.search=y.substr(V),this.query=y.substr(V+1),t&&(this.query=v.parse(this.query)),y=y.slice(0,V)):t&&(this.search="",this.query={}),y&&(this.pathname=y),b[C]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var W=this.search||"";this.path=F+W}return this.href=this.format(),this},i.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",s=this.pathname||"",n=this.hash||"",i=!1,o="";this.host?i=e+this.host:this.hostname&&(i=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&r.isObject(this.query)&&Object.keys(this.query).length&&(o=v.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||b[t])&&!1!==i?(i="//"+(i||""),s&&"/"!==s.charAt(0)&&(s="/"+s)):i||(i=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+i+(s=s.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},i.prototype.resolve=function(e){return this.resolveObject(y(e,!1,!0)).format()},i.prototype.resolveObject=function(e){if(r.isString(e)){var t=new i;t.parse(e,!1,!0),e=t}for(var s=new i,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];s[a]=this[a]}if(s.hash=e.hash,""===e.href)return s.href=s.format(),s;if(e.slashes&&!e.protocol){for(var c=Object.keys(e),h=0;h<c.length;h++){var u=c[h];"protocol"!==u&&(s[u]=e[u])}return b[s.protocol]&&s.hostname&&!s.pathname&&(s.path=s.pathname="/"),s.href=s.format(),s}if(e.protocol&&e.protocol!==s.protocol){if(!b[e.protocol]){for(var l=Object.keys(e),d=0;d<l.length;d++){var p=l[d];s[p]=e[p]}return s.href=s.format(),s}if(s.protocol=e.protocol,e.host||f[e.protocol])s.pathname=e.pathname;else{for(var g=(e.pathname||"").split("/");g.length&&!(e.host=g.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==g[0]&&g.unshift(""),g.length<2&&g.unshift(""),s.pathname=g.join("/")}if(s.search=e.search,s.query=e.query,s.host=e.host||"",s.auth=e.auth,s.hostname=e.hostname||e.host,s.port=e.port,s.pathname||s.search){var m=s.pathname||"",v=s.search||"";s.path=m+v}return s.slashes=s.slashes||e.slashes,s.href=s.format(),s}var y=s.pathname&&"/"===s.pathname.charAt(0),S=e.host||e.pathname&&"/"===e.pathname.charAt(0),w=S||y||s.host&&e.pathname,C=w,O=s.pathname&&s.pathname.split("/")||[],j=(g=e.pathname&&e.pathname.split("/")||[],s.protocol&&!b[s.protocol]);if(j&&(s.hostname="",s.port=null,s.host&&(""===O[0]?O[0]=s.host:O.unshift(s.host)),s.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===g[0]?g[0]=e.host:g.unshift(e.host)),e.host=null),w=w&&(""===g[0]||""===O[0])),S)s.host=e.host||""===e.host?e.host:s.host,s.hostname=e.hostname||""===e.hostname?e.hostname:s.hostname,s.search=e.search,s.query=e.query,O=g;else if(g.length)O||(O=[]),O.pop(),O=O.concat(g),s.search=e.search,s.query=e.query;else if(!r.isNullOrUndefined(e.search)){if(j)s.hostname=s.host=O.shift(),(D=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=D.shift(),s.host=s.hostname=D.shift());return s.search=e.search,s.query=e.query,r.isNull(s.pathname)&&r.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.href=s.format(),s}if(!O.length)return s.pathname=null,s.search?s.path="/"+s.search:s.path=null,s.href=s.format(),s;for(var M=O.slice(-1)[0],k=(s.host||e.host||O.length>1)&&("."===M||".."===M)||""===M,N=0,E=O.length;E>=0;E--)"."===(M=O[E])?O.splice(E,1):".."===M?(O.splice(E,1),N++):N&&(O.splice(E,1),N--);if(!w&&!C)for(;N--;N)O.unshift("..");!w||""===O[0]||O[0]&&"/"===O[0].charAt(0)||O.unshift(""),k&&"/"!==O.join("/").substr(-1)&&O.push("");var D,I=""===O[0]||O[0]&&"/"===O[0].charAt(0);j&&(s.hostname=s.host=I?"":O.length?O.shift():"",(D=!!(s.host&&s.host.indexOf("@")>0)&&s.host.split("@"))&&(s.auth=D.shift(),s.host=s.hostname=D.shift()));return(w=w||s.host&&O.length)&&!I&&O.unshift(""),O.length?s.pathname=O.join("/"):(s.pathname=null,s.path=null),r.isNull(s.pathname)&&r.isNull(s.search)||(s.path=(s.pathname?s.pathname:"")+(s.search?s.search:"")),s.auth=e.auth||s.auth,s.slashes=s.slashes||e.slashes,s.href=s.format(),s},i.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},18226:function(e,t,s){"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},18227:function(e,t,s){"use strict";function n(e){return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}s.d(t,"a",(function(){return n}))},18228:function(e,t,s){"use strict";s.d(t,"a",(function(){return n})),s.d(t,"b",(function(){return i}));var n,r=s(18229);!function(e){e.Never="Never",e.Disabled="Disabled",e.Enabled="Enabled"}(n||(n={}));const i=e=>{let t;return t=e&&"name"in e?e:Object(r.b)(null==e?void 0:e.package)?null==e?void 0:e.package.name:null==e?void 0:e.package,{name:t}}},18229:function(e,t,s){"use strict";s.d(t,"b",(function(){return n})),s.d(t,"a",(function(){return r}));const n=e=>"object"==typeof e&&"string"==typeof(null==e?void 0:e.name)&&"object"==typeof(null==e?void 0:e.fluid),r=e=>{const t=e;return"object"==typeof t&&("string"==typeof(null==t?void 0:t.package)||n(null==t?void 0:t.package))&&(void 0===(null==t?void 0:t.config)||"object"==typeof(null==t?void 0:t.config))}},18230:function(e,t,s){"use strict";s.d(t,"a",(function(){return o})),s.d(t,"b",(function(){return a})),s.d(t,"c",(function(){return c}));var n=s(18191),r=s(18231),i=s(17940);class o extends n.a{constructor(e){super(e),super.setMaxListeners(50),this.propose=Object(r.a)(this,e.propose.bind(e)),this.has=Object(r.a)(this,e.has.bind(e)),this.get=Object(r.a)(this,e.get.bind(e)),this.getMembers=Object(r.a)(this,e.getMembers.bind(e)),this.getMember=Object(r.a)(this,e.getMember.bind(e))}}function a(e){const t=new Map(e).get("code");return Object(i.a)(void 0!==t,732),null==t?void 0:t.value}function c(e){return[["code",{key:"code",value:e,approvalSequenceNumber:0,commitSequenceNumber:0,sequenceNumber:0}]]}},18231:function(e,t,s){"use strict";function n(e,t){return(...s)=>{if(e.disposed)throw new Error("Already disposed");return t(...s)}}s.d(t,"a",(function(){return n}))},18232:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(17940),r=s(17957),i=s(18173);class o{constructor(e,t){this.internalStorageService=e,this.logger=t,this._disposed=!1}get policies(){return this.internalStorageService.policies}get disposed(){return this._disposed}dispose(){this._disposed=!0}get repositoryUrl(){return this.internalStorageService.repositoryUrl}async getSnapshotTree(e,t){return this.runWithRetry(async()=>this.internalStorageService.getSnapshotTree(e,t),"storage_getSnapshotTree")}async readBlob(e){return this.runWithRetry(async()=>this.internalStorageService.readBlob(e),"storage_readBlob")}async getVersions(e,t,s){return this.runWithRetry(async()=>this.internalStorageService.getVersions(e,t,s),"storage_getVersions")}async uploadSummaryWithContext(e,t){return Object(n.a)(0===t.referenceSequenceNumber==(void 0===t.ackHandle),593),0!==t.referenceSequenceNumber?this.internalStorageService.uploadSummaryWithContext(e,t):this.runWithRetry(async()=>this.internalStorageService.uploadSummaryWithContext(e,t),"storage_uploadSummaryWithContext")}async downloadSummary(e){return this.runWithRetry(async()=>this.internalStorageService.downloadSummary(e),"storage_downloadSummary")}async createBlob(e){return this.runWithRetry(async()=>this.internalStorageService.createBlob(e),"storage_createBlob")}checkStorageDisposed(){if(this._disposed)throw new r.d("Storage Service is disposed. Cannot retry",{canRetry:!1})}async runWithRetry(e,t){return Object(i.a)(e,t,this.logger,{onRetry:()=>this.checkStorageDisposed()})}}},18233:function(e,t,s){"use strict";s.d(t,"a",(function(){return r}));var n=s(18080);class r{constructor(e,t){this.internalStorageService=e,this.generateProtocolTree=t,this.getSnapshotTree=this.internalStorageService.getSnapshotTree.bind(this.internalStorageService),this.getVersions=this.internalStorageService.getVersions.bind(this.internalStorageService),this.createBlob=this.internalStorageService.createBlob.bind(this.internalStorageService),this.readBlob=this.internalStorageService.readBlob.bind(this.internalStorageService),this.downloadSummary=this.internalStorageService.downloadSummary.bind(this.internalStorageService),this.dispose=this.internalStorageService.dispose.bind(this.internalStorageService)}get policies(){return this.internalStorageService.policies}get repositoryUrl(){return this.internalStorageService.repositoryUrl}get disposed(){return this.internalStorageService.disposed}async uploadSummaryWithContext(e,t){return this.internalStorageService.uploadSummaryWithContext(Object(n.a)(e,this.generateProtocolTree()),t)}}},18234:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(17970),r=s(18235);class i extends class{constructor(e,t,s,n,i,o,a){this.minimumSequenceNumber=e,this.sequenceNumber=t,this.term=null!=s?s:1,this._quorum=new r.a(n,i,o,a)}get quorum(){return this._quorum}get attributes(){return{minimumSequenceNumber:this.minimumSequenceNumber,sequenceNumber:this.sequenceNumber,term:this.term}}setConnectionState(e,t){this._quorum.setConnectionState(e,t)}snapshot(){return this._quorum.snapshot()}close(){this._quorum.close()}processMessage(e,t){if(e.sequenceNumber!==this.sequenceNumber+1)throw new Error(`Protocol state is not moving sequentially. Current is ${this.sequenceNumber}. Next is ${e.sequenceNumber}`);this.sequenceNumber=e.sequenceNumber,this.minimumSequenceNumber=e.minimumSequenceNumber;let s=!1;switch(e.type){case n.a.ClientJoin:const r=e,i=JSON.parse(r.data),o={client:i.detail,sequenceNumber:r.sequenceNumber};this._quorum.addMember(i.clientId,o);break;case n.a.ClientLeave:const a=e,c=JSON.parse(a.data);this._quorum.removeMember(c);break;case n.a.Propose:const h=e.contents;this._quorum.addProposal(h.key,h.value,e.sequenceNumber,t,e.clientSequenceNumber),s=!0;break;case n.a.Reject:throw new Error("Quorum rejection is removed.")}return this._quorum.updateMinimumSequenceNumber(e),{immediateNoOp:s}}getProtocolState(){return Object.assign({sequenceNumber:this.sequenceNumber,minimumSequenceNumber:this.minimumSequenceNumber},this._quorum.snapshot())}}{processMessage(e,t){const s=this._quorum.getMember(e.clientId);if(null!=e.clientId){if(void 0===s&&e.type!==n.a.ClientJoin)throw new Error("Remote message's clientId is missing from the quorum");if(!0===(null==s?void 0:s.shouldHaveLeft)&&e.type!==n.a.NoOp)throw new Error("Remote message's clientId already should have left")}return super.processMessage(e,t)}}},18235:function(e,t,s){"use strict";s.d(t,"a",(function(){return l}));var n=s(15576),r=s(16645),i=s.n(r),o=s(17939),a=s(17940);class c{constructor(e,t,s,n){this.sequenceNumber=e,this.key=t,this.value=s,this.local=n}}class h extends o.a{constructor(e){super(),this.isDisposed=!1,this.members=new Map(e),this.snapshotCache=e}get disposed(){return this.isDisposed}snapshot(){var e;return null!==(e=this.snapshotCache)&&void 0!==e||(this.snapshotCache=i()(Array.from(this.members))),this.snapshotCache}addMember(e,t){Object(a.a)(!this.members.has(e),462),this.members.set(e,t),this.emit("addMember",e,t),this.snapshotCache=void 0}removeMember(e){Object(a.a)(this.members.has(e),463),this.members.delete(e),this.emit("removeMember",e),this.snapshotCache=void 0}getMembers(){return new Map(this.members)}getMember(e){return this.members.get(e)}dispose(){this.isDisposed=!0}}class u extends o.a{constructor(e,t){super(),this.sendProposal=t,this.isDisposed=!1,this.stateEvents=new n.EventEmitter,this.proposals=new Map(e.proposals.map(([,e])=>[e.sequenceNumber,new c(e.sequenceNumber,e.key,e.value,!1)])),this.values=new Map(e.values),this.proposalsSnapshotCache=e.proposals,this.valuesSnapshotCache=e.values}get disposed(){return this.isDisposed}snapshot(){var e,t;return null!==(e=this.proposalsSnapshotCache)&&void 0!==e||(this.proposalsSnapshotCache=Array.from(this.proposals).map(([e,t])=>[e,{sequenceNumber:e,key:t.key,value:t.value},[]])),null!==(t=this.valuesSnapshotCache)&&void 0!==t||(this.valuesSnapshotCache=i()(Array.from(this.values))),{proposals:this.proposalsSnapshotCache,values:this.valuesSnapshotCache}}has(e){return this.values.has(e)}get(e){var t;return null===(t=this.values.get(e))||void 0===t?void 0:t.value}getApprovalData(e){const t=this.values.get(e);return t?i()(t):void 0}async propose(e,t){const s=this.sendProposal(e,t);if(s<0)throw this.emit("error",{eventName:"ProposalInDisconnectedState",key:e}),new Error("Can't propose in disconnected state");return new Promise((e,t)=>{let n;const r=(e,t)=>{e===s&&(n=t,this.stateEvents.off("localProposalSequenced",r),this.stateEvents.off("disconnected",o),this.stateEvents.on("localProposalApproved",i))},i=t=>{t===n&&(e(),c())},o=()=>{void 0===n&&this.stateEvents.once("connected",()=>{void 0===n&&(t(new Error("Client disconnected without successfully sending proposal")),c())})},a=()=>{t(new Error("QuorumProposals was disposed")),c()},c=()=>{this.stateEvents.off("localProposalSequenced",r),this.stateEvents.off("localProposalApproved",i),this.stateEvents.off("disconnected",o),this.stateEvents.off("disposed",a)};this.stateEvents.on("localProposalSequenced",r),this.stateEvents.on("disconnected",o),this.stateEvents.on("disposed",a)})}addProposal(e,t,s,n,r){Object(a.a)(!this.proposals.has(s),464);const i=new c(s,e,t,n);this.proposals.set(s,i),this.emit("addProposal",i),n&&this.stateEvents.emit("localProposalSequenced",r,s),this.proposalsSnapshotCache=void 0}updateMinimumSequenceNumber(e){const t=e.minimumSequenceNumber,s=[];for(const[n,r]of this.proposals)n<=t&&s.push(r);s.sort((e,t)=>e.sequenceNumber-t.sequenceNumber);for(const n of s){const t={approvalSequenceNumber:e.sequenceNumber,commitSequenceNumber:-1,key:n.key,sequenceNumber:n.sequenceNumber,value:n.value};this.values.set(t.key,t),this.valuesSnapshotCache=void 0,this.emit("approveProposal",t.sequenceNumber,t.key,t.value,t.approvalSequenceNumber),this.proposals.delete(n.sequenceNumber),this.proposalsSnapshotCache=void 0,n.local&&this.stateEvents.emit("localProposalApproved",n.sequenceNumber)}}setConnectionState(e){e?this.stateEvents.emit("connected"):this.stateEvents.emit("disconnected")}dispose(){this.isDisposed=!0,this.stateEvents.emit("disposed")}}class l extends o.a{constructor(e,t,s,n){super(),this.isDisposed=!1,this.quorumClients=new h(e),this.quorumClients.on("addMember",(e,t)=>{this.emit("addMember",e,t)}),this.quorumClients.on("removeMember",e=>{this.emit("removeMember",e)}),this.quorumProposals=new u({proposals:t,values:s},n),this.quorumProposals.on("addProposal",e=>{this.emit("addProposal",e)}),this.quorumProposals.on("approveProposal",(e,t,s,n)=>{this.emit("approveProposal",e,t,s,n)})}get disposed(){return this.isDisposed}close(){this.removeAllListeners()}snapshot(){const e=this.quorumClients.snapshot(),{proposals:t,values:s}=this.quorumProposals.snapshot();return{members:e,proposals:t,values:s}}has(e){return this.quorumProposals.has(e)}get(e){return this.quorumProposals.get(e)}getApprovalData(e){return this.quorumProposals.getApprovalData(e)}addMember(e,t){this.quorumClients.addMember(e,t)}removeMember(e){this.quorumClients.removeMember(e)}getMembers(){return this.quorumClients.getMembers()}getMember(e){return this.quorumClients.getMember(e)}async propose(e,t){return this.quorumProposals.propose(e,t)}addProposal(e,t,s,n,r){return this.quorumProposals.addProposal(e,t,s,n,r)}updateMinimumSequenceNumber(e){this.quorumProposals.updateMinimumSequenceNumber(e)}setConnectionState(e,t){this.quorumProposals.setConnectionState(e)}dispose(){throw new Error("Not implemented.")}}},18236:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));const n="1.3.1"},18237:function(e,t,s){"use strict";s.d(t,"a",(function(){return b}));var n=s(18238),r=s.n(n),i=s(17946),o=s(17939),a=s(17940),c=s(17945),h=s(18026),u=s(18240),l=s(18011),d=s(17970),p=s(18010),g=s(17971),m=s(17957),f=s(18239);class b extends o.a{constructor(e,t,s,n){super(),this.serviceProvider=e,this.logger=t,this._active=s,this.pending=[],this.minSequenceNumber=0,this.lastQueuedSequenceNumber=0,this.lastObservedSeqNumber=0,this.lastProcessedSequenceNumber=0,this.baseTerm=0,this.opsSize=0,this.initSequenceNumber=0,this.closed=!1,this.throttlingIdSet=new Set,this.timeTillThrottling=0,this.closeAbortController=new r.a,this.deltaStorageDelayId=Object(i.a)(),this.deltaStreamDelayId=Object(i.a)(),this.messageBuffer=[];const o={incomingOpHandler:(e,t)=>{try{this.enqueueMessages(e,t)}catch(s){this.logger.sendErrorEvent({eventName:"EnqueueMessages_Exception"},s),this.close(Object(c.h)(s))}},signalHandler:e=>this._inboundSignal.push(e),reconnectionDelayHandler:(e,t)=>this.emitDelayInfo(this.deltaStreamDelayId,e,t),closeHandler:e=>this.close(e),disconnectHandler:e=>this.disconnectHandler(e),connectHandler:e=>this.connectHandler(e),pongHandler:e=>this.emit("pong",e),readonlyChangeHandler:e=>Object(h.d)(this,this.logger,"readonly",e)};this.connectionManager=n(o),this._inbound=new f.a(e=>{this.processInboundMessage(e)}),this._inbound.on("error",e=>{this.close(m.c.wrapIfUnrecognized(e,"deltaManagerInboundErrorHandler",this.lastMessage))}),this._inboundSignal=new f.a(e=>{if(void 0===this.handler)throw new Error("Attempted to process an inbound signal without a handler attached");this.handler.processSignal({clientId:e.clientId,content:JSON.parse(e.content)})}),this._inboundSignal.on("error",e=>{this.close(Object(c.h)(e))})}get active(){return this._active()}get disposed(){return this.closed}get IDeltaSender(){return this}get inbound(){return this._inbound}get inboundSignal(){return this._inboundSignal}get initialSequenceNumber(){return this.initSequenceNumber}get lastSequenceNumber(){return this.lastProcessedSequenceNumber}get lastMessage(){return this.lastProcessedMessage}get lastKnownSeqNumber(){return this.lastObservedSeqNumber}get referenceTerm(){return this.baseTerm}get minimumSequenceNumber(){return this.minSequenceNumber}get hasCheckpointSequenceNumber(){return Object(a.a)(this.connectionManager.connected,223),void 0!==this._checkpointSequenceNumber}get maxMessageSize(){return this.connectionManager.maxMessageSize}get version(){return this.connectionManager.version}get serviceConfiguration(){return this.connectionManager.serviceConfiguration}get outbound(){return this.connectionManager.outbound}get readOnlyInfo(){return this.connectionManager.readOnlyInfo}get clientDetails(){return this.connectionManager.clientDetails}submit(e,t,s=!1,n){const r={contents:JSON.stringify(t),metadata:n,referenceSequenceNumber:this.lastProcessedSequenceNumber,type:e};s||this.flush();const i=this.connectionManager.prepareMessageToSend(r);return void 0===i?-1:(this.opsSize+=i.contents.length,this.messageBuffer.push(i),this.emit("submitOp",i),s||this.flush(),i.clientSequenceNumber)}submitSignal(e){return this.connectionManager.submitSignal(e)}flush(){0!==this.messageBuffer.length&&(this.emit("prepareSend",this.messageBuffer),this.connectionManager.sendMessages(this.messageBuffer),this.messageBuffer=[])}get connectionProps(){return Object.assign({sequenceNumber:this.lastSequenceNumber,opsSize:this.opsSize>0?this.opsSize:void 0},this.connectionManager.connectionProps)}logConnectionIssue(e){var t;Object(a.a)(this.connectionManager.connected,568);const s=this.pending.sort((e,t)=>e.sequenceNumber-t.sequenceNumber);this.logger.sendErrorEvent(Object.assign(Object.assign(Object.assign(Object.assign({},e),{fetchReason:this.fetchReason,lastQueuedSequenceNumber:this.lastQueuedSequenceNumber,lastProcessedSequenceNumber:this.lastProcessedSequenceNumber,lastObserved:this.lastObservedSeqNumber}),this.connectionManager.connectionVerboseProps),{pendingOps:this.pending.length,pendingFirst:null===(t=s[0])||void 0===t?void 0:t.sequenceNumber,haveHandler:void 0!==this.handler,inboundLength:this.inbound.length,inboundPaused:this.inbound.paused}))}connectHandler(e){this.refreshDelayInfo(this.deltaStreamDelayId);const t=this.connectionManager.connectionVerboseProps;t.connectionLastQueuedSequenceNumber=this.lastQueuedSequenceNumber,t.connectionLastObservedSeqNumber=this.lastObservedSeqNumber;const s=e.checkpointSequenceNumber;this._checkpointSequenceNumber=s,void 0!==s&&this.updateLatestKnownOpSeqNumber(s),Object(a.a)(0===this.messageBuffer.length,233),this.opsSize=0,this.emit("connect",e,void 0!==s?this.lastObservedSeqNumber-this.lastSequenceNumber:void 0),void 0!==s?s>this.lastQueuedSequenceNumber&&this.fetchMissingDeltas("AfterConnection"):"read"===e.mode&&this.fetchMissingDeltas("AfterReadConnection")}dispose(){throw new Error("Not implemented.")}async attachOpHandler(e,t,s,n,r="none"){if(this.initSequenceNumber=t,this.lastProcessedSequenceNumber=t,this.baseTerm=s,this.minSequenceNumber=e,this.lastQueuedSequenceNumber=t,this.lastObservedSeqNumber=t,Object(a.a)(void 0===this.handler,226),this.handler=n,Object(a.a)(!!this.handler,227),Object(a.a)(void 0===this.fetchReason,616),!this.closed){if(this._inbound.resume(),this._inboundSignal.resume(),"none"!==r){const e="cached"===r;await this.fetchMissingDeltasCore("DocumentOpen_"+r,e),e&&this.fetchMissingDeltas("PostDocumentOpen")}Object(a.a)(void 0!==this.fetchReason||0===this.pending.length,617)}}connect(e){var t;const s=null===(t=e.fetchOpsFromStorage)||void 0===t||t;Object(u.a)(void 0!==this.handler||!s,this.logger,"CantFetchWithoutBaseline"),s&&this.fetchMissingDeltas(e.reason),this.connectionManager.connect(e.mode)}async getDeltas(e,t,s,n,i){const o=this.serviceProvider();if(void 0===o)throw new Error("Delta manager is not attached");let c;if(void 0===this.deltaStorage&&(this.deltaStorage=await o.connectToDeltaStorage()),void 0!==t){const n=t-1;if(this.lastQueuedSequenceNumber>=n)return void this.logger.sendPerformanceEvent(Object.assign({reason:s,eventName:"ExtraStorageCall",early:!0,from:e,to:t},this.connectionManager.connectionVerboseProps));c=e=>e.sequenceNumber>=n}else c=e=>e.sequenceNumber>=this.lastObservedSeqNumber;const h=new r.a;let u=!1;const l=e=>{Object(a.a)(e.sequenceNumber===this.lastQueuedSequenceNumber,570),!u&&c(e)&&(h.abort(),this._inbound.off("push",l))};try{this._inbound.on("push",l),Object(a.a)(null===this.closeAbortController.signal.onabort,488),this.closeAbortController.signal.onabort=()=>h.abort();const r=this.deltaStorage.fetchMessages(e,t,h.signal,i,s);for(;;){const e=await r.read();if(e.done)break;try{u=!0,n(e.value)}finally{u=!1}}}finally{this.closeAbortController.signal.onabort=null,this._inbound.off("push",l),Object(a.a)(!u,649)}}close(e){this.closed||(this.closed=!0,this.connectionManager.dispose(e),this.closeAbortController.abort(),this._inbound.clear(),this._inboundSignal.clear(),this._inbound.pause(),this._inboundSignal.pause(),this.pending=[],this.emit("closed",e),this.removeAllListeners())}refreshDelayInfo(e){this.throttlingIdSet.delete(e),0===this.throttlingIdSet.size&&(this.timeTillThrottling=0)}disconnectHandler(e){this.messageBuffer.length=0,this.emit("disconnect",e)}emitDelayInfo(e,t,s){const n=Date.now();if(this.throttlingIdSet.add(e),t>0&&n+t>this.timeTillThrottling){this.timeTillThrottling=n+t;const e=m.e.wrap(s,t/1e3,this.logger);this.emit("throttled",e)}}comparableMessagePayload(e){return`${e.clientId}-${e.type}-${e.minimumSequenceNumber}-${e.referenceSequenceNumber}-${e.timestamp}`}enqueueMessages(e,t,s=!1){var n,r;if(void 0===this.handler)return void(this.pending=this.pending.concat(e));if(Object(a.a)(0===this.pending.length||void 0!==this.fetchReason,489),0===e.length)return;const i=e[0].sequenceNumber,o=e[e.length-1].sequenceNumber;if(o>this.lastQueuedSequenceNumber){let n=i-1;const r=n-this.lastQueuedSequenceNumber;let a,c,h=0,u=0;for(const t of e)t.sequenceNumber===n?h++:t.sequenceNumber!==n+1&&(u++,void 0===a&&(a=n+1)),n=t.sequenceNumber;0!==h||0!==u&&!s||r>0&&void 0===this.fetchReason?c="enqueueMessages":void 0!==this.fetchReason&&this.fetchReason!==t&&i<=this.lastQueuedSequenceNumber+1&&o>this.lastQueuedSequenceNumber&&(c="enqueueMessagesExtraFetch"),void 0!==c&&this.logger.sendPerformanceEvent(Object.assign({eventName:c,reason:t,previousReason:this.prevEnqueueMessagesReason,from:i,to:o+1,length:e.length,fetchReason:this.fetchReason,duplicate:h>0?h:void 0,initialGap:0!==r?r:void 0,gap:u>0?u:void 0,firstMissing:a,dmInitialSeqNumber:this.initialSequenceNumber},this.connectionManager.connectionVerboseProps))}this.updateLatestKnownOpSeqNumber(e[e.length-1].sequenceNumber);const c=null===(n=this.previouslyProcessedMessage)||void 0===n?void 0:n.sequenceNumber;Object(a.a)(void 0===c||c===this.lastQueuedSequenceNumber,236);for(const a of e)if(a.sequenceNumber<=this.lastQueuedSequenceNumber){if((null===(r=this.previouslyProcessedMessage)||void 0===r?void 0:r.sequenceNumber)===a.sequenceNumber){const e=this.comparableMessagePayload(this.previouslyProcessedMessage),t=this.comparableMessagePayload(a);if(e!==t){const s=new p.d("Found two messages with the same sequenceNumber but different payloads. Likely to be a service issue",l.a.fileOverwrittenInStorage,{clientId:this.connectionManager.clientId,sequenceNumber:a.sequenceNumber,message1:e,message2:t,driverVersion:void 0});this.close(s)}}}else a.sequenceNumber!==this.lastQueuedSequenceNumber+1?(this.pending.push(a),this.fetchMissingDeltas(t,a.sequenceNumber)):(this.lastQueuedSequenceNumber=a.sequenceNumber,this.previouslyProcessedMessage=a,this._inbound.push(a));this.prevEnqueueMessagesReason=this.pending.length>0?"unknown":t}processInboundMessage(e){const t=Date.now();if(this.lastProcessedMessage=e,Object(a.a)(void 0!==e.clientId||!Object(g.a)(e),237),"string"==typeof e.contents&&""!==e.contents&&e.type!==d.a.ClientLeave&&(e.contents=JSON.parse(e.contents)),this.connectionManager.beforeProcessingIncomingOp(e),this.minSequenceNumber>e.minimumSequenceNumber)throw new m.b("Found a lower minimumSequenceNumber (msn) than previously recorded",Object.assign(Object.assign({},Object(m.g)(e)),{clientId:this.connectionManager.clientId}));if(this.minSequenceNumber=e.minimumSequenceNumber,e.sequenceNumber!==this.lastProcessedSequenceNumber+1)throw new m.b("Found a non-Sequential sequenceNumber",Object.assign(Object.assign({},Object(m.g)(e)),{clientId:this.connectionManager.clientId}));if(this.lastProcessedSequenceNumber=e.sequenceNumber,Object(a.a)(this.lastProcessedSequenceNumber<=this.lastObservedSeqNumber,615),void 0===e.term&&(e.term=1),this.baseTerm=e.term,void 0===this.handler)throw new Error("Attempted to process an inbound message without a handler attached");this.handler.process(e);const s=Date.now();this.emit("op",e,s-t)}fetchMissingDeltas(e,t){this.fetchMissingDeltasCore(e,!1,t).catch(e=>{this.logger.sendErrorEvent({eventName:"fetchMissingDeltasException"},e)})}async fetchMissingDeltasCore(e,t,s){var n;if(void 0===this.fetchReason)if(this.closed)this.logger.sendTelemetryEvent({eventName:"fetchMissingDeltasClosedConnection",reason:e});else if(void 0!==this.handler)try{let r=this.lastQueuedSequenceNumber+1;const i=null===(n=this.previouslyProcessedMessage)||void 0===n?void 0:n.sequenceNumber;void 0!==i&&(Object(a.a)(i===this.lastQueuedSequenceNumber,242),Object(a.a)(r>1,243),r--);const o=e+"_fetch";this.fetchReason=o,await this.getDeltas(r,s,o,e=>{this.refreshDelayInfo(this.deltaStorageDelayId),this.enqueueMessages(e,o)},t)}catch(r){this.logger.sendErrorEvent({eventName:"GetDeltas_Exception"},r),this.close(Object(c.h)(r))}finally{this.refreshDelayInfo(this.deltaStorageDelayId),this.fetchReason=void 0,this.processPendingOps(e)}else Object(a.a)(0===this.lastQueuedSequenceNumber,619)}processPendingOps(e){if(this.closed)return;Object(a.a)(void 0!==this.handler,620);const t=this.pending.sort((e,t)=>e.sequenceNumber-t.sequenceNumber);this.pending=[],this.enqueueMessages(t,e+"_pending",!0),void 0===this.fetchReason&&this.lastQueuedSequenceNumber<this.lastObservedSeqNumber&&this.fetchMissingDeltas("OpsBehind")}updateLatestKnownOpSeqNumber(e){this.lastObservedSeqNumber<e&&(this.lastObservedSeqNumber=e)}}},18238:function(e,t,s){"use strict";const{AbortController:n,AbortSignal:r}="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0;e.exports=n,e.exports.AbortSignal=r,e.exports.default=n},18239:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(17939),r=s(17940),i=s(17955),o=s(18005),a=s.n(o);class c extends n.a{constructor(e){super(),this.worker=e,this.isDisposed=!1,this.q=new a.a,this.pauseCount=1}get disposed(){return this.isDisposed}get paused(){return 0!==this.pauseCount}get length(){return this.q.length}get idle(){return void 0===this.processingPromise&&0===this.q.length}async waitTillProcessingDone(){var e;return null!==(e=this.processingPromise)&&void 0!==e?e:{count:0,duration:0}}dispose(){throw new Error("Not implemented.")}clear(){this.q.clear()}peek(){return this.q.peekFront()}toArray(){return this.q.toArray()}push(e){try{this.q.push(e),this.emit("push",e),this.ensureProcessing()}catch(t){this.emit("error",t)}}async pause(){this.pauseCount++,await this.waitTillProcessingDone()}resume(){Object(r.a)(this.pauseCount>0,244),this.pauseCount--,this.ensureProcessing()}ensureProcessing(){this.anythingToProcess()&&void 0===this.processingPromise&&(this.processingPromise=Promise.resolve().then(()=>{Object(r.a)(void 0!==this.processingPromise,"reentrancy?");const e=this.processDeltas();return Object(r.a)(void 0!==this.processingPromise,"reentrancy?"),this.processingPromise=void 0,e}).catch(e=>(this.error=e,this.processingPromise=void 0,this.emit("error",e),{count:0,duration:0})),Object(r.a)(void 0!==this.processingPromise,"processDeltas() should run async"))}anythingToProcess(){return 0!==this.q.length&&!this.paused&&void 0===this.error}processDeltas(){const e=i.a.now();let t=0;for(;this.anythingToProcess();){const e=this.q.shift();t++,this.worker(e),this.emit("op",e)}const s=i.a.now()-e;return 0===this.q.length&&this.emit("idle",t,s),{count:t,duration:s}}}},18240:function(e,t,s){"use strict";function n(e,t,s){if(e)return!0;const n="string"==typeof s?{eventName:s,category:"error"}:Object.assign({category:"error"},s);return t.send(n),!1}s.d(t,"a",(function(){return n}))},18241:function(e,t,s){"use strict";s.d(t,"a",(function(){return y}));var n=s(18238),r=s.n(n),i=s(17939),o=s(17940),a=s(17955),c=s(17957),h=s(18010),u=s(18178),l=s(18182),d=s(17970),p=s(17945),g=s(17944),m=s(18228),f=s(18239);const b={fatalConnectError:!0};class v extends i.a{constructor(){super(...arguments),this.clientId="storage-only client",this.claims={scopes:[l.a.DocRead]},this.mode="read",this.existing=!0,this.maxMessageSize=0,this.version="",this.initialMessages=[],this.initialSignals=[],this.initialClients=[],this.serviceConfiguration={maxMessageSize:0,blockSize:0,summary:void 0},this.checkpointSequenceNumber=void 0,this._disposed=!1}submit(e){this.emit("nack",this.clientId,e.map(e=>({operation:e,content:{message:"Cannot submit with storage-only connection",code:403}})))}submitSignal(e){this.emit("nack",this.clientId,{operation:e,content:{message:"Cannot submit signal with storage-only connection",code:403}})}get disposed(){return this._disposed}dispose(){this._disposed=!0}}class y{constructor(e,t,s,n,r){this.serviceProvider=e,this.client=t,this.logger=n,this.props=r,this._forceReadonly=!1,this.pendingReconnect=!1,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0,this.trailingNoopCount=0,this.connectFirstConnection=!0,this._connectionVerboseProps={},this._connectionProps={},this.closed=!1,this.opHandler=(e,t)=>{const s=Array.isArray(t)?t:[t];this.props.incomingOpHandler(s,"opHandler")},this.nackHandler=(e,t)=>{const s=t[0];if(!0===this._readonlyPermissions)return void this.props.closeHandler(Object(h.h)("writeOnReadOnlyDocument",{driverVersion:void 0}));const n=function(e){const t=`Nack (${e.type}): ${e.message}`,s=403!==e.code,n=void 0!==e.retryAfter?1e3*e.retryAfter:void 0;return Object(h.g)(t,{canRetry:s,retryAfterMs:n},{statusCode:e.code,driverVersion:void 0})}(s.content);n.canRetry?this.reconnectOnError("write",n):this.props.closeHandler(n)},this.disconnectHandlerInternal=e=>{this.reconnectOnError(this.defaultReconnectionMode,e)},this.errorHandler=e=>{this.reconnectOnError(this.defaultReconnectionMode,e)},this.clientDetails=this.client.details,this.defaultReconnectionMode=this.client.mode,this._reconnectMode=s?m.a.Enabled:m.a.Never,this._outbound=new f.a(e=>{if(void 0===this.connection)throw new Error("Attempted to submit an outbound message without connection");this.connection.submit(e)}),this._outbound.on("error",e=>{this.props.closeHandler(Object(p.h)(e))})}get connectionVerboseProps(){return this._connectionVerboseProps}get connectionMode(){var e,t;return null!==(t=null===(e=this.connection)||void 0===e?void 0:e.mode)&&void 0!==t?t:"read"}get connected(){return void 0!==this.connection}get clientId(){var e;return null===(e=this.connection)||void 0===e?void 0:e.clientId}get reconnectMode(){return this._reconnectMode}get maxMessageSize(){var e,t,s;return null!==(s=null===(t=null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration)||void 0===t?void 0:t.maxMessageSize)&&void 0!==s?s:16384}get version(){if(void 0===this.connection)throw new Error("Cannot check version without a connection");return this.connection.version}get serviceConfiguration(){var e;return null===(e=this.connection)||void 0===e?void 0:e.serviceConfiguration}get scopes(){var e;return null===(e=this.connection)||void 0===e?void 0:e.claims.scopes}get outbound(){return this._outbound}get connectionProps(){return void 0!==this.connection?this._connectionProps:Object.assign(Object.assign({},this._connectionProps),{sentOps:this.clientSequenceNumber})}shouldJoinWrite(){return this.clientSequenceNumberObserved<this.clientSequenceNumber-this.trailingNoopCount}get readonly(){return!!this._forceReadonly||this._readonlyPermissions}get readOnlyInfo(){const e=void 0!==this.connection&&this.connection instanceof v;return e||this._forceReadonly||!0===this._readonlyPermissions?{readonly:!0,forced:this._forceReadonly,permissions:this._readonlyPermissions,storageOnly:e}:{readonly:this._readonlyPermissions}}static detailsFromConnection(e){return{claims:e.claims,clientId:e.clientId,existing:e.existing,checkpointSequenceNumber:e.checkpointSequenceNumber,get initialClients(){return e.initialClients},mode:e.mode,serviceConfiguration:e.serviceConfiguration,version:e.version}}dispose(e){if(this.closed)return;this.closed=!0,this.pendingConnection=void 0,this._reconnectMode=m.a.Never,this._outbound.clear();const t=void 0!==e?`Closing DeltaManager (${e.message})`:"Closing DeltaManager";this.disconnectFromDeltaStream(t),this.set_readonlyPermissions(!0)}setAutoReconnect(e){Object(o.a)(e!==m.a.Never&&this._reconnectMode!==m.a.Never,632),this._reconnectMode=e,e!==m.a.Enabled&&this.disconnectFromDeltaStream("setAutoReconnect")}forceReadonly(e){e!==this._forceReadonly&&this.logger.sendTelemetryEvent({eventName:"ForceReadOnly",value:e});const t=this.readonly;if(this._forceReadonly=e,t!==this.readonly){if(this._reconnectMode===m.a.Never)throw new c.f("API is not supported for non-connecting or closed container");let e=!1;!0===this.readonly&&(this.shouldJoinWrite()&&this.logger.sendErrorEvent({eventName:"ForceReadonlyPendingChanged"}),e=this.disconnectFromDeltaStream("Force readonly")),this.props.readonlyChangeHandler(this.readonly),e&&this.triggerConnect("read")}}set_readonlyPermissions(e){const t=this.readonly;this._readonlyPermissions=e,t!==this.readonly&&this.props.readonlyChangeHandler(this.readonly)}connect(e){this.connectCore(e).catch(e=>{const t=Object(p.h)(e,{props:b});this.props.closeHandler(t)})}async connectCore(e){var t,s;if(Object(o.a)(!this.closed,618),void 0!==this.connection)return;let n;void 0!==this.pendingConnection&&(n=this.pendingConnection.connectionMode,this.cancelConnection(),Object(o.a)(void 0===this.pendingConnection,836));let i=null!==(t=null!=e?e:n)&&void 0!==t?t:this.defaultReconnectionMode;this.shouldJoinWrite()&&(i="write");const c=this.serviceProvider();let l;if(Object(o.a)(void 0!==c,679),!0===(null===(s=c.policies)||void 0===s?void 0:s.storageOnly))return l=new v,this.setupNewSuccessfulConnection(l,"read"),void Object(o.a)(void 0===this.pendingConnection,691);let d=1e3,m=0;const f=a.a.now();let y;const S=new r.a,w=S.signal;for(this.pendingConnection={abort:()=>{S.abort()},connectionMode:i};void 0===l;){if(this.closed)throw new Error("Attempting to connect a closed DeltaManager");if(!0===w.aborted)return void this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:m,duration:g.f.formatTick(a.a.now()-f),connectionEstablished:!1});m++;try{this.client.mode=i,l=await c.connectToDeltaStream(Object.assign(Object.assign({},this.client),{mode:i})),l.disposed&&(this.logger.sendTelemetryEvent({eventName:"ReceivedClosedConnection"}),l=void 0)}catch(C){if("object"==typeof C&&null!==C&&(null==C?void 0:C.errorType)===h.b.errorType){l=new v,i="read";break}if(!Object(h.f)(C)){const e=Object(p.h)(C,{props:b});throw this.props.closeHandler(e),e}Object(u.a)(this.logger,{attempts:m,delay:d,eventName:"DeltaConnectionFailureToConnect",duration:g.f.formatTick(a.a.now()-f)},C),y=C;const e=Object(h.i)(C);d=null!=e?e:Math.min(2*d,8e3),void 0!==e&&this.props.reconnectionDelayHandler(e,C),await Object(u.b)(d)}}if(m>1&&Object(u.a)(this.logger,{eventName:"MultipleDeltaConnectionFailures",attempts:m,duration:g.f.formatTick(a.a.now()-f)},y),!0===w.aborted)return l.dispose(),void this.logger.sendTelemetryEvent({eventName:"ConnectionAttemptCancelled",attempts:m,duration:g.f.formatTick(a.a.now()-f),connectionEstablished:!0});this.setupNewSuccessfulConnection(l,i)}triggerConnect(e){Object(o.a)(void 0===this.connection,569),this.reconnectMode===m.a.Enabled&&this.connect(e)}disconnectFromDeltaStream(e){if(this.pendingReconnect=!1,void 0===this.connection)return void 0!==this.pendingConnection&&(this.cancelConnection(),!0);Object(o.a)(void 0===this.pendingConnection,635);const t=this.connection;return this.connection=void 0,t.off("op",this.opHandler),t.off("signal",this.props.signalHandler),t.off("nack",this.nackHandler),t.off("disconnect",this.disconnectHandlerInternal),t.off("error",this.errorHandler),t.off("pong",this.props.pongHandler),this._outbound.pause(),this._outbound.clear(),this.props.disconnectHandler(e),t.dispose(),this._connectionVerboseProps={},!0}cancelConnection(){Object(o.a)(void 0!==this.pendingConnection,837),this.pendingConnection.abort(),this.pendingConnection=void 0,this.logger.sendTelemetryEvent({eventName:"ConnectionCancelReceived"})}setupNewSuccessfulConnection(e,t){Object(o.a)(void 0===this.connection,230),Object(o.a)(!e.disposed,650),this.pendingConnection=void 0,this.connection=e;const s=!e.claims.scopes.includes(l.a.DocWrite);if(Object(o.a)("read"===t||s===("read"===this.connectionMode),231),Object(o.a)(!s||"read"===this.connectionMode,232),this.set_readonlyPermissions(s),this.closed)return void this.disconnectFromDeltaStream("ConnectionManager already closed");this._outbound.resume(),e.on("op",this.opHandler),e.on("signal",this.props.signalHandler),e.on("nack",this.nackHandler),e.on("disconnect",this.disconnectHandlerInternal),e.on("error",this.errorHandler),e.on("pong",this.props.pongHandler);const n=e.initialMessages.sort((e,t)=>e.sequenceNumber-t.sequenceNumber);let r=e.checkpointSequenceNumber;this._connectionVerboseProps={clientId:e.clientId,mode:e.mode},this._connectionProps={},void 0!==e.relayServiceAgent&&(this._connectionVerboseProps.relayServiceAgent=e.relayServiceAgent,this._connectionProps.relayServiceAgent=e.relayServiceAgent),this._connectionProps.socketDocumentId=e.claims.documentId,this._connectionProps.connectionMode=e.mode;let i=-1;if(0!==n.length&&(this._connectionVerboseProps.connectionInitialOpsFrom=n[0].sequenceNumber,i=n[n.length-1].sequenceNumber,this._connectionVerboseProps.connectionInitialOpsTo=i+1,(void 0===r||r<i)&&(r=i)),this.props.incomingOpHandler(n,this.connectFirstConnection?"InitialOps":"ReconnectOps"),void 0!==e.initialSignals)for(const o of e.initialSignals)this.props.signalHandler(o);const a=y.detailsFromConnection(e);a.checkpointSequenceNumber=r,this.props.connectHandler(a),this.connectFirstConnection=!1}reconnectOnError(e,t){this.reconnect(e,t.message,t).catch(this.props.closeHandler)}async reconnect(e,t,s){if(Object(o.a)(void 0!==this.connection,235),this.disconnectFromDeltaStream(t),void 0===s||s.canRetry||this.logger.sendTelemetryEvent({eventName:"reconnectingDespiteFatalError",reconnectMode:this.reconnectMode},s),this.reconnectMode===m.a.Never&&this.props.closeHandler(),this.closed||this.reconnectMode!==m.a.Enabled)return;const n=Object(h.i)(s);void 0!==s&&void 0!==n&&(this.props.reconnectionDelayHandler(n,s),await Object(u.b)(n)),this.triggerConnect(e)}prepareMessageToSend(e){var t,s;if(!0!==this.readonly)return Object(o.a)(!!this.connection,228),this.lastSubmittedClientId!==(null===(t=this.connection)||void 0===t?void 0:t.clientId)&&(this.lastSubmittedClientId=null===(s=this.connection)||void 0===s?void 0:s.clientId,this.clientSequenceNumber=0,this.clientSequenceNumberObserved=0),e.type===d.a.NoOp?this.trailingNoopCount++:this.trailingNoopCount=0,Object.assign(Object.assign({},e),{clientSequenceNumber:++this.clientSequenceNumber});{Object(o.a)(!0===this.readOnlyInfo.readonly,496);const e=new c.d("deltaManagerReadonlySubmit",void 0,{readonly:this.readOnlyInfo.readonly,forcedReadonly:this.readOnlyInfo.forced,readonlyPermissions:this.readOnlyInfo.permissions,storageOnly:this.readOnlyInfo.storageOnly});this.props.closeHandler(e)}}submitSignal(e){void 0!==this.connection?this.connection.submitSignal(e):this.logger.sendErrorEvent({eventName:"submitSignalDisconnected"})}sendMessages(e){Object(o.a)(this.connected,692),"read"!==this.connectionMode?(Object(o.a)(!this.pendingReconnect,693),this._outbound.push(e)):this.pendingReconnect||(this.pendingReconnect=!0,Promise.resolve().then(async()=>{this.pendingReconnect&&await this.reconnect("write","Switch to write")}).catch(()=>{}))}beforeProcessingIncomingOp(e){if(Object(o.a)(this.clientId!==e.clientId||this.lastSubmittedClientId===e.clientId,238),void 0!==this.lastSubmittedClientId&&this.lastSubmittedClientId===e.clientId){const t=e.clientSequenceNumber;Object(o.a)(this.clientSequenceNumberObserved<t,239),Object(o.a)(t<=this.clientSequenceNumber,240),this.clientSequenceNumberObserved=t}if(e.type===d.a.ClientLeave){const t=e;JSON.parse(t.data)===this.clientId&&(this.logger.sendPerformanceEvent({eventName:"ReadConnectionTransition"}),this.reconnect("read","Switch to read").catch(e=>{this.logger.sendErrorEvent({eventName:"SwitchToReadConnection"},e)}))}}}},18242:function(e,t,s){"use strict";s.d(t,"a",(function(){return a}));var n=s(17978),r=s(17940),i=s(17970),o=s(17971);class a{constructor(e,t=2e3,s=50){this.submit=e,this.NoopCountFrequency=s,this.opsCountSinceNoop=0,t!==1/0&&(this.timer=new n.b(t,()=>{0!==this.opsCountSinceNoop&&this.submitNoop(!1)}))}scheduleSequenceNumberUpdate(e,t){t?this.submitNoop(!0):Object(o.b)(e)&&(this.opsCountSinceNoop++,this.opsCountSinceNoop>=this.NoopCountFrequency?this.submitNoop(!1):void 0!==this.timer&&(1===this.opsCountSinceNoop&&this.timer.restart(),Object(r.a)(this.timer.hasTimer,578)))}submitNoop(e){this.submit(i.a.NoOp,e?"":null),Object(r.a)(0===this.opsCountSinceNoop,579)}stopSequenceNumberUpdate(){this.opsCountSinceNoop=0}}},18243:function(e,t,s){"use strict";s.d(t,"a",(function(){return c}));var n=s(17979),r=s(17940),i=s(17959),o=s(18078),a=s(17944);class c{constructor(e,t,s,r,i,o,a,c,h,u,l,d,p,g,m){this.container=e,this.scope=t,this.codeLoader=s,this._codeDetails=r,this._baseSnapshot=i,this.deltaManager=o,this.loader=c,this.submitFn=h,this.submitSignalFn=u,this.closeFn=l,this.version=d,this.updateDirtyContainerState=p,this.existing=g,this.pendingLocalState=m,this._disposed=!1,this._quorum=a,this.taggedLogger=e.subLogger,this._fluidModuleP=new n.b(async()=>this.loadCodeModule(r)),this.attachListener()}static async createOrLoad(e,t,s,n,r,i,o,a,h,u,l,d,p,g,m){const f=new c(e,t,s,n,r,i,o,a,h,u,l,d,p,g,m);return await f.instantiateRuntime(g),f}get clientId(){return this.container.clientId}get id(){const e=this.container.resolvedUrl;return Object(o.b)(e)?e.id:""}get clientDetails(){return this.container.clientDetails}get connected(){return this.container.connected}get canSummarize(){return"summarize"in this.runtime}get serviceConfiguration(){return this.container.serviceConfiguration}get audience(){return this.container.audience}get options(){return this.container.options}get baseSnapshot(){return this._baseSnapshot}get storage(){return this.container.storage}get runtime(){if(void 0===this._runtime)throw new Error("Attempted to access runtime before it was defined");return this._runtime}get disposed(){return this._disposed}get codeDetails(){return this._codeDetails}get quorum(){return this._quorum}getSpecifiedCodeDetails(){var e;return null!==(e=this._quorum.get("code"))&&void 0!==e?e:this._quorum.get("code2")}dispose(e){this._disposed||(this._disposed=!0,this.runtime.dispose(e),this._quorum.dispose(),this.deltaManager.dispose())}getLoadedFromVersion(){return this.container.loadedFromVersion}get attachState(){return this.container.attachState}createSummary(e){return this.runtime.createSummary(e)}setConnectionState(e,t){const s=this.runtime;Object(r.a)(e===this.connected,222),s.setConnectionState(e,t)}process(e,t,s){this.runtime.process(e,t,s)}processSignal(e,t){this.runtime.processSignal(e,t)}async request(e){return this.runtime.request(e)}async getAbsoluteUrl(e){return this.container.getAbsoluteUrl(e)}getPendingLocalState(){return this.runtime.getPendingLocalState()}async satisfies(e){var t;const s=[],n=this.codeLoader;void 0!==n.IFluidCodeDetailsComparer&&s.push(n.IFluidCodeDetailsComparer);const r=await this._fluidModuleP,i=null===(t=r.module)||void 0===t?void 0:t.fluidExport;if(void 0!==(null==i?void 0:i.IFluidCodeDetailsComparer)&&s.push(i.IFluidCodeDetailsComparer),0===s.length)return!1;for(const o of s){if(!1===await o.satisfies(r.details,e))return!1}return!0}notifyAttaching(e){var t,s;this._baseSnapshot=e,null===(s=(t=this.runtime).notifyAttaching)||void 0===s||s.call(t,e),this.runtime.setAttachState(i.a.Attaching)}async getRuntimeFactory(){var e;const t=null===(e=(await this._fluidModuleP).module)||void 0===e?void 0:e.fluidExport,s=null==t?void 0:t.IRuntimeFactory;if(void 0===s)throw new Error("Code package does not implement IRuntimeFactory");return s}async instantiateRuntime(e){const t=await this.getRuntimeFactory();this._runtime=await t.instantiateRuntime(this,e)}attachListener(){this.container.once("attached",()=>{this.runtime.setAttachState(i.a.Attached)})}async loadCodeModule(e){const t=await a.c.timedExecAsync(this.taggedLogger,{eventName:"CodeLoad"},async()=>this.codeLoader.load(e));if("module"in t){const{module:s,details:n}=t;return{module:s,details:null!=n?n:e}}return this.taggedLogger.sendTelemetryEvent({eventName:"LegacyCodeLoader"}),t}}},18244:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(18191);class r extends n.a{constructor(e){super(e),this.queue=e}get paused(){return this.queue.paused}get length(){return this.queue.length}get idle(){return this.queue.idle}peek(){return this.queue.peek()}toArray(){return this.queue.toArray()}async systemPause(){return this.pause()}async pause(){return this.queue.pause()}async systemResume(){return this.resume()}async resume(){this.queue.resume()}async waitTillProcessingDone(){return this.queue.waitTillProcessingDone()}}class i extends n.a{constructor(e){super(e),this.deltaManager=e,this.inbound=new r(e.inbound),this.outbound=new r(e.outbound),this.inboundSignal=new r(e.inboundSignal)}get IDeltaSender(){return this}get minimumSequenceNumber(){return this.deltaManager.minimumSequenceNumber}get lastSequenceNumber(){return this.deltaManager.lastSequenceNumber}get lastMessage(){return this.deltaManager.lastMessage}get lastKnownSeqNumber(){return this.deltaManager.lastKnownSeqNumber}get initialSequenceNumber(){return this.deltaManager.initialSequenceNumber}get hasCheckpointSequenceNumber(){return this.deltaManager.hasCheckpointSequenceNumber}get clientDetails(){return this.deltaManager.clientDetails}get version(){return this.deltaManager.version}get maxMessageSize(){return this.deltaManager.maxMessageSize}get serviceConfiguration(){return this.deltaManager.serviceConfiguration}get active(){return this.deltaManager.active}get readOnlyInfo(){return this.deltaManager.readOnlyInfo}dispose(){this.inbound.dispose(),this.outbound.dispose(),this.inboundSignal.dispose(),super.dispose()}submitSignal(e){return this.deltaManager.submitSignal(e)}flush(){return this.deltaManager.flush()}}},18245:function(e,t,s){"use strict";s.d(t,"a",(function(){return o}));var n=s(17955),r=s(18120),i=s(17944);class o extends i.f{constructor(e,t,s){super(void 0,s),this.debug=e,this.debugErr=t}static create(e,t){const s=Object(r.debug)(e),n=Object(r.debug)(e);return n.log=console.error.bind(console),n.enabled=!0,new o(s,n,t)}static mixinDebugLogger(e,t,s){if(!t)return o.create(e,s);const n=new i.b(void 0,s);return n.addLogger(o.create(e,this.tryGetBaseLoggerProps(t))),n.addLogger(i.a.create(t,e)),n}static tryGetBaseLoggerProps(e){if(e instanceof i.f)return e.properties}send(e){const t=this.prepareEvent(e),s="error"===t.category;let r=s?this.debugErr:this.debug;const o=e.eventName.lastindexOf(i.f.eventNamespaceSeparator),a=e.eventName.substring(o+1);o>0&&(r=r.extend(e.eventName.substring(0,o))),t.eventName=void 0;let c="";c="tick="+i.f.formatTick(n.a.now());const h=t.stack?t.stack:"";let u;t.stack=void 0;try{u=JSON.stringify(t)}catch(l){t.error=void 0,u=JSON.stringify(t)}"{}"===u&&(u=""),s&&(r.enabled=!0),r(`${a} ${u} ${c} ${h}`)}}},18246:function(e,t,s){"use strict";s.d(t,"a",(function(){return n}));class n{constructor(e){this.urlResolvers=e}static create(e){return Array.isArray(e)?1===e.length?e[0]:new n(e):e}async resolve(e){return async function(e,t){let s;for(const n of e)if(s=await n.resolve(Object.assign({},t)),void 0!==s)return s}(this.urlResolvers,e)}async getAbsoluteUrl(e,t){throw new Error("Not implmented")}}},18247:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));var n=s(18224),r=s(18078);class i{constructor(e){this.protocolName="none:",this.protocolToDocumentFactoryMap=new Map,e.forEach(e=>{this.protocolToDocumentFactoryMap.set(e.protocolName,e)})}static create(e){if(Array.isArray(e)){const t=[];return e.forEach(e=>{const s=e;void 0!==s.protocolToDocumentFactoryMap?t.push(...s.protocolToDocumentFactoryMap.values()):t.push(e)}),1===t.length?t[0]:new i(t)}return e}async createDocumentService(e,t,s){Object(r.a)(e);const i=Object(n.parse)(e.url);if(void 0===i.protocol||null===i.protocol)throw new Error("No protocol provided");const o=this.protocolToDocumentFactoryMap.get(i.protocol);if(void 0===o)throw new Error("Unknown Fluid protocol");return o.createDocumentService(e,t,s)}async createContainer(e,t,s,i){Object(r.a)(t);const o=Object(n.parse)(t.url);if(void 0===o.protocol||null===o.protocol)throw new Error("No protocol provided");const a=this.protocolToDocumentFactoryMap.get(o.protocol);if(void 0===a)throw new Error("Unknown Fluid protocol");return a.createContainer(e,t,s,i)}}}}]);